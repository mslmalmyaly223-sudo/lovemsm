<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
Â  Â  <title>Ø²Ø§ÙŠÙ„Ùˆ - Zailo</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://unpkg.com/@phosphor-icons/web"></script>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@900&display=swap" rel="stylesheet">
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  html, body {
Â  Â  Â  Â  Â  Â  scroll-behavior: smooth;
Â  Â  Â  Â  Â  Â  -webkit-overflow-scrolling: touch;
Â  Â  Â  Â  Â  Â  overscroll-behavior-y: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color, #f3f4f6);
Â  Â  Â  Â  Â  Â  color: var(--text-color, #1f2937);
Â  Â  Â  Â  Â  Â  -webkit-user-select: none;
Â  Â  Â  Â  Â  Â  -moz-user-select: none;
Â  Â  Â  Â  Â  Â  -ms-user-select: none;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  Â  Â  overflow: hidden;Â 
Â  Â  Â  Â  Â  Â  touch-action: pan-y;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s, color 0.3s;
Â  Â  Â  Â  }

Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --bg-color: #f3f4f6;
Â  Â  Â  Â  Â  Â  --text-color: #1f2937;
Â  Â  Â  Â  Â  Â  --nav-bg: #ffffff;
Â  Â  Â  Â  Â  Â  --card-bg: #ffffff;
Â  Â  Â  Â  Â  Â  --chat-bg: #e0f2fe;
Â  Â  Â  Â  Â  Â  --bubble-me-bg: #22c55e;
Â  Â  Â  Â  Â  Â  --bubble-me-text: #ffffff;
Â  Â  Â  Â  Â  Â  --bubble-other-bg: #ffffff;
Â  Â  Â  Â  Â  Â  --bubble-other-text: #1f2937;
Â  Â  Â  Â  Â  Â  --border-color: #f3f4f6;
Â  Â  Â  Â  Â  Â  --vh: 1vh;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  body.dark-theme {
Â  Â  Â  Â  Â  Â  --bg-color: #111827;
Â  Â  Â  Â  Â  Â  --text-color: #f9fafb;
Â  Â  Â  Â  Â  Â  --nav-bg: #1f2937;
Â  Â  Â  Â  Â  Â  --card-bg: #1f2937;
Â  Â  Â  Â  Â  Â  --chat-bg: #030712;
Â  Â  Â  Â  Â  Â  --bubble-me-bg: #2563eb;
Â  Â  Â  Â  Â  Â  --bubble-me-text: #ffffff;
Â  Â  Â  Â  Â  Â  --bubble-other-bg: #374151;
Â  Â  Â  Â  Â  Â  --bubble-other-text: #f9fafb;
Â  Â  Â  Â  Â  Â  --border-color: #374151;
Â  Â  Â  Â  }

Â  Â  Â  Â  .theme-bg { background-color: var(--bg-color); }
Â  Â  Â  Â  .theme-card { background-color: var(--card-bg); color: var(--text-color); border-color: var(--border-color); }
Â  Â  Â  Â  .theme-nav { background-color: var(--nav-bg); border-color: var(--border-color); }
Â  Â  Â  Â  .theme-text { color: var(--text-color); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .chat-container-bg { background-color: var(--chat-bg); transition: background-color 0.3s; }
Â  Â  Â  Â  .bubble-me { background-color: var(--bubble-me-bg); color: var(--bubble-me-text); }
Â  Â  Â  Â  .bubble-other { background-color: var(--bubble-other-bg); color: var(--bubble-other-text); border: 1px solid var(--border-color); }

Â  Â  Â  Â  .smooth-scroll {
Â  Â  Â  Â  Â  Â  -webkit-overflow-scrolling: touch;
Â  Â  Â  Â  Â  Â  scroll-behavior: smooth;
Â  Â  Â  Â  Â  Â  will-change: scroll-position;
Â  Â  Â  Â  }

Â  Â  Â  Â  .hide-scrollbar::-webkit-scrollbar { display: none; }
Â  Â  Â  Â  .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

Â  Â  Â  Â  #splash-screen { background-color: #0a192f; }

Â  Â  Â  Â  @keyframes wormSlide {
Â  Â  Â  Â  Â  Â  0% { transform: translateX(100vw) scaleX(2.5) scaleY(0.4); opacity: 0; }
Â  Â  Â  Â  Â  Â  40% { transform: translateX(20vw) scaleX(0.6) scaleY(1.4); opacity: 1; }
Â  Â  Â  Â  Â  Â  70% { transform: translateX(-5vw) scaleX(1.2) scaleY(0.8); }
Â  Â  Â  Â  Â  Â  100% { transform: translateX(0) scaleX(1) scaleY(1); opacity: 1; }
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes glow-sync {
Â  Â  Â  Â  Â  Â  0% { text-shadow: 0 0 15px rgba(255, 215, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.4); transform: scale(1); }
Â  Â  Â  Â  Â  Â  100% { text-shadow: 0 0 25px rgba(255, 215, 0, 1), 0 0 50px rgba(255, 215, 0, 0.8), 0 0 75px rgba(255, 215, 0, 0.6); transform: scale(1.05); }
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes fadeUpText {
Â  Â  Â  Â  Â  Â  0% { transform: translateY(20px); opacity: 0; }
Â  Â  Â  Â  Â  Â  100% { transform: translateY(0); opacity: 1; }
Â  Â  Â  Â  }

Â  Â  Â  Â  .elegant-z {
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', system-ui, sans-serif;
Â  Â  Â  Â  Â  Â  font-weight: 900;
Â  Â  Â  Â  Â  Â  color: #ffd700;Â 
Â  Â  Â  Â  Â  Â  font-size: 8rem;
Â  Â  Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  animation: wormSlide 1.2s cubic-bezier(0.25, 1, 0.5, 1) forwards,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â glow-sync 2s 1.2s cubic-bezier(0.25, 1, 0.5, 1) infinite alternate;
Â  Â  Â  Â  }

Â  Â  Â  Â  .elegant-text {
Â  Â  Â  Â  Â  Â  font-family: 'Cairo', sans-serif;
Â  Â  Â  Â  Â  Â  color: #ffd700;
Â  Â  Â  Â  Â  Â  letter-spacing: 1px;
Â  Â  Â  Â  Â  Â  text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  animation: fadeUpText 0.8s 1s forwards;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-slide-in { animation: slideIn 0.35s forwards cubic-bezier(0.175, 0.885, 0.32, 1.1); }
Â  Â  Â  Â  .modal-slide-out { animation: slideOut 0.3s forwards cubic-bezier(0.4, 0, 0.2, 1); }
Â  Â  Â  Â  @keyframes slideIn { from { transform: translateX(100%); opacity: 0.8; } to { transform: translateX(0); opacity: 1; } }
Â  Â  Â  Â  @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }

Â  Â  Â  Â  .btn-tap {
Â  Â  Â  Â  Â  Â  transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-tap:active { transform: scale(0.95); opacity: 0.8; }

Â  Â  Â  Â  .bg-xylo { background: linear-gradient(135deg, #1d4ed8, #6d28d9); }
Â  Â  Â  Â  .text-xylo { color: #4f46e5; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .ptr-container { transition: transform 0.3s ease; position: relative; }
Â  Â  Â  Â  #ptr-spinner { position: absolute; top: -50px; left: 50%; transform: translateX(-50%); z-index: 50; opacity: 0; transition: opacity 0.2s; }
Â  Â  Â  Â  .text-unread { font-weight: 900 !important; color: #000 !important; }
Â  Â  Â  Â  body.dark-theme .text-unread { color: #fff !important; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #mentions-dropdown {
Â  Â  Â  Â  Â  Â  position: absolute; bottom: 100%; left: 0; right: 0; background: var(--card-bg); border-radius: 16px 16px 0 0;
Â  Â  Â  Â  Â  Â  box-shadow: 0 -5px 20px rgba(0,0,0,0.1); max-height: 200px; overflow-y: auto; z-index: 200; display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  .msg-row { transition: transform 0.2s ease-out; touch-action: pan-y; width: 100%; position: relative; }
Â  Â  Â  Â  .reply-icon-indicator {
Â  Â  Â  Â  Â  Â  position: absolute; top: 50%; transform: translateY(-50%);
Â  Â  Â  Â  Â  Â  opacity: 0; transition: opacity 0.2s; color: var(--text-color); font-size: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .sub-tab-active { border-bottom: 2px solid #2563eb; color: #2563eb; font-weight: bold; }
Â  Â  Â  Â  .sub-tab-inactive { border-bottom: 2px solid transparent; color: #6b7280; font-weight: normal; }

Â  Â  Â  Â  .reaction-badge {
Â  Â  Â  Â  Â  Â  position: absolute; bottom: -8px;Â 
Â  Â  Â  Â  Â  Â  background: rgba(255,255,255,0.9); border-radius: 50%; padding: 2px; font-size: 14px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.2); animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }

Â  Â  Â  Â  .friends-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(3, 1fr);
Â  Â  Â  Â  Â  Â  gap: 12px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .story-ring {
Â  Â  Â  Â  Â  Â  padding: 2px;
Â  Â  Â  Â  Â  Â  background: linear-gradient(45deg, #3b82f6, #8b5cf6, #ec4899);
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .story-ring.viewed {
Â  Â  Â  Â  Â  Â  background: #9ca3af;
Â  Â  Â  Â  }

Â  Â  Â  Â  #chat-modal {
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  height: calc(var(--vh, 1vh) * 100);
Â  Â  Â  Â  }

Â  Â  Â  Â  .telegram-menu {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.85);
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(15px);
Â  Â  Â  Â  Â  Â  -webkit-backdrop-filter: blur(15px);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(0,0,0,0.05);
Â  Â  Â  Â  Â  Â  border-radius: 16px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 40px rgba(0,0,0,0.15);
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  width: 240px;
Â  Â  Â  Â  Â  Â  transform-origin: center bottom;
Â  Â  Â  Â  Â  Â  animation: popTelegram 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.1) forwards;
Â  Â  Â  Â  }
Â  Â  Â  Â  body.dark-theme .telegram-menu {
Â  Â  Â  Â  Â  Â  background: rgba(30, 41, 59, 0.85);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255,255,255,0.05);
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes popTelegram { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

Â  Â  Â  Â  @keyframes floatPet {
Â  Â  Â  Â  Â  Â  0%, 100% { transform: translateY(0px) rotate(0deg); }
Â  Â  Â  Â  Â  Â  50% { transform: translateY(-4px) rotate(2deg); }
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes breathePet {
Â  Â  Â  Â  Â  Â  0%, 100% { transform: scale(1); }
Â  Â  Â  Â  Â  Â  50% { transform: scale(1.03); }
Â  Â  Â  Â  }
Â  Â  Â  Â  .pet-animate {Â 
Â  Â  Â  Â  Â  Â  animation: floatPet 3s ease-in-out infinite, breathePet 4s ease-in-out infinite;Â 
Â  Â  Â  Â  Â  Â  transform-origin: center bottom;
Â  Â  Â  Â  }
Â  Â  Â  Â  .pet-glow-gold { filter: drop-shadow(0 0 12px rgba(255,215,0,0.8)); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .pet-popup-overlay {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  bottom: 0;
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.5);
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(3px);
Â  Â  Â  Â  Â  Â  z-index: 9999;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  visibility: hidden;
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  }

Â  Â  Â  Â  .pet-popup-overlay.show {
Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  Â  Â  visibility: visible;
Â  Â  Â  Â  }

Â  Â  Â  Â  .pet-popup-content {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #fff8e7, #ffecd6);
Â  Â  Â  Â  Â  Â  color: #1f2937;
Â  Â  Â  Â  Â  Â  padding: 30px 25px;
Â  Â  Â  Â  Â  Â  border-radius: 40px;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  line-height: 1.6;
Â  Â  Â  Â  Â  Â  max-width: 85%;
Â  Â  Â  Â  Â  Â  width: 350px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  box-shadow: 0 30px 60px rgba(0,0,0,0.3), 0 0 0 3px rgba(255,215,0,0.4);
Â  Â  Â  Â  Â  Â  transform: scale(0.8);
Â  Â  Â  Â  Â  Â  transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255,215,0,0.5);
Â  Â  Â  Â  Â  Â  word-break: break-word;
Â  Â  Â  Â  Â  Â  white-space: pre-wrap;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  animation: floatPopup 3s ease-in-out infinite;
Â  Â  Â  Â  }

Â  Â  Â  Â  .pet-popup-content.show {
Â  Â  Â  Â  Â  Â  transform: scale(1);
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes floatPopup {
Â  Â  Â  Â  Â  Â  0%, 100% { transform: translateY(0px) scale(1); }
Â  Â  Â  Â  Â  Â  50% { transform: translateY(-10px) scale(1.02); }
Â  Â  Â  Â  }

Â  Â  Â  Â  .pet-popup-content::before {
Â  Â  Â  Â  Â  Â  content: 'âœ¨';
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: -15px;
Â  Â  Â  Â  Â  Â  left: 20px;
Â  Â  Â  Â  Â  Â  font-size: 30px;
Â  Â  Â  Â  Â  Â  filter: drop-shadow(0 5px 5px rgba(255,215,0,0.5));
Â  Â  Â  Â  }

Â  Â  Â  Â  .pet-popup-content::after {
Â  Â  Â  Â  Â  Â  content: 'ğŸ’¬';
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  bottom: -15px;
Â  Â  Â  Â  Â  Â  right: 20px;
Â  Â  Â  Â  Â  Â  font-size: 30px;
Â  Â  Â  Â  Â  Â  filter: drop-shadow(0 5px 5px rgba(255,215,0,0.5));
Â  Â  Â  Â  }

Â  Â  Â  Â  body.dark-theme .pet-popup-content {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #2d3748, #1a2634);
Â  Â  Â  Â  Â  Â  color: #f9fafb;
Â  Â  Â  Â  Â  Â  box-shadow: 0 30px 60px rgba(0,0,0,0.5), 0 0 0 3px rgba(255,215,0,0.3);
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes blinkCursor {
Â  Â  Â  Â  Â  Â  0%, 100% { opacity: 1; }
Â  Â  Â  Â  Â  Â  50% { opacity: 0; }
Â  Â  Â  Â  }
Â  Â  Â  Â  .typing-cursor::after {
Â  Â  Â  Â  Â  Â  content: '|';
Â  Â  Â  Â  Â  Â  animation: blinkCursor 1s infinite;
Â  Â  Â  Â  Â  Â  margin-right: 2px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .link-internal {
Â  Â  Â  Â  Â  Â  color: #2563eb;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  text-decoration: underline;
Â  Â  Â  Â  Â  Â  text-decoration-style: dotted;
Â  Â  Â  Â  }
Â  Â  Â  Â  body.dark-theme .link-internal {
Â  Â  Â  Â  Â  Â  color: #4ade80;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .link-external {
Â  Â  Â  Â  Â  Â  color: #2563eb;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  cursor: default;
Â  Â  Â  Â  }
Â  Â  Â  Â  body.dark-theme .link-external {
Â  Â  Â  Â  Â  Â  color: #4ade80;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .selectable-text {
Â  Â  Â  Â  Â  Â  -webkit-user-select: all;
Â  Â  Â  Â  Â  Â  user-select: all;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .pin-popup {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.95);
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  Â  Â  Â  border-radius: 28px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
Â  Â  Â  Â  Â  Â  width: 300px;
Â  Â  Â  Â  Â  Â  animation: pinPopup 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
Â  Â  Â  Â  }
Â  Â  Â  Â  body.dark-theme .pin-popup {
Â  Â  Â  Â  Â  Â  background: rgba(30, 41, 59, 0.95);
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes pinPopup {
Â  Â  Â  Â  Â  Â  0% { transform: scale(0.8); opacity: 0; }
Â  Â  Â  Â  Â  Â  100% { transform: scale(1); opacity: 1; }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .pin-option {
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .pin-option:active {
Â  Â  Â  Â  Â  Â  transform: scale(0.95);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .pin-love {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #ef4444, #dc2626);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  padding: 2px 10px;
Â  Â  Â  Â  Â  Â  font-size: 11px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 4px;
Â  Â  Â  Â  Â  Â  margin-right: 8px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .pin-normal {
Â  Â  Â  Â  Â  Â  background: #9ca3af;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  padding: 2px 10px;
Â  Â  Â  Â  Â  Â  font-size: 11px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 4px;
Â  Â  Â  Â  Â  Â  margin-right: 8px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .highlight-message {
Â  Â  Â  Â  Â  Â  animation: highlight 2s ease-in-out;
Â  Â  Â  Â  Â  Â  border: 2px solid #3b82f6 !important;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  body.dark-theme .highlight-message {
Â  Â  Â  Â  Â  Â  border: 2px solid #4ade80 !important;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes highlight {
Â  Â  Â  Â  Â  Â  0% { transform: scale(1); }
Â  Â  Â  Â  Â  Â  50% { transform: scale(1.02); background-color: rgba(59, 130, 246, 0.1); }
Â  Â  Â  Â  Â  Â  100% { transform: scale(1); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .profile-link-btn {
Â  Â  Â  Â  Â  Â  background: #f3f4f6;
Â  Â  Â  Â  Â  Â  color: #1f2937;
Â  Â  Â  Â  Â  Â  border-radius: 9999px;
Â  Â  Â  Â  Â  Â  padding: 8px 16px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  body.dark-theme .profile-link-btn {
Â  Â  Â  Â  Â  Â  background: #374151;
Â  Â  Â  Â  Â  Â  color: #f9fafb;
Â  Â  Â  Â  }
Â  Â  Â  Â  .profile-link-btn:active {
Â  Â  Â  Â  Â  Â  transform: scale(0.95);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .delete-popup {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.95);
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  Â  Â  Â  border-radius: 28px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
Â  Â  Â  Â  Â  Â  width: 320px;
Â  Â  Â  Â  Â  Â  animation: pinPopup 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
Â  Â  Â  Â  }
Â  Â  Â  Â  body.dark-theme .delete-popup {
Â  Â  Â  Â  Â  Â  background: rgba(30, 41, 59, 0.95);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #badge-requests {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 2px;
Â  Â  Â  Â  Â  Â  right: 20px;
Â  Â  Â  Â  Â  Â  width: 10px;
Â  Â  Â  Â  Â  Â  height: 10px;
Â  Â  Â  Â  Â  Â  background-color: #ef4444;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  border: 2px solid white;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .gender-option {
Â  Â  Â  Â  Â  Â  border: 2px solid transparent;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .gender-option.selected {
Â  Â  Â  Â  Â  Â  border-color: #3b82f6;
Â  Â  Â  Â  Â  Â  background-color: rgba(59, 130, 246, 0.1);
Â  Â  Â  Â  Â  Â  transform: scale(1.05);
Â  Â  Â  Â  }

Â  Â  Â  Â  .profile-header {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  padding-top: 60px;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  .profile-avatar-large {
Â  Â  Â  Â  Â  Â  width: 100px;
Â  Â  Â  Â  Â  Â  height: 100px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  border: 4px solid white;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .action-button {
Â  Â  Â  Â  Â  Â  background: rgba(255,255,255,0.2);
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255,255,255,0.3);
Â  Â  Â  Â  Â  Â  border-radius: 30px;
Â  Â  Â  Â  Â  Â  padding: 12px 24px;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .action-button:active {
Â  Â  Â  Â  Â  Â  transform: scale(0.95);
Â  Â  Â  Â  Â  Â  background: rgba(255,255,255,0.3);
Â  Â  Â  Â  }

Â  Â  Â  Â  .mute-badge {
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.5);
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  padding: 2px 8px;
Â  Â  Â  Â  Â  Â  font-size: 11px;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 4px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .create-post-container {
Â  Â  Â  Â  Â  Â  background: var(--card-bg);
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  margin: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .create-post-textarea {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  min-height: 150px;
Â  Â  Â  Â  Â  Â  background: var(--bg-color);
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  color: var(--text-color);
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  resize: none;
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  .create-note-container {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .create-note-avatar {
Â  Â  Â  Â  Â  Â  width: 80px;
Â  Â  Â  Â  Â  Â  height: 80px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  border: 3px solid white;
Â  Â  Â  Â  Â  Â  margin: 20px auto;
Â  Â  Â  Â  }

Â  Â  Â  Â  .create-note-textarea {
Â  Â  Â  Â  Â  Â  background: transparent;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  min-height: 120px;
Â  Â  Â  Â  Â  Â  resize: none;
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â  .create-note-textarea::placeholder {
Â  Â  Â  Â  Â  Â  color: rgba(255,255,255,0.5);
Â  Â  Â  Â  }

Â  Â  Â  Â  .load-more-btn {
Â  Â  Â  Â  Â  Â  background: var(--card-bg);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-color);
Â  Â  Â  Â  Â  Â  border-radius: 30px;
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  margin: 10px auto;
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .load-more-btn:active {
Â  Â  Â  Â  Â  Â  transform: scale(0.95);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø§Ù„Ùƒ */
Â  Â  Â  Â  .admin-panel-btn {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #dc2626, #991b1b);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  margin-top: 16px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº */
Â  Â  Â  Â  .report-reason {
Â  Â  Â  Â  Â  Â  background: var(--bg-color);
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  Â  Â  border-radius: 16px;
Â  Â  Â  Â  Â  Â  margin: 4px 0;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-color);
Â  Â  Â  Â  }
Â  Â  Â  Â  .report-reason:active {
Â  Â  Â  Â  Â  Â  transform: scale(0.98);
Â  Â  Â  Â  Â  Â  background: rgba(239, 68, 68, 0.1);
Â  Â  Â  Â  Â  Â  border-color: #ef4444;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Ø²Ø± Ø§Ù„Ø¥Ø¨Ù„Ø§ØºØ§Øª ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
Â  Â  Â  Â  #admin-reports-badge {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: -2px;
Â  Â  Â  Â  Â  Â  right: 30px;
Â  Â  Â  Â  Â  Â  background-color: #ef4444;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 10px;
Â  Â  Â  Â  Â  Â  padding: 2px 6px;
Â  Â  Â  Â  Â  Â  border-radius: 9999px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  border: 2px solid var(--card-bg);
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="h-screen w-screen flex flex-col antialiased pb-safe theme-bg">

Â  Â  <!-- 1. Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
Â  Â  <div id="splash-screen" class="fixed inset-0 z-[100] flex flex-col items-center justify-center transition-opacity duration-500">
Â  Â  Â  Â  <div class="splash-content flex flex-col items-center justify-center">
Â  Â  Â  Â  Â  Â  <div class="elegant-z">Z</div>
Â  Â  Â  Â  Â  Â  <h1 class="text-6xl font-black elegant-text mt-2">Ø²Ø§ÙŠÙ„Ùˆ</h1>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- 2. Ù‚Ø³Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© -->
Â  Â  <div id="auth-screen" class="hidden fixed inset-0 z-50 bg-white overflow-y-auto hide-scrollbar smooth-scroll">
Â  Â  Â  Â  <div class="min-h-screen flex flex-col items-center justify-center p-6">
Â  Â  Â  Â  Â  Â  <h1 class="text-6xl font-black xylo-brand mb-10 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600" style="font-family: 'Cairo', sans-serif;">Ø²Ø§ÙŠÙ„Ùˆ</h1>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="login-form" class="w-full max-w-sm space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-center mb-6 text-gray-700">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="login-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full bg-gray-100 p-4 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-right dir-rtl">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="login-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" class="w-full bg-gray-100 p-4 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-right dir-rtl">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="Auth.login()" class="btn-tap w-full bg-xylo text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-500/30">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between text-sm text-blue-600 font-semibold mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.switchAuth('register')" class="p-2 btn-tap">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.switchAuth('forgot')" class="p-2 btn-tap">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="register-form" class="hidden w-full max-w-sm space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-center mb-6 text-gray-700">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="reg-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨" class="w-full bg-gray-100 p-4 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-right dir-rtl">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="reg-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full bg-gray-100 p-4 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-right dir-rtl">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="reg-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" class="w-full bg-gray-100 p-4 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-right dir-rtl">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="Auth.register()" class="btn-tap w-full bg-xylo text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-500/30">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø©</button>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.switchAuth('login')" class="w-full text-center text-blue-600 font-semibold mt-4 p-2 btn-tap">Ù„Ø¯ÙŠ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="forgot-form" class="hidden w-full max-w-sm space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-center mb-6 text-gray-700">Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500 text-center mb-4">Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ø§Ø¨Ø·Ø§Ù‹ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="forgot-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full bg-gray-100 p-4 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-right dir-rtl">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="Auth.resetPassword()" class="btn-tap w-full bg-xylo text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-500/30">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.switchAuth('login')" class="w-full text-center text-blue-600 font-semibold mt-4 p-2 btn-tap">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- 3. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³ -->
Â  Â  <div id="setup-profile-screen" class="hidden fixed inset-0 z-[60] bg-white flex flex-col items-center justify-center p-6 smooth-scroll">
Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-2 text-center text-gray-800">Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ù„Ù„Ø­Ø³Ø§Ø¨</h2>
Â  Â  Â  Â  <p class="text-gray-500 mb-4 text-center">Ø§Ø¬Ø¹Ù„ Ø­Ø³Ø§Ø¨Ùƒ Ù…Ù…ÙŠØ²Ø§Ù‹ Ø¨Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©</p>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <label for="profile-upload" class="relative cursor-pointer mb-4 btn-tap inline-block">
Â  Â  Â  Â  Â  Â  <div id="profile-preview-container" class="w-40 h-40 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden border-4 border-dashed border-blue-400 shadow-inner">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-camera text-5xl text-gray-400"></i>
Â  Â  Â  Â  Â  Â  Â  Â  <img id="profile-preview-img" class="hidden w-full h-full object-cover">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="absolute bottom-1 right-1 bg-blue-600 p-3 rounded-full text-white border-4 border-white shadow-md">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-plus font-bold text-lg"></i>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <input type="file" id="profile-upload" accept="image/*" class="hidden" onchange="Auth.handleImageUpload(event)">
Â  Â  Â  Â  </label>

Â  Â  Â  Â  <div class="w-full max-w-xs mb-6">
Â  Â  Â  Â  Â  Â  <p class="text-center text-gray-700 font-bold mb-3">Ø§Ø®ØªØ± Ø¬Ù†Ø³Ùƒ</p>
Â  Â  Â  Â  Â  Â  <div class="flex gap-4 justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="gender-male" class="gender-option flex flex-col items-center p-4 rounded-2xl bg-gray-100 cursor-pointer btn-tap" onclick="App.selectGender('male')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph-fill ph-gender-male text-4xl text-blue-600"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold mt-1">ÙˆÙ„Ø¯</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="gender-female" class="gender-option flex flex-col items-center p-4 rounded-2xl bg-gray-100 cursor-pointer btn-tap" onclick="App.selectGender('female')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph-fill ph-gender-female text-4xl text-pink-600"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold mt-1">Ø¨Ù†Øª</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p id="gender-error" class="text-red-500 text-xs text-center mt-2 hidden">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button onclick="Auth.completeProfileSetup()" class="btn-tap w-full max-w-xs bg-xylo text-white font-bold py-4 rounded-xl shadow-lg">Ø§Ù„ØªØ§Ù„ÙŠ</button>
Â  Â  </div>

Â  Â  <!-- 4. Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
Â  Â  <div id="main-app" class="hidden flex-1 flex flex-col h-screen w-full relative">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <header class="theme-nav px-4 py-3 flex justify-between items-center z-20 relative shadow-sm border-b">
Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-black text-blue-600" style="font-family: 'Cairo', sans-serif;">Ø²Ø§ÙŠÙ„Ùˆ</h1>
Â  Â  Â  Â  Â  Â  <div class="flex gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.openModal('search-modal')" class="w-10 h-10 rounded-full theme-card flex items-center justify-center btn-tap border">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-magnifying-glass text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <nav class="theme-nav w-full z-10 shadow-sm sticky top-0 border-b">
Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center px-2">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.switchTab('home')" class="nav-btn flex-1 py-3 flex flex-col items-center gap-1 text-blue-600 border-b-2 border-blue-600 transition-colors btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph-fill ph-house text-2xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.switchTab('notes')" class="nav-btn flex-1 py-3 flex flex-col items-center gap-1 text-gray-500 border-b-2 border-transparent transition-colors btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-users text-2xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="badge-requests" class="hidden absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white shadow-sm"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.switchTab('messages')" class="nav-btn flex-1 py-3 flex flex-col items-center gap-1 text-gray-500 border-b-2 border-transparent transition-colors relative btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-chat-circle-text text-2xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="badge-messages" class="hidden absolute top-1 right-1/4 bg-blue-600 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center border-2 border-white"></span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.switchTab('notifications')" class="nav-btn flex-1 py-3 flex flex-col items-center gap-1 text-gray-500 border-b-2 border-transparent transition-colors relative btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-bell text-2xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="badge-notifications" class="hidden absolute top-2 right-1/4 w-3 h-3 bg-red-500 rounded-full border-2 border-white"></span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.switchTab('settings')" class="nav-btn flex-1 py-3 flex flex-col items-center gap-1 text-gray-500 border-b-2 border-transparent transition-colors btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-list text-2xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </nav>

Â  Â  Â  Â  <main class="flex-1 overflow-y-auto hide-scrollbar smooth-scroll relative ptr-container" id="main-content-area">
Â  Â  Â  Â  Â  Â  <div id="ptr-spinner" class="w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-arrow-circle-down animate-spin text-blue-600 text-2xl"></i>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
Â  Â  Â  Â  Â  Â  <div id="tab-home" class="p-2 space-y-3 pb-6">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="theme-card p-3 rounded-xl shadow-sm flex gap-3 items-center border">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="current-user-avatar-home" src="" class="w-10 h-10 rounded-full bg-gray-200 object-cover border border-gray-100 cursor-pointer btn-tap" onclick="UI.openModal('profile-modal', window.currentUser.uid)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 theme-bg hover:opacity-80 transition-colors rounded-full px-4 py-2.5 flex items-center cursor-pointer btn-tap" onclick="UI.openModal('create-post-modal')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm opacity-60">Ø¨Ù… ØªÙÙƒØ±ØŸ</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="feed-container" class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center text-gray-400 py-10"><i class="ph ph-spinner-gap animate-spin text-3xl mx-auto mb-2"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
Â  Â  Â  Â  Â  Â  <div id="tab-messages" class="hidden p-2">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center p-2 mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold theme-text">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h2>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="chats-container" class="theme-card rounded-xl shadow-sm overflow-hidden min-h-[400px] border">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
Â  Â  Â  Â  Â  Â  <div id="tab-notes" class="hidden p-2 space-y-3 flex flex-col h-full">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="theme-card rounded-xl shadow-sm p-4 shrink-0 border">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex overflow-x-auto smooth-scroll hide-scrollbar gap-4 pb-2 pt-2 items-start" id="notes-container" style="scroll-snap-type: x mandatory;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="inline-flex flex-col items-center relative cursor-pointer shrink-0 btn-tap w-16" onclick="App.checkAndCreateNote()" style="scroll-snap-align: start;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="current-user-avatar-note" class="w-16 h-16 rounded-full object-cover border-2 border-transparent p-0.5" style="border-color: var(--bg-color);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute bottom-0 right-0 bg-blue-600 rounded-full p-1 border-2" style="border-color: var(--card-bg);" id="my-note-plus-icon">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-plus text-white text-xs font-bold"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[11px] font-bold mt-1 w-full text-center truncate theme-text">Ø£Ù†Øª</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="theme-card rounded-xl shadow-sm flex-1 flex flex-col overflow-hidden border">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex border-b" style="border-color: var(--border-color);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.switchFriendsSubTab('requests')" id="subtab-requests" class="flex-1 py-3 text-center text-sm font-bold sub-tab-active btn-tap transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="relative inline-block">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Ø§Ù„Ø·Ù„Ø¨Ø§Øª
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="badge-requests-subtab" class="hidden absolute -top-1 -left-2 w-2 h-2 bg-red-500 rounded-full"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.switchFriendsSubTab('friends')" id="subtab-friends" class="flex-1 py-3 text-center text-sm font-bold sub-tab-inactive btn-tap transition-colors">Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.switchFriendsSubTab('suggestions')" id="subtab-suggestions" class="flex-1 py-3 text-center text-sm font-bold sub-tab-inactive btn-tap transition-colors">Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 overflow-y-auto smooth-scroll p-3 relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="subtab-content-requests" class="space-y-3"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="subtab-content-friends" class="hidden space-y-3"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="subtab-content-suggestions" class="hidden space-y-3"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
Â  Â  Â  Â  Â  Â  <div id="tab-notifications" class="hidden p-2">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold p-2 mb-2 theme-text">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="notifications-container" class="theme-card rounded-xl shadow-sm overflow-hidden min-h-[400px] border">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø®Ø§Ù…Ø³: Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
Â  Â  Â  Â  Â  Â  <div id="tab-settings" class="hidden p-4">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-6 theme-text">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="theme-card rounded-xl p-4 shadow-sm flex items-center gap-4 mb-6 cursor-pointer btn-tap border" onclick="UI.openModal('profile-modal', window.currentUser.uid)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="settings-avatar" src="" class="w-14 h-14 rounded-full object-cover bg-gray-200 border border-gray-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 flex items-center gap-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 id="settings-name" class="font-bold text-lg leading-tight theme-text">...</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-caret-left text-gray-400 text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full theme-card p-4 rounded-xl shadow-sm border flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center"><i class="ph-fill ph-moon text-xl"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="theme-text-label" class="font-semibold text-right theme-text">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="relative inline-flex items-center cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="theme-toggle" class="sr-only peer" onchange="App.toggleTheme(this.checked)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.openModal('edit-profile-modal')" class="w-full theme-card p-4 rounded-xl shadow-sm border flex items-center gap-4 btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center"><i class="ph-fill ph-user-pen text-xl"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold flex-1 text-right theme-text">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-caret-left text-gray-400"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.openModal('privacy-modal')" class="w-full theme-card p-4 rounded-xl shadow-sm border flex items-center gap-4 btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center"><i class="ph-fill ph-lock-key text-xl"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold flex-1 text-right theme-text">Ø§Ù„Ø®ØµÙˆØµÙŠØ©</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-caret-left text-gray-400"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.openModal('account-settings-modal')" class="w-full theme-card p-4 rounded-xl shadow-sm border flex items-center gap-4 btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center"><i class="ph-fill ph-gear text-xl"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold flex-1 text-right theme-text">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø£Ù…Ø§Ù†</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-caret-left text-gray-400"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ù…Ø§Ù„Ùƒ -->
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="admin-panel-btn" onclick="UI.openModal('admin-panel-modal')" class="hidden admin-panel-btn w-full p-4 rounded-xl shadow-sm flex items-center gap-4 btn-tap border border-red-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 rounded-full bg-red-100 text-red-600 flex items-center justify-center"><i class="ph-fill ph-shield text-xl"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold flex-1 text-right text-white">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="admin-reports-badge" class="hidden">0</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-caret-left text-white"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="Auth.logout()" class="w-full bg-red-50 p-4 rounded-xl shadow-sm flex items-center gap-4 btn-tap mt-8 border border-red-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 rounded-full bg-red-100 text-red-600 flex items-center justify-center"><i class="ph-fill ph-sign-out text-xl"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold flex-1 text-right text-red-600">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </main>
Â  Â  </div>

Â  Â  <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… -->
Â  Â  <div id="msg-box" class="fixed top-10 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-2xl z-[200] opacity-0 pointer-events-none transition-opacity duration-300 flex items-center gap-2 text-sm font-semibold">
Â  Â  Â  Â  <span id="msg-box-text">Ø±Ø³Ø§Ù„Ø©</span>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø­Ø« -->
Â  Â  <div id="search-modal" class="hidden fixed inset-0 theme-bg z-[70] flex flex-col modal-slide-in">
Â  Â  Â  Â  <div class="p-4 theme-card border-b flex items-center gap-3">
Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('search-modal')" class="p-2 theme-bg rounded-full btn-tap"><i class="ph ph-arrow-right text-lg"></i></button>
Â  Â  Â  Â  Â  Â  <div class="flex-1 relative">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="search-input" oninput="App.searchUsers()" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ØµØ¯Ù‚Ø§Ø¡..." class="w-full theme-bg border rounded-full py-2.5 px-4 pr-10 outline-none focus:ring-2 focus:ring-blue-100 theme-text">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-magnifying-glass absolute right-3 top-3 opacity-50 text-lg"></i>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="search-results" class="flex-1 overflow-y-auto smooth-scroll p-2 space-y-1">
Â  Â  Â  Â  Â  Â  <div class="text-center opacity-50 py-10 mt-10">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-magnifying-glass text-4xl mb-2 block mx-auto"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="mentions-dropdown" class="smooth-scroll border-t-2 border-blue-500 theme-card"></div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø´ÙˆØ± -->
Â  Â  <div id="create-post-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[110] flex items-center justify-center p-4">
Â  Â  Â  Â  <div class="theme-card rounded-3xl w-full max-w-sm overflow-hidden modal-slide-in shadow-2xl relative border">
Â  Â  Â  Â  Â  Â  <div class="p-4 border-b flex items-center justify-between z-10">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('create-post-modal')" class="p-2 font-bold text-gray-500 btn-tap rounded-lg">Ø¥Ù„ØºØ§Ø¡</button>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø´ÙˆØ±</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.createPost()" class="bg-blue-600 text-white px-5 py-1.5 rounded-full font-bold btn-tap shadow-md">Ù†Ø´Ø±</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-5 flex flex-col items-center">
Â  Â  Â  Â  Â  Â  Â  Â  <img id="create-post-avatar" src="" class="w-14 h-14 rounded-full object-cover border border-gray-100 mb-4 shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="post-text-input" placeholder="Ø¨Ù… ØªÙÙƒØ±ØŸ Ø§Ø³ØªØ®Ø¯Ù… @ Ù„Ø°ÙƒØ± ØµØ¯ÙŠÙ‚" class="w-full theme-bg border border-[var(--border-color)] rounded-2xl p-4 text-center font-semibold text-lg outline-none resize-none theme-text min-h-[120px]" rows="4"></textarea>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø§Ø­Ø¸Ø© -->
Â  Â  <div id="create-note-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[110] flex items-center justify-center p-4">
Â  Â  Â  Â  <div class="w-full max-w-sm overflow-hidden modal-slide-in shadow-2xl relative rounded-3xl" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
Â  Â  Â  Â  Â  Â  <div class="p-4 flex items-center justify-between w-full">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('create-note-modal')" class="p-2 text-white font-bold btn-tap drop-shadow-md">Ø¥Ù„ØºØ§Ø¡</button>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-white text-lg">Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.createNote()" class="bg-white text-purple-700 px-5 py-1.5 rounded-full font-bold btn-tap shadow-md">Ù…Ø´Ø§Ø±ÙƒØ©</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-6 flex flex-col items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  <img id="create-note-preview-avatar" src="" class="w-20 h-20 rounded-full border-4 border-white shadow-lg mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="note-text-input" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù€ 24 Ø³Ø§Ø¹Ø©..." class="w-full bg-transparent border-none text-white text-2xl font-bold text-center outline-none resize-none placeholder-white/60" rows="3" maxlength="60"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-white/50 text-xs mt-2">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 60 Ø­Ø±ÙØ§Ù‹</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="note-view-modal" class="hidden fixed inset-0 bg-black/95 z-[100] flex flex-col modal-slide-in select-none">
Â  Â  Â  Â  <div id="story-progress-container" class="absolute top-2 left-2 right-2 flex gap-1 z-20">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="p-4 pt-6 flex items-center gap-3 absolute top-0 w-full z-10 bg-gradient-to-b from-black/80 to-transparent">
Â  Â  Â  Â  Â  Â  <img id="nv-avatar" class="w-10 h-10 rounded-full border border-gray-600 object-cover cursor-pointer btn-tap" onclick="App.viewProfileFromNote()">
Â  Â  Â  Â  Â  Â  <div class="flex-1 flex flex-col cursor-pointer" onclick="App.viewProfileFromNote()">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 id="nv-name" class="text-white font-bold text-sm">...</h3>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="nv-time" class="text-gray-300 text-[10px]">...</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button id="nv-options-btn" class="hidden w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center btn-tap"><i class="ph ph-dots-three-vertical text-xl"></i></button>
Â  Â  Â  Â  Â  Â  <button onclick="App.closeStoryViewer()" class="w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center btn-tap"><i class="ph ph-x text-lg"></i></button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="absolute inset-0 z-0 flex">
Â  Â  Â  Â  Â  Â  <div class="w-1/3 h-full cursor-pointer" onclick="App.prevStory()"></div>
Â  Â  Â  Â  Â  Â  <div id="story-pause-area" class="w-1/3 h-full cursor-pointer"></div>
Â  Â  Â  Â  Â  Â  <div class="w-1/3 h-full cursor-pointer" onclick="App.nextStory()"></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="flex-1 flex items-center justify-center p-6 relative pointer-events-none">
Â  Â  Â  Â  Â  Â  <div id="nv-text" class="text-white text-3xl font-black text-center leading-relaxed whitespace-pre-wrap drop-shadow-lg">...</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="note-bottom-section" class="p-4 w-full flex flex-col gap-3 z-10 bg-gradient-to-t from-black/80 to-transparent pb-safe relative">
Â  Â  Â  Â  Â  Â  <div id="note-reply-section" class="hidden flex gap-3 items-center w-full">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="note-reply-input" placeholder="Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©..." class="flex-1 bg-white/10 text-white placeholder-white/50 border border-white/20 rounded-full px-5 py-3 outline-none text-sm focus:bg-white/20 transition-colors backdrop-blur-sm relative z-20">
Â  Â  Â  Â  Â  Â  Â  Â  <button onmousedown="event.preventDefault(); App.sendNoteReply();" class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center btn-tap shadow-lg shrink-0 relative z-20"><i class="ph-fill ph-paper-plane-right text-xl"></i></button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="note-viewers-section" class="hidden flex flex-col items-center w-full relative z-20">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.showNoteViewers()" class="flex flex-col items-center gap-1 text-white opacity-80 hover:opacity-100 transition-opacity btn-tap p-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-eye text-2xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="note-viewers-count" class="text-sm font-bold">0</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ† Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
Â  Â  <div id="viewers-list-modal" class="hidden fixed inset-0 z-[110] flex flex-col justify-end bg-black/50">
Â  Â  Â  Â  <div class="theme-card w-full h-[60vh] rounded-t-3xl flex flex-col modal-slide-in shadow-2xl relative">
Â  Â  Â  Â  Â  Â  <div class="p-4 flex justify-between items-center border-b">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg"><i class="ph ph-eye"></i> Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙˆÙ†</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('viewers-list-modal')" class="w-8 h-8 theme-bg rounded-full flex items-center justify-center btn-tap"><i class="ph ph-x"></i></button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="viewers-list-container" class="flex-1 overflow-y-auto smooth-scroll p-2"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="manage-note-modal" class="hidden fixed inset-0 bg-black/60 z-[110] flex items-center justify-center p-4">
Â  Â  Â  Â  <div class="theme-card rounded-3xl w-full max-w-sm overflow-hidden modal-slide-in shadow-2xl relative border">
Â  Â  Â  Â  Â  Â  <div class="p-4 border-b text-center">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-lg">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</h3>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-4 space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="edit-note-input" class="w-full theme-bg p-4 rounded-xl outline-none text-center font-bold text-lg resize-none border" rows="2" maxlength="60"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.updateNote()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl btn-tap">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.deleteNote()" class="w-full bg-red-50 text-red-600 font-bold py-3 rounded-xl btn-tap">Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('manage-note-modal')" class="w-full opacity-60 font-bold py-3 rounded-xl btn-tap">Ø¥Ù„ØºØ§Ø¡</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª -->
Â  Â  <div id="comments-modal" class="hidden fixed inset-0 z-[80] flex flex-col justify-end bg-black/50">
Â  Â  Â  Â  <div class="theme-card w-full h-[85vh] rounded-t-3xl flex flex-col modal-slide-in shadow-[0_-10px_40px_rgba(0,0,0,0.1)] relative">
Â  Â  Â  Â  Â  Â  <div class="p-4 flex justify-between items-center border-b">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('comments-modal')" class="w-8 h-8 theme-bg rounded-full flex items-center justify-center btn-tap"><i class="ph ph-x"></i></button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="comments-list" class="flex-1 overflow-y-auto smooth-scroll p-4 space-y-5">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-3 border-t flex gap-2 items-center theme-card pb-safe z-10">
Â  Â  Â  Â  Â  Â  Â  Â  <img id="comment-my-avatar" src="" class="w-9 h-9 rounded-full object-cover">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="comment-input" placeholder="Ø§Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹... (Ø§Ø³ØªØ®Ø¯Ù… @)" class="flex-1 theme-bg border rounded-full px-4 py-2.5 outline-none text-sm transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  <button onmousedown="event.preventDefault(); App.addComment();" class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center btn-tap shrink-0 shadow-md"><i class="ph-fill ph-paper-plane-right"></i></button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
Â  Â  <div id="edit-profile-modal" class="hidden fixed inset-0 theme-bg z-[70] flex flex-col modal-slide-in">
Â  Â  Â  Â  <div class="p-4 border-b flex items-center gap-3 shadow-sm theme-card z-10">
Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('edit-profile-modal')" class="p-2 theme-bg rounded-full btn-tap"><i class="ph ph-arrow-right text-lg"></i></button>
Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg flex-1">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
Â  Â  Â  Â  Â  Â  <button onclick="App.saveProfile()" class="bg-blue-600 text-white px-4 py-1.5 rounded-full font-bold btn-tap text-sm">Ø­ÙØ¸</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="p-6 space-y-6 overflow-y-auto smooth-scroll flex-1">
Â  Â  Â  Â  Â  Â  <div class="flex flex-col items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="edit-profile-pic" class="relative cursor-pointer group btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="edit-profile-img" src="" class="w-28 h-28 rounded-full object-cover border-4 border-gray-100 shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute bottom-0 right-0 bg-blue-600 p-2.5 rounded-full text-white border-2 border-white shadow-md"><i class="ph ph-camera"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="edit-profile-pic" accept="image/*" class="hidden" onchange="App.handleEditImage(event)">
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="theme-card p-4 rounded-2xl space-y-4 border">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="text-xs font-bold opacity-60 block mb-1">Ø§Ù„Ø§Ø³Ù…</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="edit-name" class="w-full bg-transparent border-b border-gray-300 py-2 outline-none focus:border-blue-600 font-bold text-lg transition-colors theme-text">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="text-xs font-bold opacity-60 block mb-1">Ø§Ù„Ù…Ø¹Ø±Ù (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙƒÙ„ 10 Ø£ÙŠØ§Ù…)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="edit-username" class="w-full bg-transparent border-b border-gray-300 py-2 outline-none focus:border-blue-600 dir-ltr text-left font-mono text-lg transition-colors disabled:opacity-50 theme-text" oninput="this.value = this.value.replace(/[^a-zA-Z0-9_.]/g, '')">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="text-xs font-bold opacity-60 block mb-1">Ø§Ù„Ù†Ø¨Ø°Ø©</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="edit-bio" class="w-full bg-transparent border-b border-gray-300 py-2 outline-none focus:border-blue-600 resize-none transition-colors theme-text" rows="3" placeholder="Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ø¹Ù† Ù†ÙØ³Ùƒ..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© -->
Â  Â  <div id="privacy-modal" class="hidden fixed inset-0 theme-bg z-[70] flex flex-col modal-slide-in">
Â  Â  Â  Â  <div class="theme-card p-4 border-b flex items-center gap-3 shadow-sm">
Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('privacy-modal')" class="p-2 theme-bg rounded-full btn-tap"><i class="ph ph-arrow-right text-lg"></i></button>
Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="p-4 space-y-3 smooth-scroll overflow-y-auto">
Â  Â  Â  Â  Â  Â  <div class="theme-card p-4 rounded-2xl shadow-sm flex justify-between items-center border">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold">Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ¯Ø§Ù‚Ø©</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-60 mt-0.5">Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø¢Ø®Ø±ÙŠÙ† Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ø§Øª Ù„Ùƒ</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="relative inline-flex items-center cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="priv-requests" class="sr-only peer" onchange="App.updatePrivacy('allowRequests', this.checked)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="theme-card p-4 rounded-2xl shadow-sm flex justify-between items-center border">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold">Ø­Ø³Ø§Ø¨ Ø®Ø§Øµ</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-60 mt-0.5">Ø¥Ø®ÙØ§Ø¡ Ù…Ù†Ø´ÙˆØ±Ø§ØªÙƒ Ø¹Ù† ØºÙŠØ± Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="relative inline-flex items-center cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="priv-private" class="sr-only peer" onchange="App.updatePrivacy('isPrivate', this.checked)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="theme-card p-4 rounded-2xl shadow-sm flex justify-between items-center border">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold">Ø§Ù„Ø¸Ù‡ÙˆØ± ÙÙŠ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-60 mt-0.5">Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="relative inline-flex items-center cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="priv-show-suggestions" class="sr-only peer" onchange="App.updatePrivacy('showInSuggestions', this.checked)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="theme-card p-4 rounded-2xl shadow-sm space-y-3 border">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold border-b pb-2">Ù…Ù† ÙŠÙ…ÙƒÙ†Ù‡ Ø±Ø¤ÙŠØ© Ø£ØµØ¯Ù‚Ø§Ø¦ÙŠ</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="priv-friends-vis" class="w-full theme-bg p-3 rounded-xl outline-none border focus:border-blue-500 theme-text" onchange="App.updatePrivacy('friendsVisibility', this.value)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="all">Ø§Ù„Ø¬Ù…ÙŠØ¹</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="friends">Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ÙÙ‚Ø·</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="only_me">Ø£Ù†Ø§ ÙÙ‚Ø·</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="theme-card p-4 rounded-2xl shadow-sm space-y-3 border">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold border-b pb-2">Ù…Ù† ÙŠÙ…ÙƒÙ†Ù‡ Ù…Ø±Ø§Ø³Ù„ØªÙŠ</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="priv-msgs" class="w-full theme-bg p-3 rounded-xl outline-none border focus:border-blue-500 theme-text" onchange="App.updatePrivacy('messagePrivacy', this.value)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="all">Ø§Ù„Ø¬Ù…ÙŠØ¹</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="friends">Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ÙÙ‚Ø·</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="only_me">Ø£Ù†Ø§ ÙÙ‚Ø·</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ† -->
Â  Â  <div id="account-settings-modal" class="hidden fixed inset-0 theme-bg z-[70] flex flex-col modal-slide-in">
Â  Â  Â  Â  <div class="theme-card p-4 border-b flex items-center gap-3 shadow-sm">
Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('account-settings-modal')" class="p-2 theme-bg rounded-full btn-tap"><i class="ph ph-arrow-right text-lg"></i></button>
Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø£Ù…Ø§Ù†</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="p-4 space-y-4">
Â  Â  Â  Â  Â  Â  <button onclick="UI.openModal('blocked-users-modal')" class="w-full theme-card p-5 rounded-2xl shadow-sm border flex items-center gap-4 btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-12 h-12 rounded-full bg-orange-50 text-orange-600 flex items-center justify-center"><i class="ph-fill ph-prohibit text-2xl"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 text-right">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-lg">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-60 mt-0.5">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-caret-left opacity-50"></i>
Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  <div class="theme-card rounded-2xl shadow-sm border overflow-hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="document.getElementById('password-section-content').classList.toggle('hidden'); this.querySelector('.chevron').classList.toggle('-rotate-90')" class="w-full p-5 flex items-center gap-4 btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-12 h-12 rounded-full bg-red-50 text-red-600 flex items-center justify-center"><i class="ph-fill ph-shield-warning text-2xl"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 text-right">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-lg">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-caret-down opacity-50 chevron transition-transform duration-300"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="password-section-content" class="hidden px-5 pb-5 pt-2 border-t">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-60 mb-4">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ù„Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ø¨Ø£Ù…Ø§Ù†.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="Auth.resetPasswordFromSettings()" class="w-full bg-red-50 text-red-600 font-bold py-3.5 rounded-xl border border-red-100 btn-tap">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØºÙŠÙŠØ±</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ† -->
Â  Â  <div id="blocked-users-modal" class="hidden fixed inset-0 theme-bg z-[80] flex flex-col modal-slide-in">
Â  Â  Â  Â  <div class="p-4 border-b flex items-center gap-3 shadow-sm theme-card z-10 sticky top-0">
Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('blocked-users-modal')" class="p-2 theme-bg rounded-full btn-tap"><i class="ph ph-arrow-right text-lg"></i></button>
Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg flex-1">Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="flex-1 overflow-y-auto smooth-scroll p-4" id="blocked-list-container">
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
Â  Â  <div id="profile-modal" class="hidden fixed inset-0 bg-gray-50 dark:bg-gray-900 z-[110] flex flex-col modal-slide-in">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="p-3 border-b flex items-center gap-3 theme-card shadow-sm sticky top-0 z-30">
Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('profile-modal')" class="p-2 theme-bg rounded-full btn-tap"><i class="ph ph-arrow-right text-lg"></i></button>
Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg flex-1">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="flex-1 overflow-y-auto smooth-scroll pb-10 relative">
Â  Â  Â  Â  Â  Â  <div class="flex flex-col items-center pt-6">
Â  Â  Â  Â  Â  Â  Â  Â  <img id="vp-image" src="" class="w-24 h-24 rounded-full object-cover shadow-sm border-2 border-white dark:border-gray-800">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 id="vp-name" class="text-xl font-bold text-gray-900 dark:text-white mt-3">...</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="vp-last-seen" class="text-gray-500 dark:text-gray-400 text-xs mt-1">Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ± ...</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="flex justify-center gap-2.5 mt-5 px-4" id="vp-action-container">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mt-6 w-full">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white dark:bg-gray-800 p-4 shadow-sm border-y border-gray-100 dark:border-gray-700 w-full text-center flex flex-col gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pb-3 border-b border-gray-100 dark:border-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-[10px] text-gray-400 mb-1.5">Ø§Ù„Ù†Ø¨Ø°Ø©</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="vp-bio" class="text-gray-800 dark:text-gray-200 text-[14px] font-medium whitespace-pre-wrap leading-relaxed inline-block">...</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-[10px] text-gray-400 mb-1.5">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="vp-username" class="text-gray-800 dark:text-gray-200 text-[14px] font-bold dir-ltr inline-block text-blue-600">@...</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="px-4 mt-6">
Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <!-- Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ -->
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-end mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-xl theme-text">Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-gray-500 font-bold" id="vp-friends-count-text">0</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="friends-grid" id="vp-friends-grid"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <!-- Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-8" id="vp-posts-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-xl theme-text mb-4">Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center opacity-50 py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
Â  Â  <div id="pin-chat-popup" class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-[150] flex items-center justify-center" onclick="if(event.target === this) UI.closeModal('pin-chat-popup')">
Â  Â  Â  Â  <div class="pin-popup overflow-hidden">
Â  Â  Â  Â  Â  Â  <div class="p-4 border-b text-center">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-lg">ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h3>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-4 flex flex-col gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.pinChat('love'); UI.closeModal('pin-chat-popup')" class="pin-option w-full bg-red-50 text-red-600 p-4 rounded-2xl flex items-center justify-between font-bold btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ØªØ«Ø¨ÙŠØª (Ø§Ù„Ø­Ø¨ ğŸŒšâ™¥)</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph-fill ph-heart text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.pinChat('normal'); UI.closeModal('pin-chat-popup')" class="pin-option w-full bg-gray-100 text-gray-700 p-4 rounded-2xl flex items-center justify-between font-bold btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ØªØ«Ø¨ÙŠØª (Ø´Ø®Øµ Ø¹Ø§Ø¯ÙŠ ğŸ™„)</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph-fill ph-push-pin text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.unpinChat(); UI.closeModal('pin-chat-popup')" class="pin-option w-full bg-gray-200 text-gray-800 p-4 rounded-2xl flex items-center justify-between font-bold btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph-fill ph-push-pin-slash text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
Â  Â  <div id="delete-chat-popup" class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-[150] flex items-center justify-center" onclick="if(event.target === this) UI.closeModal('delete-chat-popup')">
Â  Â  Â  Â  <div class="delete-popup overflow-hidden">
Â  Â  Â  Â  Â  Â  <div class="p-4 border-b text-center">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-lg">Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h3>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-4 flex flex-col gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.deleteChatHistory('me'); UI.closeModal('delete-chat-popup')" class="pin-option w-full bg-orange-50 text-orange-600 p-4 rounded-2xl flex items-center justify-between font-bold btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø­Ø°Ù Ù„Ø¯ÙŠ ÙÙ‚Ø·</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph-fill ph-trash text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.deleteChatHistory('everyone'); UI.closeModal('delete-chat-popup')" class="pin-option w-full bg-red-50 text-red-600 p-4 rounded-2xl flex items-center justify-between font-bold btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø­Ø°Ù Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù…ÙŠØ¹</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph-fill ph-trash-simple text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© ÙƒØªÙ… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
Â  Â  <div id="mute-chat-popup" class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-[150] flex items-center justify-center" onclick="if(event.target === this) UI.closeModal('mute-chat-popup')">
Â  Â  Â  Â  <div class="pin-popup overflow-hidden">
Â  Â  Â  Â  Â  Â  <div class="p-4 border-b text-center">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-lg">ÙƒØªÙ… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h3>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-4 flex flex-col gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.muteChat(1); UI.closeModal('mute-chat-popup')" class="pin-option w-full bg-gray-100 p-4 rounded-2xl flex items-center justify-between font-bold btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ù„Ù…Ø¯Ø© Ø³Ø§Ø¹Ø©</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.muteChat(24); UI.closeModal('mute-chat-popup')" class="pin-option w-full bg-gray-100 p-4 rounded-2xl flex items-center justify-between font-bold btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ù„Ù…Ø¯Ø© 24 Ø³Ø§Ø¹Ø©</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.muteChat(0); UI.closeModal('mute-chat-popup')" class="pin-option w-full bg-gray-200 p-4 rounded-2xl flex items-center justify-between font-bold btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØªÙ…</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="chat-modal" class="hidden fixed inset-0 theme-bg z-[90] flex flex-col modal-slide-in">
Â  Â  Â  Â  <div class="theme-card p-3 border-b flex items-center justify-between shadow-sm z-20 relative">
Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3 flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('chat-modal')" class="p-2 theme-bg border rounded-full btn-tap shrink-0" id="chat-back-button"><i class="ph ph-arrow-right text-lg"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative cursor-pointer shrink-0" onclick="UI.openModal('profile-modal', window.currentChatUserId)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="chat-user-img" src="" class="w-11 h-11 rounded-full object-cover">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="chat-online-dot" class="absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full hidden"></span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 overflow-hidden min-w-0 cursor-pointer" onclick="UI.openModal('profile-modal', window.currentChatUserId)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 id="chat-user-name" class="font-bold leading-tight truncate">...</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="chat-user-status" class="text-[11px] opacity-60 truncate mt-0.5">...</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.toggleMuteChat()" class="hidden w-9 h-9 rounded-full theme-bg border flex items-center justify-center btn-tap relative" id="chat-mute-btn">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-bell-simple-z text-lg"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="chat-pet-container" class="w-12 h-12 flex items-center justify-center relative shrink-0 cursor-pointer btn-tap"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="chat-background" class="flex-1 overflow-hidden flex flex-col relative chat-container-bg">
Â  Â  Â  Â  Â  Â  <div id="chat-messages-container" class="flex-1 overflow-y-auto smooth-scroll p-4 flex flex-col relative z-10 pb-4 overflow-x-hidden">
Â  Â Â 
Â  Â  <div id="live-typing-bubble" class="hidden bubble-other rounded-2xl rounded-bl-sm p-3 shadow-sm self-start mb-2 text-[15px] opacity-70 w-fit max-w-[80%] transition-all duration-300">
Â  Â  Â  Â  <span class="typing-cursor font-medium"></span>
Â  Â  </div>
</div>

Â  Â  Â  Â  <div id="replying-to-container" class="hidden theme-card border-t px-4 py-2 flex items-center justify-between shadow-[0_-2px_10px_rgba(0,0,0,0.02)] z-10 relative">
Â  Â  Â  Â  Â  Â  <div class="flex flex-col border-r-4 border-blue-500 pr-3">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs font-bold text-blue-600" id="reply-to-name">Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰...</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm opacity-80 truncate max-w-[250px]" id="reply-to-text">...</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button onclick="App.cancelReply()" class="w-8 h-8 rounded-full theme-bg flex items-center justify-center btn-tap"><i class="ph ph-x"></i></button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="p-3 theme-card border-t flex gap-2 items-end pb-safe z-20 relative">
Â  Â  Â  Â  Â  Â  <textarea id="chat-input" placeholder="Ø§Ù„Ø±Ø³Ø§Ù„Ø©..." class="flex-1 theme-bg border border-transparent rounded-3xl px-5 py-3 outline-none resize-none max-h-28 hide-scrollbar text-[15px] transition-colors theme-text focus:border-blue-500" rows="1" oninput="this.style.height = '';this.style.height = Math.min(this.scrollHeight, 112) + 'px'; App.handleTyping(this.value);"></textarea>
Â  Â  Â  Â  Â  Â  <button onmousedown="event.preventDefault(); App.sendMessage();" ontouchstart="event.preventDefault(); App.sendMessage();" class="w-12 h-12 bg-blue-600 hover:bg-blue-700 transition-colors text-white rounded-full flex items-center justify-center shrink-0 btn-tap shadow-md mb-0.5"><i class="ph-fill ph-paper-plane-right text-xl pointer-events-none"></i></button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

Â  Â  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
Â  Â  <div id="action-modal" class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-[100] flex items-center justify-center" onclick="if(event.target === this) UI.closeModal('action-modal')">
Â  Â  Â  Â  <div id="action-modal-content" class="telegram-menu flex flex-col text-sm font-semibold theme-text"></div>
Â  Â  </div>

Â  Â  <!-- Ø¹Ø±Ø¶ Ù…Ù†Ø´ÙˆØ± Ù…ÙØ±Ø¯ -->
Â  Â  <div id="single-post-modal" class="hidden fixed inset-0 theme-bg z-[85] flex flex-col modal-slide-in">
Â  Â  Â  Â  <div class="p-4 border-b flex items-center gap-3 theme-card shadow-sm sticky top-0 z-10">
Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('single-post-modal')" class="p-2 theme-bg rounded-full btn-tap"><i class="ph ph-arrow-right text-lg"></i></button>
Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="flex-1 overflow-y-auto smooth-scroll p-2" id="single-post-container"></div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù…Ù†Ø´ÙˆØ± (Ø¬Ø¯ÙŠØ¯Ø©) -->
Â  Â  <div id="report-post-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[120] flex items-center justify-center p-4">
Â  Â  Â  Â  <div class="theme-card rounded-3xl w-full max-w-sm overflow-hidden modal-slide-in shadow-2xl relative border">
Â  Â  Â  Â  Â  Â  <div class="p-4 border-b text-center">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-lg text-red-600">Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù…Ù†Ø´ÙˆØ±</h3>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-5">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm mb-4 text-center">Ø§Ø®ØªØ± Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº:</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="report-reason" onclick="App.submitReport('post', window.currentReportPostId, 'ØªØ­Ø±ÙŠØ¶')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold">ØªØ­Ø±ÙŠØ¶</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="report-reason" onclick="App.submitReport('post', window.currentReportPostId, 'Ø¥Ø³Ø§Ø¡Ø©')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold">Ø¥Ø³Ø§Ø¡Ø©</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="report-reason" onclick="App.submitReport('post', window.currentReportPostId, 'Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù„Ø§Ø¦Ù‚')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold">Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù„Ø§Ø¦Ù‚</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="report-reason" onclick="App.submitReport('post', window.currentReportPostId, 'Ø§Ù†ØªÙ‡Ø§Ùƒ Ø®ØµÙˆØµÙŠØ©')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold">Ø§Ù†ØªÙ‡Ø§Ùƒ Ø®ØµÙˆØµÙŠØ©</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="report-reason" onclick="App.submitReport('post', window.currentReportPostId, 'Ø³Ø¨Ø¨ Ø¢Ø®Ø±')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold">Ø³Ø¨Ø¨ Ø¢Ø®Ø±</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-4 border-t text-center">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('report-post-modal')" class="text-gray-500 font-bold py-2 px-4 rounded-xl btn-tap">Ø¥Ù„ØºØ§Ø¡</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ± (Ø¬Ø¯ÙŠØ¯Ø©) -->
Â  Â  <div id="edit-post-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[120] flex items-center justify-center p-4">
Â  Â  Â  Â  <div class="theme-card rounded-3xl w-full max-w-sm overflow-hidden modal-slide-in shadow-2xl relative border">
Â  Â  Â  Â  Â  Â  <div class="p-4 border-b flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('edit-post-modal')" class="p-2 font-bold text-gray-500 btn-tap rounded-lg">Ø¥Ù„ØºØ§Ø¡</button>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.updatePost()" class="bg-blue-600 text-white px-5 py-1.5 rounded-full font-bold btn-tap shadow-md">Ø­ÙØ¸</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-5">
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="edit-post-input" class="w-full bg-gray-50 dark:bg-gray-800 border rounded-2xl p-4 text-center font-semibold text-lg outline-none resize-none theme-text min-h-[120px]" rows="4"></textarea>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Ù†Ø§ÙØ°Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø§Ù„Ùƒ (Ø¬Ø¯ÙŠØ¯Ø©) -->
Â  Â  <div id="admin-panel-modal" class="hidden fixed inset-0 theme-bg z-[130] flex flex-col modal-slide-in">
Â  Â  Â  Â  <div class="p-4 border-b flex items-center gap-3 shadow-sm theme-card">
Â  Â  Â  Â  Â  Â  <button onclick="UI.closeModal('admin-panel-modal')" class="p-2 theme-bg rounded-full btn-tap"><i class="ph ph-arrow-right text-lg"></i></button>
Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg flex-1">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="flex-1 overflow-y-auto smooth-scroll p-4">
Â  Â  Â  Â  Â  Â  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø¯Ø§Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
Â  Â  Â  Â  Â  Â  <div class="flex gap-2 mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.switchAdminTab('reports')" id="admin-tab-reports" class="flex-1 py-3 text-center font-bold border-b-2 border-blue-600 text-blue-600 btn-tap">Ø§Ù„Ø¥Ø¨Ù„Ø§ØºØ§Øª</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.switchAdminTab('banned')" id="admin-tab-banned" class="flex-1 py-3 text-center font-bold border-b-2 border-transparent btn-tap">Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¨Ù„Ø§ØºØ§Øª -->
Â  Â  Â  Â  Â  Â  <div id="admin-reports-tab">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="reports-list" class="space-y-3"></div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ† -->
Â  Â  Â  Â  Â  Â  <div id="admin-banned-tab" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="theme-card p-4 rounded-xl border mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="admin-search-input" oninput="App.searchUsersForBan()" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ù…Ø¹Ø±Ù..." class="w-full theme-bg border rounded-full py-3 px-4 pr-10 outline-none focus:ring-2 focus:ring-red-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-magnifying-glass absolute right-3 top-3 opacity-50 text-lg"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="admin-search-results" class="mt-3 space-y-2"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.showBannedUsers()" class="w-full theme-card p-4 rounded-xl border flex items-center justify-center gap-2 btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-prohibit text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold">Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ† Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ† (ØªØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·) -->
Â  Â  Â  Â  Â  Â  Â  Â  <div id="banned-users-list" class="mt-4 hidden space-y-2"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="reactions-modal" class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-[150] flex items-center justify-center" onclick="if(event.target === this) UI.closeModal('reactions-modal')">
Â  Â  Â  Â  <div class="theme-card rounded-3xl p-5 shadow-2xl modal-slide-in w-[90%] max-w-sm border border-[var(--border-color)]">
Â  Â  Â  Â  Â  Â  <h3 class="text-center font-bold mb-4 text-sm opacity-60">Ø§Ø®ØªØ± ØªÙØ§Ø¹Ù„Ø§Ù‹</h3>
Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-5 gap-4 justify-items-center">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ‘ğŸ»')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ‘ğŸ»</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ‘ğŸ»')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ‘ğŸ»</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('â¤')" class="text-3xl btn-tap hover:scale-125 transition-transform">â¤</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ¤£')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ¤£</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ’”')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ’”</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸŒš')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸŒš</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ¥²')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ¥²</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ”¥')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ”¥</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ’•')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ’•</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ˜‰')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ˜‰</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ™‚')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ™‚</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ˜¢')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ˜¢</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ˜­')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ˜­</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ˜’')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ˜’</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ˜”')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ˜”</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ¥º')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ¥º</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ˜')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ˜</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ«£')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ«£</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.selectReaction('ğŸ’‹')" class="text-3xl btn-tap hover:scale-125 transition-transform">ğŸ’‹</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  Â  Â  import { getAuth, signInAnonymously, signInWithCustomToken, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
Â  Â  Â  Â  import { getFirestore, collection, doc, setDoc, getDoc, onSnapshot, addDoc, updateDoc, deleteDoc, arrayUnion, query, orderBy, limit, startAfter, getDocs, where, arrayRemove } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

Â  Â  Â  Â  let firebaseConfig;
Â  Â  Â  Â  if (typeof __firebase_config !== 'undefined') {
Â  Â  Â  Â  Â  Â  firebaseConfig = JSON.parse(__firebase_config);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  firebaseConfig = {
Â  Â  Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyDe7WeScgMaRAK7PzExvkzppb2XOcdAI0k",
Â  Â  Â  Â  Â  Â  Â  Â  authDomain: "communication-5dd27.firebaseapp.com",
Â  Â  Â  Â  Â  Â  Â  Â  databaseURL: "https://communication-5dd27-default-rtdb.firebaseio.com",
Â  Â  Â  Â  Â  Â  Â  Â  projectId: "communication-5dd27",
Â  Â  Â  Â  Â  Â  Â  Â  storageBucket: "communication-5dd27.firebasestorage.app",
Â  Â  Â  Â  Â  Â  Â  Â  messagingSenderId: "79255528858",
Â  Â  Â  Â  Â  Â  Â  Â  appId: "1:79255528858:web:6c75eee637561056b28623"
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }

Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const auth = getAuth(app);
Â  Â  Â  Â  const db = getFirestore(app);

Â  Â  Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'xylo-app-123';

Â  Â  Â  Â  const USERS_PATH = `artifacts/${appId}/public/data/users`;
Â  Â  Â  Â  const POSTS_PATH = `artifacts/${appId}/public/data/posts`;
Â  Â  Â  Â  const COMMENTS_PATH = `artifacts/${appId}/public/data/comments`;
Â  Â  Â  Â  const REQUESTS_PATH = `artifacts/${appId}/public/data/requests`;
Â  Â  Â  Â  const FRIENDS_PATH = `artifacts/${appId}/public/data/friends`;
Â  Â  Â  Â  const MESSAGES_PATH = `artifacts/${appId}/public/data/messages`;
Â  Â  Â  Â  const NOTES_PATH = `artifacts/${appId}/public/data/notes`;
Â  Â  Â  Â  const NOTIFS_PATH = `artifacts/${appId}/public/data/notifications`;
Â  Â  Â  Â  const TYPING_PATH = `artifacts/${appId}/public/data/typing`;Â 
Â  Â  Â  Â  const PINS_PATH = `artifacts/${appId}/public/data/pins`;
Â  Â  Â  Â  const MUTES_PATH = `artifacts/${appId}/public/data/mutes`;
Â  Â  Â  Â  const REPORTS_PATH = `artifacts/${appId}/public/data/reports`; // Ø¬Ø¯ÙŠØ¯
Â  Â  Â  Â  const BANNED_PATH = `artifacts/${appId}/public/data/banned`; // Ø¬Ø¯ÙŠØ¯

Â  Â  Â  Â  window.Memory = {
Â  Â  Â  Â  Â  Â  users: {}, posts: [], comments: [], requests: [], friends: [], messages: [], notes: [], notifications: [], pins: [], mutes: [], reports: [], banned: []
Â  Â  Â  Â  };

Â  Â  Â  Â  window.currentUser = null;
Â  Â  Â  Â  window.currentChatUserId = null;
Â  Â  Â  Â  window.currentPostIdForComment = null;
Â  Â  Â  Â  window.currentManageNoteId = null;
Â  Â  Â  Â  window.noteViewAuthorId = null;Â 
Â  Â  Â  Â  window.replyingToMessage = null;Â 
Â  Â  Â  Â  window.selectedGender = null;
Â  Â  Â  Â  window.selectedEditGender = null;
Â  Â  Â  Â  window.messagesLimit = 25;
Â  Â  Â  Â  window.lastVisibleMessage = null;
Â  Â  Â  Â  window.hasMoreMessages = true;
Â  Â  Â  Â  window.currentMessagePage = 0;
Â  Â  Â  Â  window.allMessages = [];
Â  Â  Â  Â  window.currentReportPostId = null; // Ø¬Ø¯ÙŠØ¯
Â  Â  Â  Â  window.currentEditPostId = null; // Ø¬Ø¯ÙŠØ¯
Â  Â  Â  Â  window.MASTER_EMAIL = "mslmalmyaly223@gmail.com"; // Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø§Ù„Ùƒ

Â  Â  Â  Â  if(window.visualViewport) {
Â  Â  Â  Â  Â  Â  window.visualViewport.addEventListener('resize', () => {
Â  Â  Â  Â  Â  Â  Â  Â  document.documentElement.style.setProperty('--vh', `${window.visualViewport.height * 0.01}px`);
Â  Â  Â  Â  Â  Â  Â  Â  const chatModal = document.getElementById('chat-modal');
Â  Â  Â  Â  Â  Â  Â  Â  if(!chatModal.classList.contains('hidden')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('chat-messages-container');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(container) container.scrollTop = container.scrollHeight;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.documentElement.style.setProperty('--vh', `${window.visualViewport.height * 0.01}px`);
Â  Â  Â  Â  }

Â  Â  Â  Â  const escapeHTML = (str) => {
Â  Â  Â  Â  Â  Â  if(!str) return '';
Â  Â  Â  Â  Â  Â  return str.replace(/[&<>'"]/g, tag => ({
Â  Â  Â  Â  Â  Â  Â  Â  '&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;'
Â  Â  Â  Â  Â  Â  }[tag] || tag));
Â  Â  Â  Â  };

Â  Â  Â  Â  // ØªØ¹Ø¯ÙŠÙ„ 10: ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ø¥Ù„Ù‰ Ù†ØµÙˆØµ
Â  Â  Â  Â  const parseTextWithLinks = (text, isMessage = false) => {
Â  Â  Â  Â  Â  Â  if(!text) return '';
Â  Â  Â  Â  Â  Â  const escaped = escapeHTML(text);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ù†Ù…Ø· Ù„Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù…
Â  Â  Â  Â  Â  Â  const urlRegex = /(https?:\/\/[^\s]+)/g;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let parsed = escaped.replace(urlRegex, (url) => {
Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ø§Ø¨Ø· Ù„ØªØ·Ø¨ÙŠÙ‚ Ø²Ø§ÙŠÙ„Ùˆ (ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ?post= Ø£Ùˆ ?user=)
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const urlObj = new URL(url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const postParam = urlObj.searchParams.get('post');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userParam = urlObj.searchParams.get('user');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(postParam) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `<span class="link-internal" onclick="event.stopPropagation(); App.openSinglePost('${postParam}')">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (userParam) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `<span class="link-internal" onclick="event.stopPropagation(); UI.openProfileByUsername('${userParam}')">Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø³Ø§Ø¨</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ - Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ø³Ø® Ø¨Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„
Â  Â  Â  Â  Â  Â  Â  Â  return `<span class="link-external selectable-text" title="Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ù„Ù„Ù†Ø³Ø®">${url}</span>`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ù†Ø´Ù†
Â  Â  Â  Â  Â  Â  parsed = parsed.replace(/@([\w_.]+)/g, (match, username) => {
Â  Â  Â  Â  Â  Â  Â  Â  const exists = Object.values(Memory.users).find(u => u.username === username);
Â  Â  Â  Â  Â  Â  Â  Â  if(exists) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `<span class="link-internal" onclick="event.stopPropagation(); UI.openProfileByUsername('${username}')">${match}</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return match;Â 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return parsed;
Â  Â  Â  Â  };

Â  Â  Â  Â  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¸ÙˆØ± Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
Â  Â  Â  Â  const isDeviceBanned = async (uid) => {
Â  Â  Â  Â  Â  Â  const bannedDoc = await getDoc(doc(db, BANNED_PATH, uid));
Â  Â  Â  Â  Â  Â  return bannedDoc.exists();
Â  Â  Â  Â  };

Â  Â  Â  Â  // Ø­Ø¸Ø± Ø¬Ù‡Ø§Ø² Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
Â  Â  Â  Â  const banDevice = async (uid) => {
Â  Â  Â  Â  Â  Â  const user = Memory.users[uid];
Â  Â  Â  Â  Â  Â  if(!user) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  await setDoc(doc(db, BANNED_PATH, uid), {
Â  Â  Â  Â  Â  Â  Â  Â  uid: uid,
Â  Â  Â  Â  Â  Â  Â  Â  email: user.email,
Â  Â  Â  Â  Â  Â  Â  Â  timestamp: Date.now()
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø­Ø§Ù„ÙŠØ§Ù‹
Â  Â  Â  Â  Â  Â  if(auth.currentUser && auth.currentUser.uid === uid) {
Â  Â  Â  Â  Â  Â  Â  Â  await signOut(auth);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // Ø¥Ù„ØºØ§Ø¡ Ø­Ø¸Ø± Ø¬Ù‡Ø§Ø²
Â  Â  Â  Â  const unbanDevice = async (uid) => {
Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, BANNED_PATH, uid));
Â  Â  Â  Â  };

Â  Â  Â  Â  window.PullToRefresh = {
Â  Â  Â  Â  Â  Â  startY: 0, isPulling: false, spinner: null, container: null,
Â  Â  Â  Â  Â  Â  init: () => {
Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.container = document.getElementById('main-content-area');
Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner = document.getElementById('ptr-spinner');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.container.addEventListener('touchstart', e => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (PullToRefresh.container.scrollTop <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.startY = e.touches[0].clientY;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.isPulling = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner.style.transition = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, {passive: true});

Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.container.addEventListener('touchmove', e => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!PullToRefresh.isPulling) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const y = e.touches[0].clientY;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const diff = y - PullToRefresh.startY;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (diff > 0 && PullToRefresh.container.scrollTop <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let pullDistance = Math.min(diff * 0.4, 70);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner.style.transform = `translate(-50%, ${pullDistance}px) rotate(${pullDistance*2}deg)`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner.style.opacity = Math.min(pullDistance / 50, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, {passive: false});

Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.container.addEventListener('touchend', e => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!PullToRefresh.isPulling) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.isPulling = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner.style.transition = 'transform 0.3s, opacity 0.3s';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const y = e.changedTouches[0].clientY;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const diff = y - PullToRefresh.startY;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (diff > 80 && PullToRefresh.container.scrollTop <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner.style.transform = `translate(-50%, 50px) rotate(360deg)`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner.classList.add('animate-spin');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderFeed();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderNotifications();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner.classList.remove('animate-spin');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner.style.transform = `translate(-50%, -50px)`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner.style.opacity = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner.style.transform = `translate(-50%, -50px)`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.spinner.style.opacity = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, {passive: true});
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  window.Mentions = {
Â  Â  Â  Â  Â  Â  activeInput: null,
Â  Â  Â  Â  Â  Â  setup: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const inputs = ['post-text-input', 'note-text-input', 'comment-input'];
Â  Â  Â  Â  Â  Â  Â  Â  inputs.forEach(id => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.getElementById(id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(el) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.addEventListener('input', (e) => Mentions.checkTrigger(e.target));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.addEventListener('blur', () => setTimeout(() => document.getElementById('mentions-dropdown').style.display = 'none', 200));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  checkTrigger: (input) => {
Â  Â  Â  Â  Â  Â  Â  Â  Mentions.activeInput = input;
Â  Â  Â  Â  Â  Â  Â  Â  const text = input.value;
Â  Â  Â  Â  Â  Â  Â  Â  const cursorPos = input.selectionStart;
Â  Â  Â  Â  Â  Â  Â  Â  const textBeforeCursor = text.substring(0, cursorPos);
Â  Â  Â  Â  Â  Â  Â  Â  const words = textBeforeCursor.split(/\s/);
Â  Â  Â  Â  Â  Â  Â  Â  const lastWord = words[words.length - 1];

Â  Â  Â  Â  Â  Â  Â  Â  const dropdown = document.getElementById('mentions-dropdown');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (lastWord.startsWith('@')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const query = lastWord.substring(1).toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Mentions.showList(query, input);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dropdown.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  showList: (query, input) => {
Â  Â  Â  Â  Â  Â  Â  Â  const dropdown = document.getElementById('mentions-dropdown');
Â  Â  Â  Â  Â  Â  Â  Â  dropdown.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const friendsIds = Memory.friends.map(f => f.user1 === currentUser.uid ? f.user2 : (f.user2 === currentUser.uid ? f.user1 : null)).filter(id => id);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let results = Object.values(Memory.users).filter(u =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.uid !== currentUser.uid &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  friendsIds.includes(u.uid) &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (u.username.toLowerCase().includes(query) || u.name.toLowerCase().includes(query))
Â  Â  Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  Â  Â  if(results.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dropdown.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const mentionsCount = currentUser.mentionsCount || {};
Â  Â  Â  Â  Â  Â  Â  Â  results.sort((a,b) => (mentionsCount[b.uid] || 0) - (mentionsCount[a.uid] || 0));

Â  Â  Â  Â  Â  Â  Â  Â  results.forEach(u => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'p-3 flex items-center gap-3 border-b hover:opacity-80 cursor-pointer btn-tap';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${u.photo || App.getDefaultAvatar()}" class="w-8 h-8 rounded-full object-cover border">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-sm">${u.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-[10px] opacity-60">@${u.username}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.onmousedown = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Mentions.selectUser(u.username, u.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dropdown.appendChild(item);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const rect = input.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â  dropdown.style.bottom = 'auto';
Â  Â  Â  Â  Â  Â  Â  Â  dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  if(input.id === 'comment-input' || input.id === 'post-text-input') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dropdown.style.top = 'auto';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dropdown.style.bottom = '60px';Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  dropdown.style.display = 'block';
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  selectUser: (username, uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  const input = Mentions.activeInput;
Â  Â  Â  Â  Â  Â  Â  Â  if(!input) return;
Â  Â  Â  Â  Â  Â  Â  Â  const text = input.value;
Â  Â  Â  Â  Â  Â  Â  Â  const cursorPos = input.selectionStart;
Â  Â  Â  Â  Â  Â  Â  Â  const textBeforeCursor = text.substring(0, cursorPos);
Â  Â  Â  Â  Â  Â  Â  Â  const textAfterCursor = text.substring(cursorPos);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const words = textBeforeCursor.split(/\s/);
Â  Â  Â  Â  Â  Â  Â  Â  words.pop();Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const newTextBefore = (words.length > 0 ? words.join(' ') + ' ' : '') + '@' + username + ' ';
Â  Â  Â  Â  Â  Â  Â  Â  input.value = newTextBefore + textAfterCursor;
Â  Â  Â  Â  Â  Â  Â  Â  input.focus();
Â  Â  Â  Â  Â  Â  Â  Â  input.setSelectionRange(newTextBefore.length, newTextBefore.length);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('mentions-dropdown').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  App.incrementMentionCount(uid);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  window.UI = {
Â  Â  Â  Â  Â  Â  showMessage: (msg) => {
Â  Â  Â  Â  Â  Â  Â  Â  const box = document.getElementById('msg-box');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('msg-box-text').innerText = msg;
Â  Â  Â  Â  Â  Â  Â  Â  box.style.opacity = '1';
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { box.style.opacity = '0'; }, 3000);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  switchAuth: (formId) => {
Â  Â  Â  Â  Â  Â  Â  Â  ['login-form', 'register-form', 'forgot-form'].forEach(id => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(id).classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`${formId}-form`).classList.remove('hidden');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  showScreen: (screenId) => {
Â  Â  Â  Â  Â  Â  Â  Â  ['splash-screen', 'auth-screen', 'setup-profile-screen', 'main-app'].forEach(id => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(id).classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(screenId).classList.remove('hidden');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  switchTab: (tabId) => {
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.nav-btn').forEach(btn => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.remove('text-blue-600', 'border-blue-600');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.add('text-gray-500', 'border-transparent');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.querySelector('i').classList.remove('ph-fill');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.querySelector('i').classList.add('ph');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  const activeBtn = document.querySelector(`.nav-btn[onclick="UI.switchTab('${tabId}')"]`);
Â  Â  Â  Â  Â  Â  Â  Â  if(activeBtn) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeBtn.classList.remove('text-gray-500', 'border-transparent');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeBtn.classList.add('text-blue-600', 'border-blue-600');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeBtn.querySelector('i').classList.remove('ph');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeBtn.querySelector('i').classList.add('ph-fill');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  ['tab-home', 'tab-messages', 'tab-notes', 'tab-notifications', 'tab-settings'].forEach(id => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(id).classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`tab-${tabId}`).classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  App.updateLastActive();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(tabId === 'notes') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø­Ø°ÙÙ†Ø§ Ø³Ø·Ø± Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ù„Ø¶Ù…Ø§Ù† Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù†Ù‚Ø·Ø© Ø·Ø§Ù„Ù…Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ù…Ø¹Ù„Ù‚
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.switchFriendsSubTab('friends');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if(tabId === 'notifications') document.getElementById('badge-notifications').classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('main-content-area').scrollTop = 0;
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  openModal: (modalId, data = null) => {
Â  Â  Â  Â  Â  Â  Â  Â  const modal = document.getElementById(modalId);
Â  Â  Â  Â  Â  Â  Â  Â  modal.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  if (modal.firstElementChild && (modal.firstElementChild.classList.contains('modal-slide-in') || modal.firstElementChild.classList.contains('modal-slide-out'))) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modal.firstElementChild.classList.remove('modal-slide-out');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modal.firstElementChild.classList.add('modal-slide-in');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (modalId === 'profile-modal' && data) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderUserProfile(data);
Â  Â  Â  Â  Â  Â  Â  Â  } else if (modalId === 'chat-modal' && data) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.currentChatUserId = data;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.cancelReply();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderChatInfo(data);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.loadMessages(); // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ 25 Ø±Ø³Ø§Ù„Ø©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.markChatAsRead(data);Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else if (modalId === 'comments-modal' && data) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.currentPostIdForComment = data;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('comment-my-avatar').src = currentUser.photo || App.getDefaultAvatar();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderComments();
Â  Â  Â  Â  Â  Â  Â  Â  } else if (modalId === 'edit-profile-modal') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-name').value = currentUser.name || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-bio').value = currentUser.bio || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-profile-img').src = currentUser.photo || App.getDefaultAvatar();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const usernameInput = document.getElementById('edit-username');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  usernameInput.value = currentUser.username || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tenDaysInMs = 10 * 24 * 60 * 60 * 1000;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastChange = currentUser.lastUsernameChange || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (Date.now() - lastChange < tenDaysInMs) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  usernameInput.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¹Ø±Ù Ù…Ø¹Ø·Ù„ Ù…Ø¤Ù‚ØªØ§Ù‹ (Ù…Ø±Ø© ÙƒÙ„ 10 Ø£ÙŠØ§Ù…)');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  usernameInput.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¬Ù†Ø³ ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.selectedEditGender = currentUser.gender || 'male';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-gender-male').classList.remove('selected');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-gender-female').classList.remove('selected');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(currentUser.gender === 'male') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-gender-male').classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-gender-female').classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else if (modalId === 'privacy-modal') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('priv-requests').checked = currentUser.allowRequests !== false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('priv-private').checked = currentUser.isPrivate === true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('priv-show-suggestions').checked = currentUser.showInSuggestions !== false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('priv-friends-vis').value = currentUser.friendsVisibility || 'all';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('priv-msgs').value = currentUser.messagePrivacy || 'all';
Â  Â  Â  Â  Â  Â  Â  Â  } else if (modalId === 'create-note-modal') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('create-note-preview-avatar').src = currentUser.photo || App.getDefaultAvatar();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-text-input').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  } else if (modalId === 'blocked-users-modal') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderBlockedUsers();Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else if (modalId === 'report-post-modal' && data) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.currentReportPostId = data;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (modalId === 'edit-post-modal' && data) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const post = Memory.posts.find(p => p.id === data);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(post) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.currentEditPostId = data;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-post-input').value = post.text;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  closeModal: (modalId) => {
Â  Â  Â  Â  Â  Â  Â  Â  const modal = document.getElementById(modalId);
Â  Â  Â  Â  Â  Â  Â  Â  if (modal.firstElementChild && modal.firstElementChild.classList.contains('modal-slide-in')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modal.firstElementChild.classList.remove('modal-slide-in');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modal.firstElementChild.classList.add('modal-slide-out');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { modal.classList.add('hidden'); }, 300);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modal.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  openProfileByUsername: (username) => {
Â  Â  Â  Â  Â  Â  Â  Â  const u = Object.values(Memory.users).find(user => user.username === username);
Â  Â  Â  Â  Â  Â  Â  Â  if(u) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('comments-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('note-view-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('single-post-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('profile-modal', u.uid);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  let tempPhotoBase64 = null;

Â  Â  Â  Â  window.Auth = {
Â  Â  Â  Â  Â  Â  init: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  UI.showScreen('splash-screen');

Â  Â  Â  Â  Â  Â  Â  Â  if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try { await signInWithCustomToken(auth, __initial_auth_token); } catch(e){}
Â  Â  Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  Â  Â  onAuthStateChanged(auth, async (user) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¸Ø± Ø§Ù„Ø¬Ù‡Ø§Ø²
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isBanned = await isDeviceBanned(user.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(isBanned) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø­Ø¸ÙˆØ± Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signOut(auth);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userDoc = await getDoc(doc(db, USERS_PATH, user.uid));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (userDoc.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.currentUser = userDoc.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!window.currentUser.blockedUsers) window.currentUser.blockedUsers = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!window.currentUser.mentionsCount) window.currentUser.mentionsCount = {};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(window.currentUser.showInSuggestions === undefined) window.currentUser.showInSuggestions = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const savedTheme = localStorage.getItem('xylo-theme');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(savedTheme === 'dark') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.add('dark-theme');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const themeToggle = document.getElementById('theme-toggle');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(themeToggle) themeToggle.checked = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { App.startCore(); }, 500);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const postIdParam = urlParams.get('post');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userParam = urlParams.get('user');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(postIdParam) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => App.openSinglePost(postIdParam), 1000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (userParam) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => UI.openProfileByUsername(userParam), 1000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { UI.showScreen('setup-profile-screen'); }, 500);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.currentUser = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { UI.showScreen('auth-screen'); }, 2000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  register: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const name = document.getElementById('reg-name').value;
Â  Â  Â  Â  Â  Â  Â  Â  const email = document.getElementById('reg-email').value;
Â  Â  Â  Â  Â  Â  Â  Â  const password = document.getElementById('reg-password').value;
Â  Â  Â  Â  Â  Â  Â  Â  if(!name || !email || !password) return UI.showMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cred = await createUserWithEmailAndPassword(auth, email, password);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.tempRegData = { uid: cred.user.uid, name, email };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showScreen('setup-profile-screen');
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø±Ø¨Ù…Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø£Ùˆ Ø§Ù„Ø±Ù…Ø² Ø¶Ø¹ÙŠÙ');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  login: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const email = document.getElementById('login-email').value;
Â  Â  Â  Â  Â  Â  Â  Â  const password = document.getElementById('login-password').value;
Â  Â  Â  Â  Â  Â  Â  Â  if(!email || !password) return UI.showMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„');
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signInWithEmailAndPassword(auth, email, password);
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  resetPassword: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const email = document.getElementById('forgot-email').value;
Â  Â  Â  Â  Â  Â  Â  Â  if(!email) return UI.showMessage('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await sendPasswordResetEmail(auth, email);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ø¨Ø±ÙŠØ¯Ùƒ');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.switchAuth('login');
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) { UI.showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£'); }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  resetPasswordFromSettings: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  if(auth.currentUser && auth.currentUser.email) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await sendPasswordResetEmail(auth, auth.currentUser.email);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø¨Ø±ÙŠØ¯Ùƒ');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) { UI.showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£'); }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  logout: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  App.updateLastActive(true);Â 
Â  Â  Â  Â  Â  Â  Â  Â  await signOut(auth);
Â  Â  Â  Â  Â  Â  Â  Â  window.location.reload();
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  handleImageUpload: (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  Â  Â  Â  Â  Â  if (!file) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  reader.onload = (event) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  img.onload = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const canvas = document.createElement('canvas');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const MAX_WIDTH = 400; const MAX_HEIGHT = 400;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let width = img.width; let height = img.height;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (width > height) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (height > MAX_HEIGHT) { width *= MAX_HEIGHT / height; height = MAX_HEIGHT; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.width = width; canvas.height = height;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ctx.drawImage(img, 0, 0, width, height);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tempPhotoBase64 = canvas.toDataURL('image/jpeg', 0.6);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('profile-preview-img').src = tempPhotoBase64;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('profile-preview-img').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  img.src = event.target.result;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  completeProfileSetup: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!window.tempRegData && !auth.currentUser) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(!window.selectedGender) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gender-error').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨...');
Â  Â  Â  Â  Â  Â  Â  Â  const uid = window.tempRegData ? window.tempRegData.uid : auth.currentUser.uid;
Â  Â  Â  Â  Â  Â  Â  Â  const name = window.tempRegData ? window.tempRegData.name : 'Ù…Ø³ØªØ®Ø¯Ù…';
Â  Â  Â  Â  Â  Â  Â  Â  const email = window.tempRegData ? window.tempRegData.email : '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const userData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uid: uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  email: email,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  photo: tempPhotoBase64 || App.getDefaultAvatar(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  username: 'user_' + Math.floor(Math.random() * 1000000),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bio: '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allowRequests: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isPrivate: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showInSuggestions: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  friendsVisibility: 'all',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messagePrivacy: 'all',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastActive: Date.now(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastUsernameChange: 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastGenderChange: 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  blockedUsers: [],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mentionsCount: {},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gender: window.selectedGender
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(doc(db, USERS_PATH, uid), userData);
Â  Â  Â  Â  Â  Â  Â  Â  window.currentUser = userData;
Â  Â  Â  Â  Â  Â  Â  Â  App.startCore();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  window.App = {
Â  Â  Â  Â  Â  Â  getDefaultAvatar: () => "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%239ca3af'><path d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/></svg>",
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  selectGender: (gender) => {
Â  Â  Â  Â  Â  Â  Â  Â  window.selectedGender = gender;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gender-error').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gender-male').classList.remove('selected');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gender-female').classList.remove('selected');
Â  Â  Â  Â  Â  Â  Â  Â  if(gender === 'male') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gender-male').classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gender-female').classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  selectEditGender: (gender) => {
Â  Â  Â  Â  Â  Â  Â  Â  const sixtyDaysInMs = 60 * 24 * 60 * 60 * 1000;
Â  Â  Â  Â  Â  Â  Â  Â  const lastChange = currentUser.lastGenderChange || 0;
Â  Â  Â  Â  Â  Â  Â  Â  if (Date.now() - lastChange < sixtyDaysInMs && gender !== currentUser.gender) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø¬Ù†Ø³ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙƒÙ„ 60 ÙŠÙˆÙ…');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  window.selectedEditGender = gender;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-gender-male').classList.remove('selected');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-gender-female').classList.remove('selected');
Â  Â  Â  Â  Â  Â  Â  Â  if(gender === 'male') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-gender-male').classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-gender-female').classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  toggleTheme: (isDark) => {
Â  Â  Â  Â  Â  Â  Â  Â  const themeLabel = document.getElementById('theme-text-label');
Â  Â  Â  Â  Â  Â  Â  Â  if(isDark) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.add('dark-theme');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('xylo-theme', 'dark');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(themeLabel) themeLabel.innerText = "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ";
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.remove('dark-theme');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('xylo-theme', 'light');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(themeLabel) themeLabel.innerText = "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ";
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  startCore: () => {
Â  Â  Â  Â  Â  Â  Â  Â  UI.showScreen('main-app');
Â  Â  Â  Â  Â  Â  Â  Â  App.updateUIWithUserData();
Â  Â  Â  Â  Â  Â  Â  Â  App.setupListeners();
Â  Â  Â  Â  Â  Â  Â  Â  App.updateLastActive();
Â  Â  Â  Â  Â  Â  Â  Â  Mentions.setup();
Â  Â  Â  Â  Â  Â  Â  Â  PullToRefresh.init();
Â  Â  Â  Â  Â  Â  Â  Â  setInterval(App.updateLastActive, 60000);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const themeToggle = document.getElementById('theme-toggle');
Â  Â  Â  Â  Â  Â  Â  Â  if(themeToggle) themeToggle.checked = document.body.classList.contains('dark-theme');

Â  Â  Â  Â  Â  Â  Â  Â  // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·
Â  Â  Â  Â  Â  Â  Â  Â  const userEmail = currentUser?.email || (auth.currentUser ? auth.currentUser.email : '');
Â  Â  Â  Â  Â  Â  Â  Â  if(userEmail && userEmail.toLowerCase() === window.MASTER_EMAIL.toLowerCase()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-panel-btn').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§: Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø¶Ø¨Ø· Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ± Ø¨Ø¯Ù‚Ø©
Â  Â  Â  Â  Â  Â  Â  Â  document.addEventListener("visibilitychange", () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (document.visibilityState === "hidden") {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.updateLastActive(true); // Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (document.visibilityState === "visible") {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.updateLastActive(false); // Ø¹Ø§Ø¯ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  updateUIWithUserData: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const photo = currentUser.photo || App.getDefaultAvatar();
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('current-user-avatar-home').src = photo;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('current-user-avatar-note').src = photo;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('settings-avatar').src = photo;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('settings-name').innerText = currentUser.name;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('create-post-avatar').src = photo;
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  updateLastActive: async (forceOffline = false) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!currentUser) return;
Â  Â  Â  Â  Â  Â  Â  Â  // Ø¥Ø°Ø§ ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ø·ÙŠÙ‡ ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ÙØ¹Ù„ÙŠØŒ Ù„ÙŠØ³ Ù†Ø§Ù‚Øµ 6 Ø¯Ù‚Ø§Ø¦Ù‚
Â  Â  Â  Â  Â  Â  Â  Â  const now = forceOffline ? (Date.now() - (1 * 60 * 1000)) : Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  currentUser.lastActive = now;
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, USERS_PATH, currentUser.uid), { lastActive: now });
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e){}
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  setupListeners: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const errHandler = (e) => console.error("Firebase Read Error:", e);

Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, USERS_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  snap.docs.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = d.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.users[d.id] = data;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(d.id === currentUser.uid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser.blockedUsers = data.blockedUsers || [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser.mentionsCount = data.mentionsCount || {};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.updateUIWithUserData();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderChats();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderFeed();Â 
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, POSTS_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.posts = snap.docs.map(d => ({id: d.id, ...d.data()}));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderFeed();
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, COMMENTS_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.comments = snap.docs.map(d => ({id: d.id, ...d.data()}));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(window.currentPostIdForComment) App.renderComments();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderFeed();Â 
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, REQUESTS_PATH), (snap) => {
    Memory.requests = snap.docs.map(d => ({id: d.id, ...d.data()}));
    
    const myRequests = Memory.requests.filter(r => r.to === currentUser.uid);
    const badgeSubtab = document.getElementById('badge-requests-subtab');
    const badgeMainNav = document.getElementById('badge-requests');
    
    if(myRequests.length > 0) {
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© ÙˆÙ‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        if(badgeMainNav) badgeMainNav.style.display = 'block';
        if(badgeSubtab) badgeSubtab.style.display = 'inline-block';
    } else {
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø£ÙŠ Ø·Ù„Ø¨ Ù…Ø¹Ù„Ù‚ (Ø³ÙˆØ§Ø¡ ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø£Ùˆ Ø§Ù„Ø±ÙØ¶)
        if(badgeMainNav) badgeMainNav.style.display = 'none';
        if(badgeSubtab) badgeSubtab.style.display = 'none';
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø®Ù„ Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    if(!document.getElementById('subtab-content-requests').classList.contains('hidden')) {
        App.renderFriendsTab('requests');
    }
}, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, FRIENDS_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.friends = snap.docs.map(d => ({id: d.id, ...d.data()}));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderNotes();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderFriendsTab('friends');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderFriendsTab('suggestions');Â 
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, NOTES_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const now = Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oneDay = 24 * 60 * 60 * 1000;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.notes = snap.docs.map(d => ({id: d.id, ...d.data()}))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(n => (now - n.timestamp) < oneDay);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderNotes();
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, MESSAGES_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.messages = snap.docs.map(d => ({id: d.id, ...d.data()}));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderChats();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(window.currentChatUserId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isChatOpen = !document.getElementById('chat-modal').classList.contains('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isChatOpen) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const unreadInChat = snap.docs.filter(d => d.data().senderId === window.currentChatUserId && !d.data().read && d.data().participants.includes(currentUser.uid));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(unreadInChat.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  unreadInChat.forEach(d => updateDoc(d.ref, {read: true}));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„Ù†Ø§ÙØ°Ø© Ù…ÙØªÙˆØ­Ø©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderMessages();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, TYPING_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  snap.docs.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.typingStatus[d.id] = d.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù„Ø¸Ù‡ÙˆØ± "ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(document.getElementById('tab-messages') && !document.getElementById('tab-messages').classList.contains('hidden')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderChats();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ (Ø§Ù„ÙÙ‚Ø§Ø¹Ø© Ø§Ù„Ø­ÙŠØ©)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(window.currentChatUserId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const typingDocData = Memory.typingStatus[`${window.currentChatUserId}_${currentUser.uid}`];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const bubble = document.getElementById('live-typing-bubble');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(typingDocData && typingDocData.text && (Date.now() - typingDocData.timestamp < 5000)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bubble.innerText = typingDocData.text;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bubble.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('chat-messages-container');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(container) container.scrollTop = container.scrollHeight;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(bubble) bubble.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, NOTIFS_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.notifications = snap.docs.map(d => ({id: d.id, ...d.data()}))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(n => n.to === currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderNotifications();
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, PINS_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.pins = snap.docs.map(d => ({id: d.id, ...d.data()}));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderChats();
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, MUTES_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.mutes = snap.docs.map(d => ({id: d.id, ...d.data()}));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderChats();
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¥Ø¨Ù„Ø§ØºØ§Øª (Ù„Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·)
Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, REPORTS_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.reports = snap.docs.map(d => ({id: d.id, ...d.data()}));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(currentUser && currentUser.email === window.MASTER_EMAIL) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.updateReportsBadge();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!document.getElementById('admin-panel-modal').classList.contains('hidden')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderReports();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);

Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†
Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(collection(db, BANNED_PATH), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.banned = snap.docs.map(d => ({id: d.id, ...d.data()}));
Â  Â  Â  Â  Â  Â  Â  Â  }, errHandler);
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  handleTyping: async (text) => {
Â  Â  Â  Â  Â  Â  Â  Â  const otherUid = window.currentChatUserId;
Â  Â  Â  Â  Â  Â  Â  Â  if(!otherUid || !currentUser) return;
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(doc(db, TYPING_PATH, `${currentUser.uid}_${otherUid}`), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: text,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: Date.now()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e){}
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  getPetCharacterSVG: (level) => {
Â  Â  Â  Â  Â  Â  Â  Â  let skinColor = "#fca5a5";
Â  Â  Â  Â  Â  Â  Â  Â  let shirtColor, pantsColor, eyeExpr, mouthExpr, accessoriesHTML, auraHTML;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const sadFace = `<circle cx="42" cy="38" r="3" fill="#1f2937"/><circle cx="58" cy="38" r="3" fill="#1f2937"/><path d="M45 55 Q 50 50 55 55" stroke="#1f2937" stroke-width="2.5" fill="none" stroke-linecap="round"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  const neutralFace = `<circle cx="42" cy="38" r="3" fill="#1f2937"/><circle cx="58" cy="38" r="3" fill="#1f2937"/><path d="M45 52 L 55 52" stroke="#1f2937" stroke-width="2.5" fill="none" stroke-linecap="round"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  const happyFace = `<circle cx="42" cy="38" r="3.5" fill="#1f2937"/><circle cx="58" cy="38" r="3.5" fill="#1f2937"/><path d="M44 50 Q 50 58 56 50" stroke="#1f2937" stroke-width="2.5" fill="none" stroke-linecap="round"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  const coolFace = `<path d="M 38 36 L 46 38 L 38 40 Z" fill="#1f2937"/><path d="M 62 36 L 54 38 L 62 40 Z" fill="#1f2937"/><path d="M43 52 Q 50 56 57 50" stroke="#1f2937" stroke-width="2" fill="none" stroke-linecap="round"/>`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  auraHTML = "";
Â  Â  Â  Â  Â  Â  Â  Â  accessoriesHTML = "";
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  switch(level) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 1:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shirtColor = "#78716c"; pantsColor = "#57534e"; eyeExpr = sadFace;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  accessoriesHTML = `<path d="M40 65 L48 65 L45 72 Z" fill="#a8a29e" opacity="0.6"/><line x1="42" y1="67" x2="46" y2="70" stroke="#444" stroke-width="1"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 2:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shirtColor = "#a8a29e"; pantsColor = "#78716c"; eyeExpr = neutralFace;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 3:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shirtColor = "#60a5fa"; pantsColor = "#475569"; eyeExpr = happyFace;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 4:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shirtColor = "#34d399"; pantsColor = "#334155"; eyeExpr = happyFace;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  accessoriesHTML = `<circle cx="65" cy="70" r="3" fill="#fbbf24"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 5:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shirtColor = "#f43f5e"; pantsColor = "#1e293b"; eyeExpr = happyFace;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  accessoriesHTML = `<circle cx="65" cy="70" r="3" fill="#fbbf24"/><path d="M30 20 Q 50 10 70 20 Q 50 25 30 20" fill="#3b82f6"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 6:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shirtColor = "#a855f7"; pantsColor = "#0f172a"; eyeExpr = coolFace;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  accessoriesHTML = `<path d="M38 35 h24 v6 h-24 z" fill="#111827" rx="2"/><line x1="50" y1="60" x2="50" y2="80" stroke="#fbbf24" stroke-width="2"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 7:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shirtColor = "#ffffff"; pantsColor = "#000000"; eyeExpr = happyFace;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  accessoriesHTML = `<path d="M35 60 L 50 80 L 65 60" fill="#1e293b"/><path d="M48 60 L 52 60 L 50 70 Z" fill="#ef4444"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 8:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shirtColor = "#000000"; pantsColor = "#000000"; eyeExpr = coolFace;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  accessoriesHTML = `<path d="M35 60 L 50 75 L 65 60 Z" fill="#ffffff"/><path d="M48 60 L 52 60 L 50 70 Z" fill="#000000"/><path d="M30 25 L 30 10 L 70 10 L 70 25 Z" fill="#111827"/><path d="M25 25 L 75 25 L 75 28 L 25 28 Z" fill="#111827"/><circle cx="45" cy="65" r="2" fill="#fbbf24"/><circle cx="55" cy="65" r="2" fill="#fbbf24"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 9:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shirtColor = "#1e1b4b"; pantsColor = "#000000"; eyeExpr = happyFace;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  accessoriesHTML = `<path d="M20 60 Q 15 80 20 95 L 80 95 Q 85 80 80 60 Z" fill="#dc2626" opacity="0.9"/><path d="M35 15 L 42 5 L 50 15 L 58 5 L 65 15 L 65 25 L 35 25 Z" fill="#fbbf24"/><circle cx="42" cy="12" r="2" fill="#ef4444"/><circle cx="50" cy="18" r="2" fill="#3b82f6"/><circle cx="58" cy="12" r="2" fill="#22c55e"/><path d="M40 60 Q 50 70 60 60" stroke="#fbbf24" stroke-width="3" fill="none"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 10:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shirtColor = "#172554"; pantsColor = "#000000"; eyeExpr = happyFace;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  auraHTML = `<circle cx="50" cy="50" r="45" fill="#fef08a" opacity="0.3" filter="blur(4px)"/><circle cx="50" cy="50" r="35" fill="#fbbf24" opacity="0.4" filter="blur(2px)"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  accessoriesHTML = `<path d="M15 55 Q 10 80 15 100 L 85 100 Q 90 80 85 55 Z" fill="#7f1d1d" stroke="#fbbf24" stroke-width="2"/><path d="M30 15 L 40 0 L 50 10 L 60 0 L 70 15 L 70 25 L 30 25 Z" fill="#fbbf24"/><circle cx="40" cy="10" r="3" fill="#ef4444"/><circle cx="50" cy="15" r="3" fill="#8b5cf6"/><circle cx="60" cy="10" r="3" fill="#ef4444"/><path d="M40 60 L 50 75 L 60 60" stroke="#fbbf24" stroke-width="4" fill="none"/><polygon points="50,68 53,75 50,82 47,75" fill="#06b6d4"/><line x1="80" y1="40" x2="80" y2="100" stroke="#fbbf24" stroke-width="4" stroke-linecap="round"/><circle cx="80" cy="40" r="6" fill="#06b6d4"/><path d="M 10 30 L 15 35 M 15 30 L 10 35" stroke="#fbbf24" stroke-width="2"/><path d="M 85 20 L 90 25 M 90 20 L 85 25" stroke="#fbbf24" stroke-width="2"/>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-full h-full pet-animate ${level >= 9 ? 'pet-glow-gold' : ''}" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${auraHTML}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <line x1="42" y1="80" x2="42" y2="95" stroke="${skinColor}" stroke-width="6" stroke-linecap="round"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <line x1="58" y1="80" x2="58" y2="95" stroke="${skinColor}" stroke-width="6" stroke-linecap="round"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <line x1="35" y1="65" x2="25" y2="75" stroke="${skinColor}" stroke-width="5" stroke-linecap="round"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <line x1="65" y1="65" x2="75" y2="75" stroke="${skinColor}" stroke-width="5" stroke-linecap="round"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <rect x="37" y="75" width="26" height="10" rx="3" fill="${pantsColor}"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <rect x="33" y="55" width="34" height="22" rx="6" fill="${shirtColor}"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <rect x="25" y="20" width="50" height="40" rx="20" fill="${skinColor}"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${eyeExpr}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <circle cx="33" cy="45" r="4" fill="#f87171" opacity="0.4"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <circle cx="67" cy="45" r="4" fill="#f87171" opacity="0.4"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${accessoriesHTML}
Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  updateChatPet: (msgs) => {
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('chat-pet-container');
Â  Â  Â  Â  Â  Â  Â  Â  if(!msgs || msgs.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const existingPopup = document.getElementById('pet-popup-overlay');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(existingPopup) existingPopup.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const totalMsgs = msgs.length;
Â  Â  Â  Â  Â  Â  Â  Â  const lastMsg = msgs[msgs.length - 1];
Â  Â  Â  Â  Â  Â  Â  Â  const daysSinceLastMsg = (Date.now() - lastMsg.timestamp) / (1000 * 60 * 60 * 24);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let level = 1;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(daysSinceLastMsg >= 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  level = 1;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (totalMsgs >= 1000) level = 10;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (totalMsgs >= 500) level = 9;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (totalMsgs >= 300) level = 8;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (totalMsgs >= 150) level = 7;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (totalMsgs >= 80) level = 6;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (totalMsgs >= 40) level = 5;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (totalMsgs >= 20) level = 4;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (totalMsgs >= 10) level = 3;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (totalMsgs >= 5) level = 2;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  let popupMessage = "";
Â  Â  Â  Â  Â  Â  Â  Â  if (daysSinceLastMsg >= 1 && daysSinceLastMsg < 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  popupMessage = "ğŸš¨ Ø§Ù†Ù‚Ø°ÙˆÙ†ÙŠ!\nØ±Ø§Ø­ Ø§Ø±Ø¬Ø¹ ÙÙ‚ÙŠØ± ØªÙƒÙ„Ù…Ùˆ Ø¹Ù„Ù‰ Ø§ÙŠ Ø´ÙŠ...\nÙ†Ù…ÙŠÙ…Ø© Ø§Ùˆ ØºÙŠØ¨Ø© Ø§Ù„Ù…Ù‡Ù… ØªØªÙƒÙ„Ù…ÙˆÙ† ğŸ˜­";
Â  Â  Â  Â  Â  Â  Â  Â  } else if (daysSinceLastMsg >= 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  popupMessage = "ğŸ’” Ù„Ù„Ø£Ø³Ù Ø±Ø¬Ø¹Øª ÙÙ‚ÙŠØ±...\nÙ…Ø§ ØªÙƒÙ„Ù…ØªÙˆ ÙˆÙŠØ§ÙŠ 3 Ø§ÙŠØ§Ù… ğŸ˜¢";
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  popupMessage = "Â  Ù‡Ù„Ùˆ Ø§Ù†ÙŠ Ø·Ø±ÙÙƒÙ… Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø´ÙŠØ·Ø§Ù† ğŸ˜‚!\nÙ„Ø§ Ù„Ø§ Ø§Ø´Ø§Ù‚Ø© Ø§Ù†ÙŠ Ø§Ù„Ø³ØªØ±ÙŠÙƒ Ø§Ø°Ø§ Ù…Ø§ ØªØªÙƒÙ„Ù…ÙˆÙ†\n ÙƒÙ„ ÙŠÙˆÙ… Ø§Ø±Ø¬Ø¹ ÙÙ‚ÙŠØ± ğŸ’” Ù…Ø¹ØªÙ…Ø¯ Ø¹Ù„ÙŠÙƒ... ";
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  container.setAttribute('data-pet-message', popupMessage);
Â  Â  Â  Â  Â  Â  Â  Â  container.setAttribute('data-pet-level', level);
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = App.getPetCharacterSVG(level);

Â  Â  Â  Â  Â  Â  Â  Â  const existingPopup = document.getElementById('pet-popup-overlay');
Â  Â  Â  Â  Â  Â  Â  Â  if(existingPopup) existingPopup.remove();

Â  Â  Â  Â  Â  Â  Â  Â  container.onclick = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.showPetPopup(popupMessage);
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  showPetPopup: (message) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(window.petPopupVisible) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.hidePetPopup();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const existingPopup = document.getElementById('pet-popup-overlay');
Â  Â  Â  Â  Â  Â  Â  Â  if(existingPopup) existingPopup.remove();

Â  Â  Â  Â  Â  Â  Â  Â  const overlay = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  overlay.id = 'pet-popup-overlay';
Â  Â  Â  Â  Â  Â  Â  Â  overlay.className = 'pet-popup-overlay';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const content = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  content.className = 'pet-popup-content';
Â  Â  Â  Â  Â  Â  Â  Â  content.textContent = message;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  overlay.appendChild(content);
Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(overlay);

Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overlay.classList.add('show');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content.classList.add('show');
Â  Â  Â  Â  Â  Â  Â  Â  }, 10);

Â  Â  Â  Â  Â  Â  Â  Â  window.petPopupVisible = true;

Â  Â  Â  Â  Â  Â  Â  Â  overlay.onclick = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target === overlay) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.hidePetPopup();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  hidePetPopup: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const overlay = document.getElementById('pet-popup-overlay');
Â  Â  Â  Â  Â  Â  Â  Â  if(overlay) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overlay.classList.remove('show');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overlay.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 300);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  window.petPopupVisible = false;
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  isFriend: (uid1, uid2) => {
Â  Â  Â  Â  Â  Â  Â  Â  return Memory.friends.some(f =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (f.user1 === uid1 && f.user2 === uid2) ||Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (f.user1 === uid2 && f.user2 === uid1)
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  isBlocked: (uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  return currentUser.blockedUsers?.includes(uid);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  isMuted: (otherUid) => {
Â  Â  Â  Â  Â  Â  Â  Â  const mute = Memory.mutes.find(m =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m.userId === currentUser.uid && m.chatId === otherUid && m.until > Date.now()
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  return !!mute;
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  timeAgo: (timestamp) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!timestamp) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
Â  Â  Â  Â  Â  Â  Â  Â  const seconds = Math.floor((new Date() - timestamp) / 1000);
Â  Â  Â  Â  Â  Â  Â  Â  if (seconds < 60) return "Ø§Ù„Ø¢Ù†";
Â  Â  Â  Â  Â  Â  Â  Â  const minutes = Math.floor(seconds / 60);
Â  Â  Â  Â  Â  Â  Â  Â  if (minutes < 60) return `Ù…Ù†Ø° ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
Â  Â  Â  Â  Â  Â  Â  Â  const hours = Math.floor(minutes / 60);
Â  Â  Â  Â  Â  Â  Â  Â  if (hours < 24) return `Ù…Ù†Ø° ${hours} Ø³Ø§Ø¹Ø©`;
Â  Â  Â  Â  Â  Â  Â  Â  const days = Math.floor(hours / 24);
Â  Â  Â  Â  Â  Â  Â  Â  return `Ù…Ù†Ø° ${days} ÙŠÙˆÙ…`;
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  isOnline: (lastActive) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!lastActive) return false;
Â  Â  Â  Â  Â  Â  Â  Â  return (Date.now() - lastActive) < (5 * 60 * 1000);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  parseMentions: (text) => {
Â  Â  Â  Â  Â  Â  Â  Â  return parseTextWithLinks(text);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  notifyMentions: async (text, type, linkId) => {
Â  Â  Â  Â  Â  Â  Â  Â  const matches = text.match(/@([\w_.]+)/g);
Â  Â  Â  Â  Â  Â  Â  Â  if(!matches) return;
Â  Â  Â  Â  Â  Â  Â  Â  const usernames = matches.map(m => m.substring(1));
Â  Â  Â  Â  Â  Â  Â  Â  const usersArray = Object.values(Memory.users);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  for(let un of usernames) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mentionedUser = usersArray.find(u => u.username === un);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(mentionedUser && mentionedUser.uid !== currentUser.uid && !App.isBlocked(mentionedUser.uid)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await App.sendNotification(mentionedUser.uid, `Ù‚Ø§Ù… Ø¨Ø°ÙƒØ±Ùƒ ÙÙŠ ${type}`, linkId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  incrementMentionCount: async (uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  let counts = currentUser.mentionsCount || {};
Â  Â  Â  Â  Â  Â  Â  Â  counts[uid] = (counts[uid] || 0) + 1;
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, USERS_PATH, currentUser.uid), { mentionsCount: counts });
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ± (Ø«Ù„Ø§Ø« Ù†Ù‚Ø§Ø·)
Â  Â  Â  Â  Â  Â  showPostOptions: (postId, authorId) => {
Â  Â  Â  Â  Â  Â  Â  Â  const content = document.getElementById('action-modal-content');
Â  Â  Â  Â  Â  Â  Â  Â  const isMyPost = authorId === currentUser.uid;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let buttons = '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(isMyPost) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ù„Ù„Ù…Ø§Ù„Ùƒ: ØªØ¹Ø¯ÙŠÙ„ ÙˆØ¥Ø¨Ù„Ø§Øº
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttons += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.editPost('${postId}')" class="w-full flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-green-50 btn-tap text-green-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</span> <i class="ph-fill ph-pencil-simple text-lg"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø²Ø± Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ù„Ø¬Ù…ÙŠØ¹
Â  Â  Â  Â  Â  Â  Â  Â  buttons += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.reportPost('${postId}')" class="w-full flex justify-between items-center p-4 hover:bg-red-50 btn-tap text-red-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±</span> <i class="ph-fill ph-flag text-lg"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  content.innerHTML = buttons;
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('action-modal');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†Ø´ÙˆØ±
Â  Â  Â  Â  Â  Â  editPost: (postId) => {
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('edit-post-modal', postId);
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø´ÙˆØ±
Â  Â  Â  Â  Â  Â  updatePost: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const newText = document.getElementById('edit-post-input').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if(!newText || !window.currentEditPostId) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, POSTS_PATH, window.currentEditPostId), { text: newText });
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('edit-post-modal');
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù…Ù†Ø´ÙˆØ±
Â  Â  Â  Â  Â  Â  reportPost: (postId) => {
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('report-post-modal', postId);
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº
Â  Â  Â  Â  Â  Â  submitReport: async (type, targetId, reason) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!targetId) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, REPORTS_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: type,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetId: targetId,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reportedBy: currentUser.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reason: reason,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: Date.now(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: 'pending'
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('report-post-modal');
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // Ø¯ÙˆØ§Ù„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
Â  Â  Â  Â  Â  Â  switchAdminTab: (tabId) => {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-tab-reports').className = 'flex-1 py-3 text-center font-bold border-b-2 border-transparent';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-tab-banned').className = 'flex-1 py-3 text-center font-bold border-b-2 border-transparent';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(tabId === 'reports') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-tab-reports').className = 'flex-1 py-3 text-center font-bold border-b-2 border-blue-600 text-blue-600';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-reports-tab').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-banned-tab').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderReports();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-tab-banned').className = 'flex-1 py-3 text-center font-bold border-b-2 border-blue-600 text-blue-600';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-reports-tab').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-banned-tab').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  updateReportsBadge: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const pendingReports = Memory.reports.filter(r => r.status === 'pending');
Â  Â  Â  Â  Â  Â  Â  Â  const badge = document.getElementById('admin-reports-badge');
Â  Â  Â  Â  Â  Â  Â  Â  if(pendingReports.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badge.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badge.innerText = pendingReports.length;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badge.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // ÙÙŠ Ø¯Ø§Ù„Ø© renderReportsØŒ Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯:
renderReports: () => {
Â  Â  const container = document.getElementById('reports-list');
Â  Â  container.innerHTML = '';
Â  Â Â 
Â  Â  const pendingReports = Memory.reports.filter(r => r.status === 'pending').sort((a,b) => b.timestamp - a.timestamp);
Â  Â Â 
Â  Â  if(pendingReports.length === 0) {
Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-50 py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¨Ù„Ø§ØºØ§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>';
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  pendingReports.forEach(report => {
Â  Â  Â  Â  const reporter = Memory.users[report.reportedBy];
Â  Â  Â  Â  const post = Memory.posts.find(p => p.id === report.targetId);
Â  Â  Â  Â  const postAuthor = post ? Memory.users[post.authorId] : null;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(!reporter || !post || !postAuthor) return;

Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  el.className = 'theme-card p-4 rounded-xl border space-y-3';
Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm font-bold text-red-600">${report.reason}</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs opacity-60">${App.timeAgo(report.timestamp)}</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2 justify-between border-t pt-3">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-60">Ø§Ù„Ù…Ø¨Ù„Øº:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2 cursor-pointer btn-tap" onclick="UI.openModal('profile-modal', '${reporter.uid}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${reporter.photo || App.getDefaultAvatar()}" class="w-6 h-6 rounded-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-sm">${reporter.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-60">ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2 cursor-pointer btn-tap" onclick="UI.openModal('profile-modal', '${postAuthor.uid}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${postAuthor.photo || App.getDefaultAvatar()}" class="w-6 h-6 rounded-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-sm">${postAuthor.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="border-t pt-3">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-80">${post.text.substring(0, 100)}${post.text.length > 100 ? '...' : ''}</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.banReporter('${report.id}', '${reporter.uid}')" class="flex-1 bg-red-500 text-white p-2 rounded-xl text-sm font-bold btn-tap">Ø­Ø¸Ø± Ø§Ù„Ù…Ø¨Ù„Øº</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.banPostOwner('${report.id}', '${postAuthor.uid}')" class="flex-1 bg-red-600 text-white p-2 rounded-xl text-sm font-bold btn-tap">Ø­Ø¸Ø± ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.rejectReport('${report.id}')" class="flex-1 bg-gray-500 text-white p-2 rounded-xl text-sm font-bold btn-tap">Ø±ÙØ¶</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  container.appendChild(el);
Â  Â  });
},

Â  Â  Â  Â  Â  Â  banReporter: async (reportId, reporterUid) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŸ')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await banDevice(reporterUid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, REPORTS_PATH, reportId), { status: 'processed' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderReports();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  banPostOwner: async (reportId, ownerUid) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø¸Ø± ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŸ')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const report = Memory.reports.find(r => r.id === reportId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø­ØªÙ‰ Ù„Ùˆ ÙƒÙ†Øª ØªØ®ØªØ¨Ø±Ù‡ Ù…Ù† Ø­Ø³Ø§Ø¨Ùƒ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (report && report.reportedBy) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, NOTIFS_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to: report.reportedBy,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from: currentUser.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: 'Ù‚Ù…Ù†Ø§ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¥Ø¨Ù„Ø§ØºÙƒ ÙˆØªÙ… Ø§ØªØ®Ø§Ø° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù„Ø§Ø²Ù… Ø¨Ø­Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„Ù. Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø³Ø§Ù‡Ù…ØªÙƒ ÙÙŠ Ø¬Ø¹Ù„ Ø²Ø§ÙŠÙ„Ùˆ Ù…Ø¬ØªÙ…Ø¹Ø§Ù‹ Ø¢Ù…Ù†Ø§Ù‹ ğŸ›¡ï¸',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  linkId: null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: Date.now(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  read: false
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await banDevice(ownerUid);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, REPORTS_PATH, reportId), { status: 'processed' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø­Ø¸Ø± ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ± ÙˆØ¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙØ¨Ù„Øº');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderReports();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  rejectReport: async (reportId) => {
Â  Â  Â  Â  Â  Â  Â  Â  const report = Memory.reports.find(r => r.id === reportId);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ÙˆØµÙˆÙ„
Â  Â  Â  Â  Â  Â  Â  Â  if (report && report.reportedBy) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, NOTIFS_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to: report.reportedBy,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from: currentUser.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: 'Ù‚Ù…Ù†Ø§ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¥Ø¨Ù„Ø§ØºÙƒ ÙˆÙ„Ù… Ù†Ø¬Ø¯ Ø£ÙŠ Ø§Ù†ØªÙ‡Ø§Ùƒ Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø¬ØªÙ…Ø¹. Ø´ÙƒØ±Ø§Ù‹ Ù„Ø­Ø±ØµÙƒ ğŸ¤',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  linkId: null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: Date.now(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  read: false
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, REPORTS_PATH, reportId), { status: 'rejected' });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº ÙˆØ¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙØ¨Ù„Øº');
Â  Â  Â  Â  Â  Â  Â  Â  App.renderReports();
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  searchUsersForBan: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const query = document.getElementById('admin-search-input').value.toLowerCase().trim();
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('admin-search-results');
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  if(!query) return;

Â  Â  Â  Â  Â  Â  Â  Â  const results = Object.values(Memory.users).filter(u =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.username.toLowerCase().includes(query) ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.name.toLowerCase().includes(query)
Â  Â  Â  Â  Â  Â  Â  Â  ).slice(0, 5);

Â  Â  Â  Â  Â  Â  Â  Â  results.forEach(u => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isBanned = Memory.banned.some(b => b.id === u.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = 'flex items-center justify-between p-3 theme-card rounded-xl border';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${u.photo || App.getDefaultAvatar()}" class="w-8 h-8 rounded-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold block">${u.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs opacity-60">@${u.username}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.${isBanned ? 'unbanUser' : 'banUser'}('${u.uid}')" class="${isBanned ? 'bg-green-500' : 'bg-red-500'} text-white px-3 py-1 rounded-full text-sm font-bold btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isBanned ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¸Ø±' : 'Ø­Ø¸Ø±'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  banUser: async (uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŸ')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await banDevice(uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-search-input').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-search-results').innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  unbanUser: async (uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await unbanDevice(uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-search-input').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-search-results').innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  showBannedUsers: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const list = document.getElementById('banned-users-list');
Â  Â  Â  Â  Â  Â  Â  Â  if(list.classList.contains('hidden')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Memory.banned.forEach(b => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const user = Memory.users[b.id];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!user) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = 'flex items-center justify-between p-3 theme-card rounded-xl border';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${user.photo || App.getDefaultAvatar()}" class="w-8 h-8 rounded-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold block">${user.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs opacity-60">@${user.username}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.unbanUser('${user.uid}')" class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¸Ø±
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  renderFeed: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('feed-container');
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const sortedPosts = [...Memory.posts].sort((a,b) => b.timestamp - a.timestamp);
Â  Â  Â  Â  Â  Â  Â  Â  let visibleCount = 0;

Â  Â  Â  Â  Â  Â  Â  Â  sortedPosts.forEach(post => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const author = Memory.users[post.authorId];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!author || App.isBlocked(author.uid)) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(author.isPrivate && author.uid !== currentUser.uid && !App.isFriend(currentUser.uid, author.uid)) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  visibleCount++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isLiked = post.likes && post.likes.includes(currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const likesCount = post.likes ? post.likes.length : 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const commentsCount = Memory.comments.filter(c => c.postId === post.id).length;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parsedText = App.parseMentions(post.text);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const postEl = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  postEl.className = 'theme-card rounded-2xl shadow-sm border overflow-hidden mb-3';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  postEl.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-3.5 flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3 cursor-pointer group btn-tap" onclick="UI.openModal('profile-modal', '${author.uid}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${author.photo || App.getDefaultAvatar()}" class="w-11 h-11 rounded-full object-cover border border-gray-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold leading-tight group-hover:text-blue-600 transition-colors flex items-center gap-1 theme-text">${author.name}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs opacity-60">${App.timeAgo(post.timestamp)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.showPostOptions('${post.id}', '${author.uid}')" class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-400 hover:text-blue-600 hover:bg-blue-50 transition-colors btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-dots-three-vertical text-lg"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="px-4 py-2 theme-text text-[15px] leading-relaxed whitespace-pre-wrap">${parsedText}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="px-4 py-3 text-xs opacity-60 flex justify-between items-center mt-2 border-b" style="border-color: var(--border-color);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-1"><i class="ph-fill ph-thumbs-up text-blue-500"></i> ${likesCount}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>${commentsCount} ØªØ¹Ù„ÙŠÙ‚</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex p-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.toggleLike('${post.id}')" class="flex-1 flex justify-center items-center gap-1.5 py-2.5 rounded-xl btn-tap font-semibold transition-colors ${isLiked ? 'text-blue-600 bg-blue-50' : 'theme-text hover:bg-gray-100/10'}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="${isLiked ? 'ph-fill' : 'ph'} ph-thumbs-up text-xl"></i> Ø£Ø¹Ø¬Ø¨Ù†ÙŠ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.openModal('comments-modal', '${post.id}')" class="flex-1 flex justify-center items-center gap-1.5 py-2.5 rounded-xl theme-text font-semibold hover:bg-gray-100/10 transition-colors btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-chat-centered text-xl"></i> ØªØ¹Ù„ÙŠÙ‚
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.sharePost('${post.id}')" class="flex-1 flex justify-center items-center gap-1.5 py-2.5 rounded-xl theme-text font-semibold hover:bg-gray-100/10 transition-colors btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-share-network text-xl"></i> Ù…Ø´Ø§Ø±ÙƒØ©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(postEl);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if(visibleCount === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-50 py-10 mt-10"><i class="ph ph-newspaper text-4xl mb-2 block mx-auto"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  createPost: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const text = document.getElementById('post-text-input').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if(!text) return UI.showMessage('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù†Ø´Ø± Ù…Ù†Ø´ÙˆØ± ÙØ§Ø±Øº');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('create-post-modal');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('post-text-input').value = '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const postRef = await addDoc(collection(db, POSTS_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  authorId: currentUser.uid, text: text, timestamp: Date.now(), likes: []
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  App.notifyMentions(text, 'Ù…Ù†Ø´ÙˆØ±', postRef.id);
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  deletePost: async (postId) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(confirm('Ù‡Ù„ Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±ØŸ')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, POSTS_PATH, postId));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  toggleLike: async (postId) => {
Â  Â  Â  Â  Â  Â  Â  Â  const post = Memory.posts.find(p => p.id === postId);
Â  Â  Â  Â  Â  Â  Â  Â  if(!post) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let newLikes = post.likes ? [...post.likes] : [];
Â  Â  Â  Â  Â  Â  Â  Â  if(newLikes.includes(currentUser.uid)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newLikes = newLikes.filter(id => id !== currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newLikes.push(currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(post.authorId !== currentUser.uid && !App.isBlocked(post.authorId)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.sendNotification(post.authorId, 'Ø£Ø¹Ø¬Ø¨ Ø¨Ù…Ù†Ø´ÙˆØ±Ùƒ', postId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, POSTS_PATH, postId), { likes: newLikes });
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  sharePost: async (postId) => {
Â  Â  Â  Â  Â  Â  Â  Â  const shareUrl = window.location.origin + window.location.pathname + '?post=' + postId;
Â  Â  Â  Â  Â  Â  Â  Â  if (navigator.share) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try { await navigator.share({ title: 'ØªØ·Ø¨ÙŠÙ‚ Ø²Ø§ÙŠÙ„Ùˆ', url: shareUrl }); } catch (err) {}
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(shareUrl).then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).catch(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tempInput = document.createElement("input");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tempInput.value = shareUrl;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(tempInput);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tempInput.select();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.execCommand("copy");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(tempInput);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  openSinglePost: (postId) => {
Â  Â  Â  Â  Â  Â  Â  Â  const post = Memory.posts.find(p => p.id === postId);
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('single-post-container');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(!post) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center py-20 opacity-60">Ø§Ù„Ù…Ù†Ø´ÙˆØ± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('single-post-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(App.isBlocked(post.authorId)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center py-20 opacity-60">Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¤ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('single-post-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const author = Memory.users[post.authorId];
Â  Â  Â  Â  Â  Â  Â  Â  if(!author) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center py-20 opacity-60">ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('single-post-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(author.isPrivate && author.uid !== currentUser.uid && !App.isFriend(currentUser.uid, author.uid)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center py-20 opacity-60">Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø®Ø§Øµ ÙˆÙ„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('single-post-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const parsedText = App.parseMentions(post.text);
Â  Â  Â  Â  Â  Â  Â  Â  const likesCount = post.likes ? post.likes.length : 0;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="theme-card rounded-2xl shadow-sm border overflow-hidden mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 flex items-center gap-3 cursor-pointer btn-tap" onclick="UI.openModal('profile-modal', '${author.uid}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${author.photo || App.getDefaultAvatar()}" class="w-12 h-12 rounded-full object-cover border border-gray-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold text-lg flex items-center gap-1 theme-text">${author.name}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm opacity-60">${App.timeAgo(post.timestamp)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="px-5 py-3 theme-text text-lg leading-relaxed whitespace-pre-wrap">${parsedText}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="px-5 py-3 text-sm opacity-60 border-t mt-2 flex justify-between" style="border-color: var(--border-color);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-blue-600">${likesCount} Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="UI.openModal('comments-modal', '${post.id}')" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl btn-tap shadow-md">Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('single-post-modal');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  renderComments: () => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!window.currentPostIdForComment) return;
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('comments-list');
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const postComments = Memory.comments
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(c => c.postId === window.currentPostIdForComment)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .sort((a,b) => a.timestamp - b.timestamp);

Â  Â  Â  Â  Â  Â  Â  Â  if(postComments.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-50 py-10 mt-10"><i class="ph ph-chat-centered text-4xl mb-2 block mx-auto"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§ØªØŒ ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¹Ù„Ù‚</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  postComments.forEach(c => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const author = Memory.users[c.authorId];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!author || App.isBlocked(author.uid)) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parsedText = App.parseMentions(c.text);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = 'flex gap-3 items-start';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${author.photo || App.getDefaultAvatar()}" class="w-10 h-10 rounded-full object-cover border border-gray-100 cursor-pointer btn-tap" onclick="UI.openProfileByUsername('${author.username}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="theme-bg rounded-2xl rounded-tr-sm p-3.5 inline-block min-w-[50%] max-w-full shadow-sm border">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="font-bold text-sm theme-text cursor-pointer flex items-center gap-1" onclick="UI.openProfileByUsername('${author.username}')">${author.name}</h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="theme-text text-[15px] mt-1 break-words">${parsedText}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[11px] opacity-60 mx-2 mt-1 block">${App.timeAgo(c.timestamp)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => container.scrollTop = container.scrollHeight, 10);
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  addComment: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const inputEl = document.getElementById('comment-input');
Â  Â  Â  Â  Â  Â  Â  Â  const text = inputEl.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  const postId = window.currentPostIdForComment;
Â  Â  Â  Â  Â  Â  Â  Â  if(!text || !postId) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  inputEl.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  inputEl.focus();Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, COMMENTS_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  postId: postId, authorId: currentUser.uid, text: text, timestamp: Date.now()
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const post = Memory.posts.find(p => p.id === postId);
Â  Â  Â  Â  Â  Â  Â  Â  if(post && post.authorId !== currentUser.uid && !App.isBlocked(post.authorId)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.sendNotification(post.authorId, 'Ø¹Ù„Ù‚ Ø¹Ù„Ù‰ Ù…Ù†Ø´ÙˆØ±Ùƒ', postId);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  App.notifyMentions(text, 'ØªØ¹Ù„ÙŠÙ‚', postId);
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // --- Ø¨Ø¯Ø§ÙŠØ© Ù†Ø¸Ø§Ù… Ø§Ù„Ø³ØªÙˆØ±ÙŠØ§Øª (Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª) Ø§Ù„Ù…Ø­Ø¯Ø« ---
Â  Â  Â  Â  Â  Â  renderNotes: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('notes-container');
Â  Â  Â  Â  Â  Â  Â  Â  const myBtnContainer = container.firstElementChild.outerHTML;
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = myBtnContainer;

Â  Â  Â  Â  Â  Â  Â  Â  const now = Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  const oneDay = 24 * 60 * 60 * 1000;
Â  Â  Â  Â  Â  Â  Â  Â  // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙØ¹Ø§Ù„Ø© ÙÙ‚Ø· ÙˆØªØ¬Ù…ÙŠØ¹Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
Â  Â  Â  Â  Â  Â  Â  Â  const activeNotes = Memory.notes.filter(n => (now - n.timestamp) < oneDay).sort((a,b) => a.timestamp - b.timestamp);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const groupedNotes = {};
Â  Â  Â  Â  Â  Â  Â  Â  activeNotes.forEach(n => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!groupedNotes[n.authorId]) groupedNotes[n.authorId] = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  groupedNotes[n.authorId].push(n);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const myNotes = groupedNotes[currentUser.uid] || [];
Â  Â  Â  Â  Â  Â  Â  Â  const myBtnEl = container.firstElementChild;
Â  Â  Â  Â  Â  Â  Â  Â  const myAvatar = myBtnEl.querySelector('#current-user-avatar-note');
Â  Â  Â  Â  Â  Â  Â  Â  const myPlusIcon = myBtnEl.querySelector('#my-note-plus-icon');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø±Ø³Ù… Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ù…Ù‚Ø·Ø¹Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Gradient)
Â  Â  Â  Â  Â  Â  Â  Â  const getConicGradient = (count, isAllViewed) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(count === 0) return '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(count === 1) return `conic-gradient(${isAllViewed ? '#9ca3af' : '#3b82f6'} 100%, transparent 0)`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const gap = 5; // Ø§Ù„ÙØ±Ø§Øº Ø¨Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const segment = (360 - (count * gap)) / count;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let grad = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let currentAngle = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const color = isAllViewed ? '#9ca3af' : '#3b82f6'; // Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ù‚ Ø£Ùˆ Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let i=0; i<count; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grad.push(`${color} ${currentAngle}deg ${currentAngle + segment}deg`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grad.push(`transparent ${currentAngle + segment}deg ${currentAngle + segment + gap}deg`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentAngle += segment + gap;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `conic-gradient(${grad.join(', ')})`;
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  if(myNotes.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isAllViewed = myNotes.every(n => n.viewers && n.viewers.includes(currentUser.uid));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myAvatar.parentElement.style.background = getConicGradient(myNotes.length, isAllViewed);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myAvatar.parentElement.style.padding = '3px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myAvatar.parentElement.style.borderRadius = '50%';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myAvatar.classList.replace('border-transparent', 'border-white');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„Ø³Ù‡Ù… Ø§Ù„ØµØºÙŠØ± Ù„Ù„Ø¥Ø¶Ø§ÙØ© (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ù‚Ù„ Ù…Ù† 5)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(myNotes.length < 5) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myPlusIcon.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myPlusIcon.innerHTML = '<i class="ph ph-plus text-white text-[10px] font-bold"></i>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myPlusIcon.onclick = (e) => { e.stopPropagation(); UI.openModal('create-note-modal'); };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myPlusIcon.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myBtnEl.onclick = () => App.startStorySession(currentUser.uid, groupedNotes);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myAvatar.src = currentUser.photo || App.getDefaultAvatar();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myAvatar.parentElement.style.background = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myAvatar.classList.replace('border-white', 'border-transparent');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myPlusIcon.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myBtnEl.onclick = () => UI.openModal('create-note-modal');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Ø±Ø³Ù… Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
Â  Â  Â  Â  Â  Â  Â  Â  Object.keys(groupedNotes).forEach(authorId => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(authorId === currentUser.uid) return; // ØªÙ… Ø±Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!App.isFriend(currentUser.uid, authorId) || App.isBlocked(authorId)) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const author = Memory.users[authorId];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!author) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userNotes = groupedNotes[authorId];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isAllViewed = userNotes.every(n => n.viewers && n.viewers.includes(currentUser.uid));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = 'inline-flex flex-col items-center cursor-pointer shrink-0 btn-tap w-16';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.style.scrollSnapAlign = 'start';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const shortName = author.name.split(' ')[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative rounded-full" style="background: ${getConicGradient(userNotes.length, isAllViewed)}; padding: 3px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${author.photo || App.getDefaultAvatar()}" class="w-14 h-14 rounded-full object-cover border-2 border-[var(--bg-color)] shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[11px] font-bold mt-1 w-full text-center truncate theme-text ${!isAllViewed ? 'text-blue-600' : ''}">${shortName}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.onclick = () => { App.startStorySession(authorId, groupedNotes); };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„ØªÙŠ Ù„Ù… ØªØ´Ø§Ù‡Ø¯Ù‡Ø§ ØªØ¸Ù‡Ø± Ø£ÙˆÙ„Ø§Ù‹
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(isAllViewed) container.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else container.insertBefore(el, container.children[1]);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // Ù…Ù†Ø·Ù‚ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ØªÙˆØ±ÙŠØ§Øª
Â  Â  Â  Â  Â  Â  storyTimer: null,
Â  Â  Â  Â  Â  Â  currentStoryAuthorId: null,
Â  Â  Â  Â  Â  Â  currentStoryIndex: 0,
Â  Â  Â  Â  Â  Â  allStoryGroups: {},
Â  Â  Â  Â  Â  Â  storyAuthorsOrder: [],

Â  Â  Â  Â  Â  Â  startStorySession: (authorId, groupedNotes) => {
Â  Â  Â  Â  Â  Â  Â  Â  App.allStoryGroups = groupedNotes;
Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¤Ù„ÙÙŠÙ† (Ø§Ù„Ø°ÙŠ Ø¶ØºØ·Øª Ø¹Ù„ÙŠÙ‡ Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù… Ø§Ù„Ø¨Ù‚ÙŠØ© Ø§Ù„Ø°ÙŠÙ† Ù„Ù… ØªØ´Ø§Ù‡Ø¯Ù‡Ù…)
Â  Â  Â  Â  Â  Â  Â  Â  App.storyAuthorsOrder = Object.keys(groupedNotes).filter(id => id !== currentUser.uid && App.isFriend(currentUser.uid, id) && !App.isBlocked(id));
Â  Â  Â  Â  Â  Â  Â  Â  if(authorId !== currentUser.uid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.storyAuthorsOrder = [authorId, ...App.storyAuthorsOrder.filter(id => id !== authorId)];
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.storyAuthorsOrder = [currentUser.uid]; // Ø¥Ø°Ø§ Ø¶ØºØ· Ø¹Ù„Ù‰ Ù†ÙØ³Ù‡ ÙŠØ´Ø§Ù‡Ø¯ Ù†ÙØ³Ù‡ ÙÙ‚Ø·
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  App.currentStoryAuthorId = authorId;
Â  Â  Â  Â  Â  Â  Â  Â  App.currentStoryIndex = 0;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ø³ØªÙˆØ±ÙŠ ØºÙŠØ± Ù…Ø´Ø§Ù‡ÙØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
Â  Â  Â  Â  Â  Â  Â  Â  const notes = App.allStoryGroups[authorId];
Â  Â  Â  Â  Â  Â  Â  Â  const firstUnreadIndex = notes.findIndex(n => !(n.viewers && n.viewers.includes(currentUser.uid)));
Â  Â  Â  Â  Â  Â  Â  Â  if(firstUnreadIndex !== -1) App.currentStoryIndex = firstUnreadIndex;

Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('note-view-modal');
Â  Â  Â  Â  Â  Â  Â  Â  App.renderCurrentStory();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø³ØªÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ Ø¨Ø§Ù„ÙˆØ³Ø·
Â  Â  Â  Â  Â  Â  Â  Â  const pauseArea = document.getElementById('story-pause-area');
Â  Â  Â  Â  Â  Â  Â  Â  pauseArea.onmousedown = () => clearTimeout(App.storyTimer);
Â  Â  Â  Â  Â  Â  Â  Â  pauseArea.ontouchstart = () => clearTimeout(App.storyTimer);
Â  Â  Â  Â  Â  Â  Â  Â  pauseArea.onmouseup = () => App.resumeStoryTimer();
Â  Â  Â  Â  Â  Â  Â  Â  pauseArea.ontouchend = () => App.resumeStoryTimer();
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  renderCurrentStory: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(App.storyTimer);
Â  Â  Â  Â  Â  Â  Â  Â  const authorId = App.currentStoryAuthorId;
Â  Â  Â  Â  Â  Â  Â  Â  const notes = App.allStoryGroups[authorId];
Â  Â  Â  Â  Â  Â  Â  Â  const author = Memory.users[authorId];
Â  Â  Â  Â  Â  Â  Â  Â  if(!notes || !author) return App.closeStoryViewer();

Â  Â  Â  Â  Â  Â  Â  Â  const note = notes[App.currentStoryIndex];
Â  Â  Â  Â  Â  Â  Â  Â  window.noteViewId = note.id;
Â  Â  Â  Â  Â  Â  Â  Â  window.noteViewAuthorId = authorId;

Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-avatar').src = author.photo || App.getDefaultAvatar();
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-name').innerText = author.name;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-time').innerText = App.timeAgo(note.timestamp);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-text').innerHTML = App.parseMentions(note.text);

Â  Â  Â  Â  Â  Â  Â  Â  // Ø±Ø³Ù… Ø£Ø´Ø±Ø·Ø© Ø§Ù„ØªÙ‚Ø¯Ù…
Â  Â  Â  Â  Â  Â  Â  Â  const progContainer = document.getElementById('story-progress-container');
Â  Â  Â  Â  Â  Â  Â  Â  progContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  notes.forEach((n, idx) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const bar = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bar.className = 'flex-1 h-1 bg-white/30 rounded-full overflow-hidden';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let innerClass = 'h-full bg-white transition-all duration-[5000ms] ease-linear w-0';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(idx < App.currentStoryIndex) innerClass = 'h-full bg-white w-full'; // ØªÙ…Øª Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (idx === App.currentStoryIndex) innerClass = 'h-full bg-white w-0'; // Ø§Ù„Ø­Ø§Ù„ÙŠ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bar.innerHTML = `<div id="story-prog-inner-${idx}" class="${innerClass}"></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progContainer.appendChild(bar);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„ÙŠ
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentBar = document.getElementById(`story-prog-inner-${App.currentStoryIndex}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(currentBar) currentBar.style.width = '100%';
Â  Â  Â  Â  Â  Â  Â  Â  }, 50);

Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
Â  Â  Â  Â  Â  Â  Â  Â  if(authorId !== currentUser.uid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let viewers = note.viewers || [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!viewers.includes(currentUser.uid)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  viewers.push(currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try { await updateDoc(doc(db, NOTES_PATH, note.id), { viewers }); } catch(e){}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-reply-section').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-reply-section').classList.add('flex');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-viewers-section').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-options-btn').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-reply-section').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-viewers-section').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-viewers-section').classList.add('flex');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-options-btn').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-viewers-count').innerText = (note.viewers || []).length;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-options-btn').onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.openManageNote(note.id, note.text);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.closeStoryViewer();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  App.resumeStoryTimer();
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  resumeStoryTimer: () => {
Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(App.storyTimer);
Â  Â  Â  Â  Â  Â  Â  Â  App.storyTimer = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.nextStory();
Â  Â  Â  Â  Â  Â  Â  Â  }, 5000); // 5 Ø«ÙˆØ§Ù†ÙŠ Ù„ÙƒÙ„ Ø³ØªÙˆØ±ÙŠ
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  nextStory: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const notes = App.allStoryGroups[App.currentStoryAuthorId];
Â  Â  Â  Â  Â  Â  Â  Â  if(App.currentStoryIndex < notes.length - 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.currentStoryIndex++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderCurrentStory();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ§Ù„ÙŠ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentAuthorIdx = App.storyAuthorsOrder.indexOf(App.currentStoryAuthorId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(currentAuthorIdx !== -1 && currentAuthorIdx < App.storyAuthorsOrder.length - 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.currentStoryAuthorId = App.storyAuthorsOrder[currentAuthorIdx + 1];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.currentStoryIndex = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderCurrentStory();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.closeStoryViewer();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  prevStory: () => {
Â  Â  Â  Â  Â  Â  Â  Â  if(App.currentStoryIndex > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.currentStoryIndex--;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderCurrentStory();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentAuthorIdx = App.storyAuthorsOrder.indexOf(App.currentStoryAuthorId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(currentAuthorIdx > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.currentStoryAuthorId = App.storyAuthorsOrder[currentAuthorIdx - 1];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.currentStoryIndex = App.allStoryGroups[App.currentStoryAuthorId].length - 1; // Ø¢Ø®Ø± Ø³ØªÙˆØ±ÙŠ Ù„Ù‡
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderCurrentStory();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  closeStoryViewer: () => {
Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(App.storyTimer);
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('note-view-modal');
Â  Â  Â  Â  Â  Â  Â  Â  App.renderNotes(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± Ø¨Ø§Ù„Ø®Ø§Ø±Ø¬
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  // --- Ù†Ù‡Ø§ÙŠØ© Ù†Ø¸Ø§Ù… Ø§Ù„Ø³ØªÙˆØ±ÙŠØ§Øª ---
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  viewNoteFull: async (note, author) => {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-avatar').src = author.photo || App.getDefaultAvatar();
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-name').innerText = author.name;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-time').innerText = App.timeAgo(note.timestamp);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-text').innerHTML = App.parseMentions(note.text);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  window.noteViewAuthorId = author.uid;
Â  Â  Â  Â  Â  Â  Â  Â  window.noteViewId = note.id;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(author.uid !== currentUser.uid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let viewers = note.viewers || [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!viewers.includes(currentUser.uid)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  viewers.push(currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try { await updateDoc(doc(db, NOTES_PATH, note.id), { viewers }); } catch(e){}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-reply-section').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-reply-section').classList.add('flex');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-viewers-section').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-options-btn').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-reply-input').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-reply-section').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-reply-section').classList.remove('flex');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-viewers-section').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-viewers-section').classList.add('flex');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-options-btn').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('note-viewers-count').innerText = (note.viewers || []).length;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nv-options-btn').onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.openManageNote(note.id, note.text);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('note-view-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('note-view-modal');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showNoteViewers: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const note = Memory.notes.find(n => n.id === window.noteViewId);
Â  Â  Â  Â  Â  Â  Â  Â  if(!note) return;
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('viewers-list-container');
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  const viewers = note.viewers || [];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(viewers.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-60 py-10 mt-10">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ù‡Ø¯ÙˆÙ† Ø¨Ø¹Ø¯</div>';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  viewers.forEach(uid => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const u = Memory.users[uid];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!u) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = 'flex items-center gap-3 p-3 theme-bg rounded-2xl border mb-2 cursor-pointer btn-tap';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.onclick = () => { UI.closeModal('viewers-list-modal'); UI.closeModal('note-view-modal'); UI.openModal('profile-modal', u.uid); };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${u.photo || App.getDefaultAvatar()}" class="w-10 h-10 rounded-full object-cover border">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold theme-text">${u.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('viewers-list-modal');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  viewProfileFromNote: () => {
Â  Â  Â  Â  Â  Â  Â  Â  if(window.noteViewAuthorId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('note-view-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('profile-modal', window.noteViewAuthorId);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  sendNoteReply: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const inputEl = document.getElementById('note-reply-input');
Â  Â  Â  Â  Â  Â  Â  Â  const text = inputEl.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if(!text || !window.noteViewAuthorId) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const note = Memory.notes.find(n => n.id === window.noteViewId);
Â  Â  Â  Â  Â  Â  Â  Â  if(!note) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  inputEl.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  inputEl.focus();

Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, MESSAGES_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  participants: [currentUser.uid, window.noteViewAuthorId],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  senderId: currentUser.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: text,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: Date.now(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  read: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isNoteReply: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  replyNoteText: note.textÂ 
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ Ù„Ù„Ø®Ø§Øµ');
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('note-view-modal');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  checkAndCreateNote: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const myActiveNote = Memory.notes.find(n => n.authorId === currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  if(myActiveNote) App.viewNoteFull(myActiveNote, currentUser);Â 
Â  Â  Â  Â  Â  Â  Â  Â  else UI.openModal('create-note-modal');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  createNote: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const text = document.getElementById('note-text-input').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if(!text) return UI.showMessage('Ø§ÙƒØªØ¨ Ø´ÙŠØ¦Ø§Ù‹');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ø¯Ø¯ (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5 Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù†Ø´Ø·Ø©)
Â  Â  Â  Â  Â  Â  Â  Â  const now = Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  const oneDay = 24 * 60 * 60 * 1000;
Â  Â  Â  Â  Â  Â  Â  Â  const myActiveNotes = Memory.notes.filter(n => n.authorId === currentUser.uid && (now - n.timestamp) < oneDay);
Â  Â  Â  Â  Â  Â  Â  Â  if(myActiveNotes.length >= 5) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return UI.showMessage('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø´Ø± Ø£ÙƒØ«Ø± Ù…Ù† 5 Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙÙŠ Ø§Ù„ÙŠÙˆÙ…');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('create-note-modal');
Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, NOTES_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  authorId: currentUser.uid, text: text, timestamp: Date.now(), viewers: []
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  App.notifyMentions(text, 'Ù…Ù„Ø§Ø­Ø¸Ø©', null);
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© (ØµØ§Ù„Ø­Ø© Ù„Ù€ 24 Ø³Ø§Ø¹Ø©)');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  openManageNote: (id, currentText) => {
Â  Â  Â  Â  Â  Â  Â  Â  window.currentManageNoteId = id;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-note-input').value = currentText;
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('manage-note-modal');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  updateNote: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const newText = document.getElementById('edit-note-input').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if(!newText || !window.currentManageNoteId) return;
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, NOTES_PATH, window.currentManageNoteId), { text: newText });
Â  Â  Â  Â  Â  Â  Â  Â  App.notifyMentions(newText, 'Ù…Ù„Ø§Ø­Ø¸Ø©', null);
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('manage-note-modal');
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  deleteNote: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!window.currentManageNoteId) return;
Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, NOTES_PATH, window.currentManageNoteId));
Â  Â  Â  Â  Â  Â  Â  Â  window.currentManageNoteId = null;
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('manage-note-modal');
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  switchFriendsSubTab: (tabId) => {
Â  Â  Â  Â  Â  Â  Â  Â  ['requests', 'friends', 'suggestions'].forEach(id => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`subtab-${id}`).className = 'flex-1 py-3 text-center text-sm font-bold sub-tab-inactive btn-tap transition-colors';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`subtab-content-${id}`).classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`subtab-${tabId}`).className = 'flex-1 py-3 text-center text-sm font-bold sub-tab-active btn-tap transition-colors';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`subtab-content-${tabId}`).classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  App.renderFriendsTab(tabId);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  renderFriendsTab: (tabId) => {
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById(`subtab-content-${tabId}`);
Â  Â  Â  Â  Â  Â  Â  Â  if(!container) return;
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  if(tabId === 'requests') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const myRequests = Memory.requests.filter(r => r.to === currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(myRequests.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-50 py-10 mt-6"><i class="ph ph-user-plus text-4xl mb-2 block mx-auto"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myRequests.forEach(req => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fromUser = Memory.users[req.from];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!fromUser || App.isBlocked(fromUser.uid)) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = 'flex flex-col p-3 theme-card rounded-2xl border shadow-sm gap-3';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3 cursor-pointer group" onclick="UI.openModal('profile-modal', '${fromUser.uid}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${fromUser.photo || App.getDefaultAvatar()}" class="w-12 h-12 rounded-full object-cover border border-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold theme-text group-hover:text-blue-600 truncate flex items-center gap-1">${fromUser.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs opacity-60">${App.timeAgo(req.timestamp)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2 w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.acceptRequest('${req.id}', '${req.from}')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-xl btn-tap shadow-sm transition-colors text-sm">Ù‚Ø¨ÙˆÙ„</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.declineRequest('${req.id}')" class="flex-1 theme-bg border font-bold py-2 rounded-xl btn-tap transition-colors text-sm">Ø±ÙØ¶</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } else if (tabId === 'friends') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const myFriendsRelations = Memory.friends.filter(f => f.user1 === currentUser.uid || f.user2 === currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const myFriends = myFriendsRelations.map(f => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const friendId = f.user1 === currentUser.uid ? f.user2 : f.user1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return Memory.users[friendId];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).filter(u => u !== undefined && !App.isBlocked(u.uid));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(myFriends.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-50 py-10 mt-6"><i class="ph ph-users text-4xl mb-2 block mx-auto"></i>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myFriends.forEach(u => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = 'flex items-center gap-3 p-3 theme-card hover:opacity-80 rounded-2xl cursor-pointer btn-tap border shadow-sm transition-colors';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.onclick = () => UI.openModal('profile-modal', u.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${u.photo || App.getDefaultAvatar()}" class="w-12 h-12 rounded-full object-cover border border-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold theme-text flex items-center gap-1">${u.name}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-60 font-medium">@${u.username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } else if (tabId === 'suggestions') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const friendsIds = Memory.friends.map(f => f.user1 === currentUser.uid ? f.user2 : (f.user2 === currentUser.uid ? f.user1 : null)).filter(id => id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const requestedIds = Memory.requests.filter(r => r.from === currentUser.uid).map(r => r.to);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let suggestions = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const friendsOfFriends = new Set();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  friendsIds.forEach(friendId => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const friendFriends = Memory.friends
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(f => f.user1 === friendId || f.user2 === friendId)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .map(f => f.user1 === friendId ? f.user2 : f.user1)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(id =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id !== currentUser.uid &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  !friendsIds.includes(id) &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  !requestedIds.includes(id) &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  !App.isBlocked(id)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  friendFriends.forEach(id => friendsOfFriends.add(id));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let otherSuggestions = Object.values(Memory.users).filter(u =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.uid !== currentUser.uid &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  !friendsIds.includes(u.uid) &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  !requestedIds.includes(u.uid) &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  !App.isBlocked(u.uid) &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.allowRequests !== false &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.showInSuggestions !== false &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.gender === currentUser.gender
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  suggestions = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...Array.from(friendsOfFriends).map(id => Memory.users[id]).filter(u => u && u.gender === currentUser.gender && u.showInSuggestions !== false),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...otherSuggestions.filter(u => !friendsOfFriends.has(u.uid))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  suggestions = suggestions.slice(0, 10);Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(suggestions.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-50 py-10 mt-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  suggestions.forEach(u => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = 'flex items-center gap-3 p-3 theme-card rounded-2xl border shadow-sm';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${u.photo || App.getDefaultAvatar()}" class="w-12 h-12 rounded-full object-cover border border-gray-200 cursor-pointer btn-tap" onclick="UI.openModal('profile-modal', '${u.uid}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 cursor-pointer" onclick="UI.openModal('profile-modal', '${u.uid}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold theme-text flex items-center gap-1">${u.name}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-60 font-medium">@${u.username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.sendFriendRequest('${u.uid}')" class="bg-blue-50 text-blue-600 px-4 py-1.5 rounded-full font-bold text-sm btn-tap hover:bg-blue-100">Ø¥Ø¶Ø§ÙØ©</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  sendFriendRequest: async (toUid) => {
Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, REQUESTS_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from: currentUser.uid, to: toUid, timestamp: Date.now()
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  App.sendNotification(toUid, 'Ø£Ø±Ø³Ù„ Ù„Ùƒ Ø·Ù„Ø¨ ØµØ¯Ø§Ù‚Ø©', null);
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨');
Â  Â  Â  Â  Â  Â  Â  Â  App.renderFriendsTab('suggestions');
Â  Â  Â  Â  Â  Â  Â  Â  if(!document.getElementById('profile-modal').classList.contains('hidden')) App.renderUserProfile(toUid);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  cancelRequest: async (reqId, uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, REQUESTS_PATH, reqId));
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨');
Â  Â  Â  Â  Â  Â  Â  Â  if(uid && !document.getElementById('profile-modal').classList.contains('hidden')) App.renderUserProfile(uid);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  acceptRequest: async (reqId, fromUid) => {
Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, REQUESTS_PATH, reqId));
Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, FRIENDS_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  user1: currentUser.uid, user2: fromUid, timestamp: Date.now()
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  App.sendNotification(fromUid, 'ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø©', null);
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨');
Â  Â  Â  Â  Â  Â  Â  Â  if(!document.getElementById('profile-modal').classList.contains('hidden')) App.renderUserProfile(fromUid);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  declineRequest: async (reqId) => {
Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, REQUESTS_PATH, reqId));
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  unfriend: async (uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµØ¯Ø§Ù‚Ø©ØŸ')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const friendship = Memory.friends.find(f =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (f.user1 === currentUser.uid && f.user2 === uid) ||Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (f.user1 === uid && f.user2 === currentUser.uid)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(friendship) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, FRIENDS_PATH, friendship.id));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµØ¯Ø§Ù‚Ø©');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!document.getElementById('profile-modal').classList.contains('hidden')) App.renderUserProfile(uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  blockUser: async (uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const updatedBlocks = [...(currentUser.blockedUsers || []), uid];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, USERS_PATH, currentUser.uid), { blockedUsers: updatedBlocks });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser.blockedUsers = updatedBlocks;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const friendship = Memory.friends.find(f =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (f.user1 === currentUser.uid && f.user2 === uid) ||Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (f.user1 === uid && f.user2 === currentUser.uid)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(friendship) await deleteDoc(doc(db, FRIENDS_PATH, friendship.id));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('chat-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø§Ù„Ø­Ø¸Ø± Ø¨Ù†Ø¬Ø§Ø­');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.startCore();Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  unblockUser: async (uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  const updatedBlocks = (currentUser.blockedUsers || []).filter(id => id !== uid);
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, USERS_PATH, currentUser.uid), { blockedUsers: updatedBlocks });
Â  Â  Â  Â  Â  Â  Â  Â  currentUser.blockedUsers = updatedBlocks;
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¸Ø±');
Â  Â  Â  Â  Â  Â  Â  Â  if(!document.getElementById('blocked-users-modal').classList.contains('hidden')){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderBlockedUsers();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if(!document.getElementById('profile-modal').classList.contains('hidden')){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderUserProfile(uid);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  renderBlockedUsers: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('blocked-list-container');
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  const blockedList = currentUser.blockedUsers || [];
Â  Â  Â  Â  Â  Â  Â  Â  if(blockedList.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-50 py-20 mt-10"><i class="ph ph-prohibit text-4xl mb-2 block mx-auto"></i>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  blockedList.forEach(uid => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const u = Memory.users[uid];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!u) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = 'flex items-center gap-3 p-3 theme-card rounded-2xl border mb-2';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${u.photo || App.getDefaultAvatar()}" class="w-12 h-12 rounded-full object-cover border border-gray-200 cursor-pointer btn-tap" onclick="UI.openModal('profile-modal', '${u.uid}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 cursor-pointer" onclick="UI.openModal('profile-modal', '${u.uid}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold theme-text">${u.name}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-60 font-medium">@${u.username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-gray-200 text-gray-800 px-3 py-1.5 rounded-full font-bold text-sm btn-tap" onclick="App.unblockUser('${u.uid}')">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¸Ø±</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  searchUsers: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const query = document.getElementById('search-input').value.toLowerCase().trim();
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('search-results');
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  if(!query) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-50 py-10 mt-10"><i class="ph ph-magnifying-glass text-4xl mb-2 block mx-auto"></i>Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const results = Object.values(Memory.users).filter(u =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.uid !== currentUser.uid &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  !App.isBlocked(u.uid) &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (u.name.toLowerCase().includes(query) || u.username.toLowerCase().includes(query))
Â  Â  Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  Â  Â  if(results.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-50 py-10 mt-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  results.forEach(u => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = 'flex items-center gap-3 p-3 theme-card hover:opacity-80 rounded-2xl cursor-pointer btn-tap border transition-colors';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('search-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('profile-modal', u.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${u.photo || App.getDefaultAvatar()}" class="w-12 h-12 rounded-full object-cover border border-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold theme-text flex items-center gap-1">${u.name}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-60 font-medium">@${u.username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  renderUserProfile: (uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  const u = Memory.users[uid];
Â  Â  Â  Â  Â  Â  Â  Â  if(!u) return;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vp-name').innerText = u.name;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vp-username').innerText = '@' + u.username;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vp-bio').innerText = u.bio || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vp-image').src = u.photo || App.getDefaultAvatar();

Â  Â  Â  Â  Â  Â  Â  Â  // Ø­Ø³Ø§Ø¨ Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ± Ø¨Ø¯Ù‚Ø©
Â  Â  Â  Â  Â  Â  Â  Â  const isOnline = App.isOnline(u.lastActive);
Â  Â  Â  Â  Â  Â  Â  Â  if(isOnline) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vp-last-seen').innerText = 'Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vp-last-seen').className = 'text-blue-500 text-sm mt-1 font-medium';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const date = new Date(u.lastActive);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dateStr = date.toLocaleDateString('ar-EG', { day: 'numeric', month: 'long' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeStr = date.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vp-last-seen').innerText = `Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ± ${dateStr} Ø§Ù„Ø³Ø§Ø¹Ø© ${timeStr}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vp-last-seen').className = 'text-gray-500 dark:text-gray-400 text-sm mt-1';
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const actionContainer = document.getElementById('vp-action-container');
Â  Â  Â  Â  Â  Â  Â  Â  actionContainer.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  const isMe = uid === currentUser.uid;
Â  Â  Â  Â  Â  Â  Â  Â  const isFriend = App.isFriend(currentUser.uid, uid);
Â  Â  Â  Â  Â  Â  Â  Â  const hasSentReq = Memory.requests.some(r => r.from === currentUser.uid && r.to === uid);
Â  Â  Â  Â  Â  Â  Â  Â  const hasReceivedReq = Memory.requests.some(r => r.from === uid && r.to === currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  const receivedReqId = hasReceivedReq ? Memory.requests.find(r => r.from === uid && r.to === currentUser.uid).id : null;
Â  Â  Â  Â  Â  Â  Â  Â  const sentReqId = hasSentReq ? Memory.requests.find(r => r.from === currentUser.uid && r.to === uid).id : null;
Â  Â  Â  Â  Â  Â  Â  Â  const isBlocked = App.isBlocked(uid);
Â  Â  Â  Â  Â  Â  Â  Â  const isMuted = App.isMuted(uid);
Â  Â  Â  Â  Â  Â  Â  Â  const canMessage = u.messagePrivacy === 'all' || (u.messagePrivacy === 'friends' && isFriend) || (u.messagePrivacy === 'only_me' && isMe);

Â  Â  Â  Â  Â  Â  Â  Â  const btnClass = "flex flex-col items-center justify-center bg-white dark:bg-gray-800 rounded-2xl w-20 h-16 shadow-sm btn-tap gap-1 text-gray-800 dark:text-white";
Â  Â  Â  Â  Â  Â  Â  Â  const iconClass = "text-2xl";
Â  Â  Â  Â  Â  Â  Â  Â  const textClass = "text-[11px] font-medium";

Â  Â  Â  Â  Â  Â  Â  Â  if (isMe) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionContainer.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="copyProfileLink('${u.username}')" class="${btnClass} w-24">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-copy ${iconClass}"></i><span class="${textClass}">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (isBlocked) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionContainer.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.unblockUser('${uid}')" class="${btnClass} w-24 text-red-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-lock-key-open ${iconClass}"></i><span class="${textClass}">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¸Ø±</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let buttons = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 1. Ø²Ø± Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (canMessage) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttons += `<button onclick="UI.closeModal('profile-modal'); UI.openModal('chat-modal', '${uid}')" class="${btnClass}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-chat-circle ${iconClass}"></i><span class="${textClass}">Ù…Ø±Ø§Ø³Ù„Ø©</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 2. Ø²Ø± Ø§Ù„ÙƒØªÙ…
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttons += `<button onclick="App.toggleMutePermanent('${uid}')" class="${btnClass}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ${isMuted ? 'ph-bell-simple-slash' : 'ph-bell-simple'} ${iconClass}"></i><span class="${textClass}">${isMuted ? 'Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ…' : 'ÙƒØªÙ…'}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 3. Ø²Ø± Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttons += `<button onclick="copyProfileLink('${u.username}')" class="${btnClass}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-link ${iconClass}"></i><span class="${textClass}">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 4. Ø²Ø± Ø§Ù„ØµØ¯Ø§Ù‚Ø©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isFriend) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttons += `<button onclick="App.unfriend('${uid}')" class="${btnClass} text-red-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-user-minus ${iconClass}"></i><span class="${textClass}">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØµØ¯Ø§Ù‚Ø©</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (hasReceivedReq) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttons += `<button onclick="App.acceptRequest('${receivedReqId}', '${uid}')" class="${btnClass} text-green-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-check ${iconClass}"></i><span class="${textClass}">Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (hasSentReq) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttons += `<button onclick="App.cancelRequest('${sentReqId}', '${uid}')" class="${btnClass}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-x ${iconClass}"></i><span class="${textClass}">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (u.allowRequests !== false) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttons += `<button onclick="App.sendFriendRequest('${uid}')" class="${btnClass}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-user-plus ${iconClass}"></i><span class="${textClass}">Ø¥Ø¶Ø§ÙØ©</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionContainer.innerHTML = buttons;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const friendsGrid = document.getElementById('vp-friends-grid');
Â  Â  Â  Â  Â  Â  Â  Â  friendsGrid.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let canSeeFriends = false;
Â  Â  Â  Â  Â  Â  Â  Â  if(isMe || u.friendsVisibility === 'all') canSeeFriends = true;
Â  Â  Â  Â  Â  Â  Â  Â  else if (u.friendsVisibility === 'friends' && isFriend) canSeeFriends = true;

Â  Â  Â  Â  Â  Â  Â  Â  if (canSeeFriends && !isBlocked) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userFriendsRelations = Memory.friends.filter(f => f.user1 === uid || f.user2 === uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userFriendsIds = userFriendsRelations.map(f => f.user1 === uid ? f.user2 : f.user1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vp-friends-count-text').innerText = userFriendsIds.length;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(userFriendsIds.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const friendsToShow = userFriendsIds.slice(0, 6);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  friendsToShow.forEach(fid => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const friend = Memory.users[fid];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(friend) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = 'flex flex-col items-center gap-1 cursor-pointer btn-tap';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.onclick = () => UI.openModal('profile-modal', fid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${friend.photo || App.getDefaultAvatar()}" class="w-full aspect-square rounded-xl object-cover border border-gray-200 shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[11px] font-bold theme-text w-full text-center truncate px-1">${friend.name.split(' ')[0]}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  friendsGrid.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  friendsGrid.innerHTML = '<div class="col-span-3 text-center opacity-50 py-4 text-sm">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµØ¯Ù‚Ø§Ø¡</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vp-friends-count-text').innerText = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  friendsGrid.innerHTML = '<div class="col-span-3 text-center opacity-50 py-4 text-sm"><i class="ph ph-lock-key text-xl block mb-1"></i>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø®Ø§ØµØ©</div>';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  showMessageOptions: (msgId, isMe, text, isPinned) => {
Â  Â  Â  Â  Â  Â  Â  Â  const content = document.getElementById('action-modal-content');
Â  Â  Â  Â  Â  Â  Â  Â  let buttons = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.copyText('${escapeHTML(text).replace(/'/g, "\\'")}')" class="w-full flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-black/5 btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ù†Ø³Ø® Ø§Ù„Ù†Øµ</span> <i class="ph-fill ph-copy text-lg text-gray-500"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.togglePinMessage('${msgId}', ${isPinned})" class="w-full flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-black/5 btn-tap text-blue-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${isPinned ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª' : 'ØªØ«Ø¨ÙŠØª'}</span> <i class="ph-fill ${isPinned ? 'ph-push-pin-slash' : 'ph-push-pin'} text-lg"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(isMe) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttons += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.editMessage('${msgId}')" class="w-full flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-green-50 btn-tap text-green-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ØªØ¹Ø¯ÙŠÙ„</span> <i class="ph-fill ph-pencil-simple text-lg"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  buttons += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isMe ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.deleteMessage('${msgId}', 'all')" class="w-full flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-red-50 btn-tap text-red-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø­Ø°Ù Ù„Ù„Ø¬Ù…ÙŠØ¹</span> <i class="ph-fill ph-trash text-lg"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.deleteMessage('${msgId}', 'me')" class="w-full flex justify-between items-center p-4 hover:bg-orange-50 btn-tap text-orange-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø­Ø°Ù Ù…Ù† Ø¹Ù†Ø¯ÙŠ</span> <i class="ph-fill ph-trash-simple text-lg"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  content.innerHTML = buttons;
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('action-modal');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  editMessage: async (msgId) => {
Â  Â  Â  Â  Â  Â  Â  Â  const msg = Memory.messages.find(m => m.id === msgId);
Â  Â  Â  Â  Â  Â  Â  Â  const newText = prompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', msg.text);
Â  Â  Â  Â  Â  Â  Â  Â  if(newText && newText.trim() && newText !== msg.text) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹ (Optimistic UI)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  msg.text = newText.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  msg.edited = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const allMsgIndex = window.allMessages.findIndex(m => m.id === msgId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(allMsgIndex !== -1) window.allMessages[allMsgIndex].text = newText.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderMessages(true); // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ…Ø±ÙŠØ±
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateDoc(doc(db, MESSAGES_PATH, msgId), { text: newText.trim(), edited: true });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  copyText: (text) => {
Â  Â  Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(text).then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage("ØªÙ… Ø§Ù„Ù†Ø³Ø®!");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');
Â  Â  Â  Â  Â  Â  Â  Â  }).catch(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tempInput = document.createElement("textarea");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tempInput.value = text;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(tempInput);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tempInput.select();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.execCommand("copy");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(tempInput);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage("ØªÙ… Ø§Ù„Ù†Ø³Ø®!");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  togglePinMessage: async (msgId, isPinned) => {
Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø±ÙÙŠÙ†
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, MESSAGES_PATH, msgId), { pinned: !isPinned });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙˆØ±Ø§Ù‹ Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
Â  Â  Â  Â  Â  Â  Â  Â  const msgIndex = window.allMessages.findIndex(m => m.id === msgId);
Â  Â  Â  Â  Â  Â  Â  Â  if(msgIndex !== -1) window.allMessages[msgIndex].pinned = !isPinned;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const memoryIndex = Memory.messages.findIndex(m => m.id === msgId);
Â  Â  Â  Â  Â  Â  Â  Â  if(memoryIndex !== -1) Memory.messages[memoryIndex].pinned = !isPinned;

Â  Â  Â  Â  Â  Â  Â  Â  App.renderMessages(true); // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ø§Ø¸Ù‡Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„ØªØ«Ø¨ÙŠØª
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage(isPinned ? "ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª Ù…Ù† Ø§Ù„Ø·Ø±ÙÙŠÙ†" : "ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø·Ø±ÙÙŠÙ†");
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  deleteMessage: async (msgId, type) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(type === 'all') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, MESSAGES_PATH, msgId));
Â  Â  Â  Â  Â  Â  Â  Â  } else if (type === 'me') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, MESSAGES_PATH, msgId), { deletedFor: arrayUnion(currentUser.uid) });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showReactionsModal: (msgId) => {
Â  Â  Â  Â  Â  Â  Â  Â  window.currentReactionMsgId = msgId;
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('reactions-modal');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  selectReaction: (emoji) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(window.currentReactionMsgId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.reactToMessage(window.currentReactionMsgId, emoji);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('reactions-modal');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  reactToMessage: async (msgId, reactionEmoji) => {
Â  Â  Â  Â  Â  Â  Â  Â  const msg = Memory.messages.find(m => m.id === msgId);
Â  Â  Â  Â  Â  Â  Â  Â  if(!msg) return;
Â  Â  Â  Â  Â  Â  Â  Â  const currentReactions = msg.reactions || {};
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø¥Ø°Ø§ Ø¶ØºØ· Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙŠØ­Ø°ÙÙ‡ØŒ ÙˆØ¥Ø°Ø§ Ø§Ø®ØªØ§Ø± ÙˆØ§Ø­Ø¯ Ø¬Ø¯ÙŠØ¯ ÙŠØ³ØªØ¨Ø¯Ù„Ù‡
Â  Â  Â  Â  Â  Â  Â  Â  if(currentReactions[currentUser.uid] === reactionEmoji) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  delete currentReactions[currentUser.uid];
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentReactions[currentUser.uid] = reactionEmoji;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‡Ù…ÙŠ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©
Â  Â  Â  Â  Â  Â  Â  Â  msg.reactions = currentReactions;
Â  Â  Â  Â  Â  Â  Â  Â  App.renderMessages();Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, MESSAGES_PATH, msgId), { reactions: currentReactions });
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  showPinChatPopup: (otherUid) => {
Â  Â  Â  Â  Â  Â  Â  Â  window.pinChatTarget = otherUid;
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('pin-chat-popup');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  pinChat: async (type) => {
Â  Â  Â  Â  Â  Â  Â  Â  const otherUid = window.pinChatTarget;
Â  Â  Â  Â  Â  Â  Â  Â  if(!otherUid) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const existingPin = Memory.pins.find(p =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  p.userId === currentUser.uid && p.chatId === otherUid
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  if(existingPin) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, PINS_PATH, existingPin.id));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, PINS_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId: currentUser.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatId: otherUid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: type,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: Date.now()
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  unpinChat: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const otherUid = window.pinChatTarget;
Â  Â  Â  Â  Â  Â  Â  Â  if(!otherUid) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const existingPin = Memory.pins.find(p =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  p.userId === currentUser.uid && p.chatId === otherUid
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  if(existingPin) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, PINS_PATH, existingPin.id));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  toggleMuteChat: () => {
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('mute-chat-popup');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  muteChat: async (hours) => {
Â  Â  Â  Â  Â  Â  Â  Â  const otherUid = window.currentChatUserId;
Â  Â  Â  Â  Â  Â  Â  Â  if(!otherUid) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const existingMute = Memory.mutes.find(m =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m.userId === currentUser.uid && m.chatId === otherUid
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  if(existingMute) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, MUTES_PATH, existingMute.id));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(hours > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, MUTES_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId: currentUser.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatId: otherUid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  until: Date.now() + (hours * 60 * 60 * 1000)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage(`ØªÙ… ÙƒØªÙ… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù…Ø¯Ø© ${hours} Ø³Ø§Ø¹Ø©`);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const muteBtn = document.getElementById('chat-mute-btn').querySelector('i');
Â  Â  Â  Â  Â  Â  Â  Â  if(hours > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  muteBtn.className = 'ph-fill ph-bell-simple-slash text-lg';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  muteBtn.className = 'ph ph-bell-simple-z text-lg';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© showChatOptions Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯:
showChatOptions: (otherUid, event) => {
Â  Â  if (event) {
Â  Â  Â  Â  event.stopPropagation();
Â  Â  }
Â  Â Â 
Â  Â  const isMyFriend = App.isFriend(currentUser.uid, otherUid);
Â  Â  const content = document.getElementById('action-modal-content');
Â  Â Â 
Â  Â  const isPinned = Memory.pins.some(p =>Â 
Â  Â  Â  Â  p.userId === currentUser.uid && p.chatId === otherUid
Â  Â  );
Â  Â Â 
Â  Â  let buttons = '';
Â  Â Â 
Â  Â  if(isPinned) {
Â  Â  Â  Â  buttons += `
Â  Â  Â  Â  Â  Â  <button onclick="App.unpinChatFromOptions('${otherUid}')" class="w-full flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-black/5 btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø¥Ù„ØºØ§Ø¡ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</span> <i class="ph-fill ph-push-pin-slash text-lg text-gray-500"></i>
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  `;
Â  Â  } else {
Â  Â  Â  Â  buttons += `
Â  Â  Â  Â  Â  Â  <button onclick="App.showPinChatPopup('${otherUid}')" class="w-full flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-black/5 btn-tap">
Â  Â  Â  Â  Â  Â  Â  Â  <span>ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</span> <i class="ph-fill ph-push-pin text-lg text-gray-500"></i>
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  `;
Â  Â  }
Â  Â Â 
Â  Â  buttons += `
Â  Â  Â  Â  <button onclick="App.toggleMutePermanent('${otherUid}')" class="w-full flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-black/5 btn-tap">
<span>${App.isMuted(otherUid) ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØªÙ…' : 'ÙƒØªÙ… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©'}</span> <i class="ph-fill ${App.isMuted(otherUid) ? 'ph-bell-simple-slash' : 'ph-bell-simple-z'} text-lg text-gray-500"></i>
</button>
Â  Â  Â  Â  ${isMyFriend ? `
Â  Â  Â  Â  <button onclick="App.unfriend('${otherUid}')" class="w-full flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-black/5 btn-tap">
Â  Â  Â  Â  Â  Â  <span>Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</span> <i class="ph-fill ph-user-minus text-lg text-gray-500"></i>
Â  Â  Â  Â  </button>
Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  <button onclick="App.blockUser('${otherUid}')" class="w-full flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-orange-50 btn-tap text-orange-500">
Â  Â  Â  Â  Â  Â  <span>Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span> <i class="ph-fill ph-prohibit text-lg"></i>
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <button onclick="App.showDeleteChatPopup('${otherUid}')" class="w-full flex justify-between items-center p-4 hover:bg-red-50 btn-tap text-red-500">
Â  Â  Â  Â  Â  Â  <span>Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</span> <i class="ph-fill ph-trash text-lg"></i>
Â  Â  Â  Â  </button>
Â  Â  `;
Â  Â Â 
Â  Â  content.innerHTML = buttons;
Â  Â  UI.openModal('action-modal');
},
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  unpinChatFromOptions: async (otherUid) => {
Â  Â  Â  Â  Â  Â  Â  Â  const existingPin = Memory.pins.find(p =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  p.userId === currentUser.uid && p.chatId === otherUid
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  if(existingPin) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, PINS_PATH, existingPin.id));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showDeleteChatPopup: (otherUid) => {
Â  Â  Â  Â  Â  Â  Â  Â  window.deleteChatTarget = otherUid;
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('delete-chat-popup');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ø¯Ø§Ù„Ø© Ø§Ù„ÙƒØªÙ… Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙˆØ§Ù„Ø¯Ø§Ø¦Ù…
Â  Â  Â  Â  Â  Â  toggleMutePermanent: async (uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!uid) return;
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isMuted = App.isMuted(uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(isMuted) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØªÙ…
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const existingMute = Memory.mutes.find(m => m.userId === currentUser.uid && m.chatId === uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(existingMute) await deleteDoc(doc(db, MUTES_PATH, existingMute.id));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØªÙ… ğŸ””');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ÙƒØªÙ… Ø¯Ø§Ø¦Ù… (Ù„Ù…Ø¯Ø© 10 Ø³Ù†ÙˆØ§Øª)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, MUTES_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId: currentUser.uid, chatId: uid, until: Date.now() + (10 * 365 * 24 * 60 * 60 * 1000)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… ÙƒØªÙ… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù… ğŸ”•');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!document.getElementById('profile-modal').classList.contains('hidden')) App.renderUserProfile(uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!document.getElementById('chat-modal').classList.contains('hidden')) App.renderChatInfo(uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.renderChats();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');Â 
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error muting:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  deleteChatHistory: async (type) => {
Â  Â  Â  Â  Â  Â  Â  Â  const otherUid = window.deleteChatTarget;
Â  Â  Â  Â  Â  Â  Â  Â  if(!otherUid) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const msgsToDelete = Memory.messages.filter(m =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m.participants.includes(currentUser.uid) &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m.participants.includes(otherUid)
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(type === 'everyone') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let msg of msgsToDelete) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, MESSAGES_PATH, msg.id));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let msg of msgsToDelete) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, MESSAGES_PATH, msg.id), {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deletedFor: arrayUnion(currentUser.uid)Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø·');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('chat-modal');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  renderChats: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('chats-container');
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const chatUsers = {};
Â  Â  Â  Â  Â  Â  Â  Â  let totalUnreadCount = 0;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Memory.messages.forEach(msg => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(msg.participants.includes(currentUser.uid)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const otherUid = msg.participants.find(id => id !== currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(App.isBlocked(otherUid)) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(msg.deletedFor && msg.deletedFor.includes(currentUser.uid)) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!chatUsers[otherUid]) chatUsers[otherUid] = { lastMsg: msg, unreadCount: 0 };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(chatUsers[otherUid].lastMsg.timestamp < msg.timestamp) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatUsers[otherUid].lastMsg = msg;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(msg.senderId === otherUid && !msg.read) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatUsers[otherUid].unreadCount++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalUnreadCount++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  let chatsArray = Object.entries(chatUsers);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  chatsArray = chatsArray.map(([uid, data]) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const pin = Memory.pins.find(p => p.userId === currentUser.uid && p.chatId === uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mute = Memory.mutes.find(m => m.userId === currentUser.uid && m.chatId === uid && m.until > Date.now());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø¥Ø°Ø§ Ø§Ù„Ø´Ø®Øµ ØºÙŠØ± Ù…ÙƒØªÙˆÙ… ÙˆØ¹Ù†Ø¯Ù‡ Ø±Ø³Ø§Ø¦Ù„ØŒ Ù†Ø¶ÙŠÙÙ‡Ù… Ù„Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!mute && data.unreadCount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalUnreadCount += data.unreadCount;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return [uid, {...data, pin, mute}];
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  chatsArray.sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(a[1].pin && !b[1].pin) return -1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!a[1].pin && b[1].pin) return 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(a[1].pin && b[1].pin) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(a[1].pin.type === 'love' && b[1].pin.type !== 'love') return -1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(a[1].pin.type !== 'love' && b[1].pin.type === 'love') return 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return b[1].lastMsg.timestamp - a[1].lastMsg.timestamp;
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if(chatsArray.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-50 py-10 mt-10"><i class="ph ph-chat-circle-dots text-4xl mb-2 block mx-auto"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('badge-messages').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  chatsArray.forEach(([otherUid, chatData]) => {
    const lastMsg = chatData.lastMsg;
    const u = Memory.users[otherUid];
    if(!u) return;

    const hasUnread = chatData.unreadCount > 0;
    const isOnline = App.isOnline(u.lastActive);
    const pin = chatData.pin;
    const mute = chatData.mute;

    // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø±Ø³Ø§Ø¦Ù„ ÙˆØºÙŠØ± Ù…ÙƒØªÙˆÙ… ÙŠÙƒÙˆÙ† Ø£Ø²Ø±Ù‚ Ø®ÙÙŠÙ)
    const isBlueUnread = hasUnread && !mute;
    const unreadClass = isBlueUnread ? 'bg-blue-50/20' : 'hover:opacity-80';

    const el = document.createElement('div');
    el.className = `flex items-center gap-3 p-3 border-b cursor-pointer btn-tap transition-colors theme-card ${unreadClass}`;
    
    let pressTimer;
    const startPress = (e) => { 
        e.stopPropagation();
        pressTimer = setTimeout(() => App.showChatOptions(u.uid, e), 600); 
    };
    const cancelPress = () => clearTimeout(pressTimer);
    el.addEventListener('mousedown', startPress);
    el.addEventListener('touchstart', startPress, {passive: true});
    el.addEventListener('mouseup', cancelPress);
    el.addEventListener('mouseleave', cancelPress);
    el.addEventListener('touchend', cancelPress);
    el.addEventListener('touchmove', cancelPress);

    el.onclick = () => {
        if(pressTimer) clearTimeout(pressTimer);
        UI.openModal('chat-modal', u.uid);
    };

    let tickHtml = '';
    if(lastMsg.senderId === currentUser.uid) {
        tickHtml = lastMsg.read ? '<i class="ph-fill ph-checks text-blue-500 text-[13px] ml-1"></i>' : '<i class="ph ph-check opacity-50 text-[13px] ml-1"></i>';
    }

    let msgPreview = lastMsg.text;
    if (lastMsg.isNoteReply) {
        msgPreview = lastMsg.senderId === currentUser.uid ? 'Ø±Ø¯ÙŠØª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©' : 'ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ';
    }
    
    if (!Memory.typingStatus) Memory.typingStatus = {};
    const typingData = Memory.typingStatus[`${otherUid}_${currentUser.uid}`];
    let isTypingNow = false;
    if(typingData && typingData.text && (Date.now() - typingData.timestamp < 5000)) {
        isTypingNow = true;
        msgPreview = `<span class="text-blue-500 font-bold animate-pulse">ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†...</span>`;
        tickHtml = '';
    }
    
    let pinHtml = '';
    if(pin) {
        if(pin.type === 'love') {
            pinHtml = '<span class="pin-love"><i class="ph-fill ph-heart"></i> Ø§Ù„Ø­Ø¨</span>';
        } else {
            pinHtml = '<span class="pin-normal"><i class="ph-fill ph-push-pin"></i></span>';
        }
    }
    
    let muteHtml = '';
    if(mute) {
        muteHtml = '<span class="mute-badge mr-1"><i class="ph-fill ph-bell-simple-slash"></i></span>';
    }

    // ØªØ¬Ù‡ÙŠØ² Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø© ÙˆØ£Ù„ÙˆØ§Ù†Ù‡
    let counterHtml = '';
    if(hasUnread) {
        const badgeColor = mute ? 'bg-gray-400' : 'bg-blue-600';
        counterHtml = `<span class="${badgeColor} text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center shrink-0 shadow-sm mr-2">${chatData.unreadCount}</span>`;
    }

    el.innerHTML = `
        <div class="relative">
            <img src="${u.photo || App.getDefaultAvatar()}" class="w-14 h-14 rounded-full object-cover border border-gray-100">
            ${isOnline ? '<span class="absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full"></span>' : ''}
            ${pinHtml}
        </div>
        <div class="flex-1 overflow-hidden pr-1 relative">
            <div class="flex justify-between items-center mb-0.5">
                <h4 class="font-bold truncate text-[15px] flex items-center gap-1 ${isBlueUnread ? 'theme-text' : 'opacity-90'}">${u.name} ${muteHtml}</h4>
                <span class="text-xs ${isBlueUnread ? 'font-bold text-blue-600' : 'opacity-60'} whitespace-nowrap">${App.timeAgo(lastMsg.timestamp)}</span>
            </div>
            <div class="flex items-center justify-between">
                <p class="text-sm truncate flex-1 flex items-center gap-0.5 ${isBlueUnread ? 'text-unread' : (lastMsg.senderId !== currentUser.uid && hasUnread ? 'font-bold opacity-80' : 'opacity-60')}">
                    ${tickHtml} ${msgPreview.replace(/\n/g, ' ')}
                </p>
                ${counterHtml}
            </div>
        </div>
    `;
    container.appendChild(el);
});

Â  Â  Â  Â  Â  Â  Â  Â  if(totalUnreadCount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const badge = document.getElementById('badge-messages');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badge.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badge.innerText = totalUnreadCount > 9 ? '+9' : totalUnreadCount;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('badge-messages').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  markChatAsRead: async (otherUid) => {
Â  Â  Â  Â  Â  Â  Â  Â  const unreadMsgs = Memory.messages.filter(m =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m.participants.includes(currentUser.uid) &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m.participants.includes(otherUid) &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m.senderId === otherUid &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  !m.read
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  for(let msg of unreadMsgs) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, MESSAGES_PATH, msg.id), { read: true });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  renderChatInfo: (uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  const u = Memory.users[uid];
Â  Â  Â  Â  Â  Â  Â  Â  if(!u) return;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('chat-user-img').src = u.photo || App.getDefaultAvatar();
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('chat-user-name').innerText = u.name;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const isOnline = App.isOnline(u.lastActive);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('chat-online-dot').style.display = isOnline ? 'block' : 'none';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('chat-user-status').innerText = isOnline ? 'Ù†Ø´Ø· Ø§Ù„Ø¢Ù†' : `Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ± ${App.timeAgo(u.lastActive)}`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const isMuted = App.isMuted(uid);
Â  Â  Â  Â  Â  Â  Â  Â  const muteBtnIcon = document.getElementById('chat-mute-btn').querySelector('i');
Â  Â  Â  Â  Â  Â  Â  Â  if(isMuted) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  muteBtnIcon.className = 'ph-fill ph-bell-simple-slash text-lg';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  muteBtnIcon.className = 'ph ph-bell-simple-z text-lg';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  setReplyMode: (msgId, text, senderName) => {
Â  Â  Â  Â  Â  Â  Â  Â  window.replyingToMessage = msgId;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('reply-to-name').innerText = `Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ ${senderName}`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('reply-to-text').innerText = text;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('replying-to-container').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('chat-input').focus();
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  cancelReply: () => {
Â  Â  Â  Â  Â  Â  Â  Â  window.replyingToMessage = null;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('replying-to-container').classList.add('hidden');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  highlightMessage: (msgId) => {
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('chat-messages-container');
Â  Â  Â  Â  Â  Â  Â  Â  const msgElement = container.querySelector(`[data-msg-id="${msgId}"]`);
Â  Â  Â  Â  Â  Â  Â  Â  if(msgElement) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  msgElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  msgElement.classList.add('highlight-message');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  msgElement.classList.remove('highlight-message');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 2000);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  loadMessages: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  // ØªÙ… Ø­Ø°Ù Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠØ¯ (25 Ø±Ø³Ø§Ù„Ø©)
Â  Â  Â  Â  Â  Â  Â  Â  // Ù†Ø³ØªØ¯Ø¹ÙŠ Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ù… ÙÙˆØ±Ø§Ù‹ Ù„Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
Â  Â  Â  Â  Â  Â  Â  Â  App.renderMessages();
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  loadMoreMessages: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  // Ù„Ù… Ù†Ø¹Ø¯ Ù†Ø­ØªØ§Ø¬ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø©ØŒ ØªØ±ÙƒÙ†Ø§Ù‡Ø§ ÙØ§Ø±ØºØ© Ù„ØªØ¬Ù†Ø¨ Ø£ÙŠ Ø£Ø®Ø·Ø§Ø¡
Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  renderMessages: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const otherUid = window.currentChatUserId;
Â  Â  Â  Â  Â  Â  Â  Â  if(!otherUid) return;

Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('chat-messages-container');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ø¨Ø¯ÙˆÙ† ØªÙ‚ÙŠÙŠØ¯)
Â  Â  Â  Â  Â  Â  Â  Â  let msgs = Memory.messages.filter(m => m.participants.includes(currentUser.uid) && m.participants.includes(otherUid));
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„ØªØ±ØªÙŠØ¨: Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹ (Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ø³ÙÙ„)
Â  Â  Â  Â  Â  Â  Â  Â  msgs = msgs.sort((a,b) => a.timestamp - b.timestamp);
Â  Â  Â  Â  Â  Â  Â  Â  msgs = msgs.filter(m => !(m.deletedFor && m.deletedFor.includes(currentUser.uid)));

Â  Â  Â  Â  Â  Â  Â  Â  App.updateChatPet(msgs);

Â  Â  Â  Â  Â  Â  Â  Â  // ØªÙØ±ÙŠØº Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙ‚Ø· Ù…Ø¹ Ø¥Ø¨Ù‚Ø§Ø¡ ÙÙ‚Ø§Ø¹Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø©
Â  Â  Â  Â  Â  Â  Â  Â  Array.from(container.children).forEach(child => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(child.id !== 'live-typing-bubble') child.remove();
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const pinnedMsg = msgs.find(m => m.pinned);
Â  Â  Â  Â  Â  Â  Â  Â  if(pinnedMsg) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const pinEl = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pinEl.className = 'sticky top-0 bg-white/90 dark:bg-gray-800/90 backdrop-blur-md border-b p-2 mb-4 rounded-xl shadow-sm z-20 flex items-center justify-between cursor-pointer theme-text';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pinEl.innerHTML = `<div class="flex-1 overflow-hidden pr-2 border-r-4 border-blue-500"><span class="text-xs font-bold text-blue-600 block"><i class="ph-fill ph-push-pin"></i> Ø±Ø³Ø§Ù„Ø© Ù…Ø«Ø¨ØªØ©</span><span class="text-sm truncate block opacity-80">${escapeHTML(pinnedMsg.text)}</span></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pinEl.onclick = () => { App.highlightMessage(pinnedMsg.id); };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(pinEl);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if(msgs.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML += '<div class="text-center opacity-50 py-10 mt-auto theme-text">Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø© ğŸ‘‹</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  msgs.forEach(m => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isMe = m.senderId === currentUser.uid;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const row = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø²Ø¯Ù†Ø§ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø³ÙÙ„ÙŠØ© mb-4 Ù„ØªØ±Ùƒ Ù…Ø³Ø§Ø­Ø© Ù„Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ø­ØªÙ‰ Ù„Ø§ ØªØªØ¯Ø§Ø®Ù„ Ù…Ø¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ ØªØ­ØªÙ‡Ø§
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.className = `msg-row flex w-full mb-4 ${isMe ? 'justify-end' : 'justify-start'}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.setAttribute('data-msg-id', m.id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = `max-w-[80%] rounded-2xl p-3 shadow-sm relative break-words ${isMe ? 'bubble-me rounded-br-sm' : 'bubble-other rounded-bl-sm'}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // --- Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ ÙˆØ§Ù„Ø¶ØºØ· Ø§Ù„Ù…ÙØ±Ø¯ ---
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let clickTimer = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let lastClickTime = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.onclick = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentTime = new Date().getTime();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeDiff = currentTime - lastClickTime;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (timeDiff < 300) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø¶ØºØ· Ù…Ø²Ø¯ÙˆØ¬! Ù†Ù„ØºÙŠ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…ÙØ±Ø¯ ÙˆÙ†ÙØªØ­ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(clickTimer);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.showReactionsModal(m.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastClickTime = 0; // ØªØµÙÙŠØ± Ø§Ù„ÙˆÙ‚Øª
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø¶ØºØ· Ù…ÙØ±Ø¯ (Ù†Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„ØªØ£ÙƒØ¯ Ø£Ù†Ù‡ Ù„ÙŠØ³ Ø¶ØºØ·Ø§Ù‹ Ù…Ø²Ø¯ÙˆØ¬Ø§Ù‹)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastClickTime = currentTime;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clickTimer = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.showMessageOptions(m.id, isMe, m.text, m.pinned);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 300);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let replyIcon = document.createElement('i');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  replyIcon.className = `ph-fill ph-reply reply-icon-indicator ${isMe ? '-left-8' : '-right-8'}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.appendChild(replyIcon);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let startX = 0, startY = 0, currentX = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let isSwiping = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; startY = e.touches[0].clientY; isSwiping = false; }, {passive: true});
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.addEventListener('touchmove', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!startX || !startY) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentX = e.touches[0].clientX; let diffX = currentX - startX; let diffY = e.touches[0].clientY - startY;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (diffX < -10 && Math.abs(diffX) > Math.abs(diffY)) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isSwiping = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(e.cancelable) e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let translate = Math.max(diffX, -70);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.style.transform = `translateX(${translate}px)`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  replyIcon.style.opacity = Math.abs(translate) / 70;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, {passive: false});
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.addEventListener('touchend', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!isSwiping) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.style.transform = `translateX(0)`; replyIcon.style.opacity = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentX - startX < -50) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.setReplyMode(m.id, m.text, isMe ? 'Ù†ÙØ³Ùƒ' : Memory.users[m.senderId].name);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startX = 0; isSwiping = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tickHtml = isMe ? (m.read ? '<i class="ph-fill ph-checks text-blue-500 text-[16px] ml-1 drop-shadow-sm"></i>' : '<i class="ph ph-check opacity-70 text-[16px] ml-1"></i>') : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
// --- ØªØ¬Ù‡ÙŠØ² Ø´Ø±ÙŠØ· Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ø£Ø³ÙÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (Ù…Ø¹ ØµÙˆØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª) ---
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let reactionsHtml = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (m.reactions && Object.keys(m.reactions).length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const reactionGroups = {}; // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ { 'â¤ï¸': ['uid1', 'uid2'] }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Object.entries(m.reactions).forEach(([uid, emoji]) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!reactionGroups[emoji]) reactionGroups[emoji] = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reactionGroups[emoji].push(uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let bubbles = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Object.entries(reactionGroups).forEach(([emoji, uids]) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let avatarsHtml = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uids.forEach(uid => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const user = Memory.users[uid];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø¬Ù… Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØµØºÙŠØ±
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  avatarsHtml += `<img src="${user.photo || App.getDefaultAvatar()}" class="w-5 h-5 min-w-[20px] shrink-0 rounded-full border border-blue-100 dark:border-blue-900 -ml-1.5 inline-block object-cover z-10 relative">`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ÙÙ‚Ø§Ø¹Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ (Ø®Ù„ÙÙŠØ© Ø²Ø±Ù‚Ø§Ø¡ Ù„Ø·ÙŠÙØ© Ù…Ø«Ù„ Ø§Ù„ØªÙ„ÙƒØ±Ø§Ù…)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bubbles += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-blue-100 dark:bg-blue-900/60 border border-blue-200 dark:border-blue-800 rounded-full pl-2 pr-1 py-0.5 flex items-center gap-1.5 shadow-sm cursor-pointer btn-tap" onclick="App.showReactionsModal('${m.id}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[14px] -mt-0.5">${emoji}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex pl-1">${avatarsHtml}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reactionsHtml = `<div class="absolute -bottom-3 ${isMe ? 'right-2' : 'left-2'} flex gap-1 z-20">${bubbles}</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let messageContentHtml = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (m.isNoteReply && m.replyNoteText) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ØªØµÙ…ÙŠÙ… ÙŠØ­Ø§ÙƒÙŠ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³ØªÙˆØ±ÙŠ (Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ ÙˆØ¨ÙŠØ¶Ø§Ø¡ ÙÙŠ Ø§Ù„Ù„ÙŠÙ„ÙŠ)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageContentHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2.5 mb-1 bg-black/5 dark:bg-white/10 p-1.5 rounded-xl border border-black/10 dark:border-white/10">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-9 h-12 rounded-lg bg-gray-900 text-white dark:bg-gray-100 dark:text-gray-900 flex items-center justify-center p-1.5 overflow-hidden shrink-0 shadow-inner">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[7px] font-bold text-center leading-tight line-clamp-3">${escapeHTML(m.replyNoteText)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 overflow-hidden pr-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[11px] font-bold text-blue-500 block mb-0.5">Ù…Ù„Ø§Ø­Ø¸Ø©</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[14px] truncate block theme-text">${parseTextWithLinks(m.text, true)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageContentHtml = `<p class="text-[15px] leading-relaxed whitespace-pre-wrap">${parseTextWithLinks(m.text, true)}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `${messageContentHtml}<span class="text-[10px] mt-1.5 flex justify-end items-center gap-1 font-medium opacity-80">${new Date(m.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} ${tickHtml}</span>${reactionsHtml}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(row);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const typingBubble = document.getElementById('live-typing-bubble');
Â  Â  Â  Â  Â  Â  Â  Â  if(typingBubble) container.appendChild(typingBubble);

Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ù„Ù†Ø²ÙˆÙ„ Ù„Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.scrollTop = container.scrollHeight;
Â  Â  Â  Â  Â  Â  Â  Â  }, 50);
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  sendMessage: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const otherUid = window.currentChatUserId;
Â  Â  Â  Â  Â  Â  Â  Â  const inputEl = document.getElementById('chat-input');
Â  Â  Â  Â  Â  Â  Â  Â  const text = inputEl.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if(!text || !otherUid) return;

Â  Â  Â  Â  Â  Â  Â  Â  inputEl.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  inputEl.style.height = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  inputEl.focus();Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  try { await deleteDoc(doc(db, TYPING_PATH, `${currentUser.uid}_${otherUid}`)); } catch(e){}

Â  Â  Â  Â  Â  Â  Â  Â  const payload = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  participants: [currentUser.uid, otherUid],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  senderId: currentUser.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: text,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: Date.now(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  read: falseÂ 
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  if(window.replyingToMessage) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  payload.replyToId = window.replyingToMessage;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.cancelReply();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, MESSAGES_PATH), payload);
Â  Â  Â  Â  Â  Â  Â  Â  // Firebase Ø³ÙŠÙ‚ÙˆÙ… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø´Ø© ÙÙˆØ±Ø§Ù‹ ÙˆØ¨Ø´ÙƒÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ø¨Ø± onSnapshot
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  sendNotification: async (toUid, text, linkId) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(toUid === currentUser.uid) return;
Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, NOTIFS_PATH), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to: toUid, from: currentUser.uid, text: text, linkId: linkId, timestamp: Date.now(), read: false
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  deleteNotification: async (notifId) => {
Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, NOTIFS_PATH, notifId));
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('action-modal');
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  markNotificationRead: async (notifId) => {
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, NOTIFS_PATH, notifId), { read: true });
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  showNotifOptions: (notifId) => {
Â  Â  Â  Â  Â  Â  Â  Â  const content = document.getElementById('action-modal-content');
Â  Â  Â  Â  Â  Â  Â  Â  content.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="App.deleteNotification('${notifId}')" class="w-full flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-red-50 btn-tap text-red-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</span> <i class="ph-fill ph-trash text-lg"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  UI.openModal('action-modal');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  renderNotifications: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('notifications-container');
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const notifs = [...Memory.notifications].sort((a,b) => b.timestamp - a.timestamp);
Â  Â  Â  Â  Â  Â  Â  Â  const unreadExists = notifs.some(n => !n.read && !App.isBlocked(n.from));
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(notifs.length > 0 && unreadExists) document.getElementById('badge-notifications').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  else document.getElementById('badge-notifications').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(notifs.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center opacity-50 py-10 mt-10"><i class="ph ph-bell-ringing text-4xl mb-2 block mx-auto"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  notifs.forEach(n => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fromUser = Memory.users[n.from];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!fromUser || App.isBlocked(n.from)) return;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isUnread = !n.read;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.className = `flex items-center gap-3 p-3.5 border-b cursor-pointer transition-colors btn-tap theme-card ${isUnread ? 'bg-blue-50/20' : 'hover:opacity-80'}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let pressTimer;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const startPress = () => { pressTimer = setTimeout(() => App.showNotifOptions(n.id), 600); };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cancelPress = () => clearTimeout(pressTimer);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.addEventListener('mousedown', startPress);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.addEventListener('touchstart', startPress, {passive: true});
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.addEventListener('mouseup', cancelPress);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.addEventListener('mouseleave', cancelPress);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.addEventListener('touchend', cancelPress);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.addEventListener('touchmove', cancelPress);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(pressTimer) clearTimeout(pressTimer);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(isUnread) App.markNotificationRead(n.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(n.linkId) UI.openModal('comments-modal', n.linkId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else UI.openModal('profile-modal', n.from);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${fromUser.photo || App.getDefaultAvatar()}" class="w-12 h-12 rounded-full object-cover border border-gray-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isUnread ? '<div class="absolute top-0 right-0 w-3 h-3 bg-blue-600 rounded-full border-2 border-white"></div>' : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-[15px] leading-tight ${isUnread ? 'theme-text font-bold' : 'opacity-80'}"><span class="font-bold flex items-center gap-1">${fromUser.name}</span> ${n.text}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs font-semibold ${isUnread ? 'text-blue-600' : 'opacity-60'} mt-1 block">${App.timeAgo(n.timestamp)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  handleEditImage: (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  Â  Â  Â  Â  Â  if (!file) return;
Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  reader.onload = (event) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  img.onload = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const canvas = document.createElement('canvas');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.width = 300; canvas.height = 300;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ctx.drawImage(img, 0, 0, 300, 300);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const b64 = canvas.toDataURL('image/jpeg', 0.6);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('edit-profile-img').src = b64;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.tempEditPhoto = b64;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  img.src = event.target.result;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  saveProfile: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const name = document.getElementById('edit-name').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  const usernameInput = document.getElementById('edit-username');
Â  Â  Â  Â  Â  Â  Â  Â  const username = usernameInput.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  const bio = document.getElementById('edit-bio').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(!name || (!username && !usernameInput.disabled)) return UI.showMessage('Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø¹Ø±Ù Ù…Ø·Ù„ÙˆØ¨Ø§Ù†');
Â  Â  Â  Â  Â  Â  Â  Â  const updates = { name, bio };

Â  Â  Â  Â  Â  Â  Â  Â  if(!usernameInput.disabled && username !== currentUser.username) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tenDaysInMs = 10 * 24 * 60 * 60 * 1000;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastChange = currentUser.lastUsernameChange || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (Date.now() - lastChange < tenDaysInMs) return UI.showMessage('Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¹Ø±Ù Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ÙƒÙ„ 10 Ø£ÙŠØ§Ù…');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isTaken = Object.values(Memory.users).some(u => u.username === username && u.uid !== currentUser.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(isTaken) return UI.showMessage('Ø§Ù„Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø¨Ù„ Ø´Ø®Øµ Ø¢Ø®Ø±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹Ø±Ù Ù…Ø®ØªÙ„Ù');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updates.username = username;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updates.lastUsernameChange = Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ø­ÙØ¸ Ø§Ù„Ø¬Ù†Ø³ Ø¥Ø°Ø§ ØªØºÙŠØ±
Â  Â  Â  Â  Â  Â  Â  Â  if(window.selectedEditGender && window.selectedEditGender !== currentUser.gender) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sixtyDaysInMs = 60 * 24 * 60 * 60 * 1000;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastChange = currentUser.lastGenderChange || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (Date.now() - lastChange >= sixtyDaysInMs) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updates.gender = window.selectedEditGender;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updates.lastGenderChange = Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if(window.tempEditPhoto) updates.photo = window.tempEditPhoto;

Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, USERS_PATH, currentUser.uid), updates);
Â  Â  Â  Â  Â  Â  Â  Â  Object.assign(currentUser, updates);
Â  Â  Â  Â  Â  Â  Â  Â  window.tempEditPhoto = null;
Â  Â  Â  Â  Â  Â  Â  Â  App.updateUIWithUserData();
Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('edit-profile-modal');
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  updatePrivacy: async (key, value) => {
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, USERS_PATH, currentUser.uid), { [key]: value });
Â  Â  Â  Â  Â  Â  Â  Â  currentUser[key] = value;
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®ØµÙˆØµÙŠØ©');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };

Â  Â  Â  Â  // Ø¯Ø§Ù„Ø© Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
Â  Â  Â  Â  window.copyProfileLink = (username) => {
Â  Â  Â  Â  Â  Â  const link = `${window.location.origin}${window.location.pathname}?user=${username}`;
Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(link).then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
Â  Â  Â  Â  Â  Â  }).catch(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const tempInput = document.createElement("input");
Â  Â  Â  Â  Â  Â  Â  Â  tempInput.value = link;
Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(tempInput);
Â  Â  Â  Â  Â  Â  Â  Â  tempInput.select();
Â  Â  Â  Â  Â  Â  Â  Â  document.execCommand("copy");
Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(tempInput);
Â  Â  Â  Â  Â  Â  Â  Â  UI.showMessage('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  // Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (Ø¹Ù„Ù‰ ÙƒØ§Ù…Ù„ Ø§Ù„Ø´Ø§Ø´Ø©)
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  const chatModal = document.getElementById('chat-modal');
Â  Â  Â  Â  Â  Â  let touchStartX = 0;
Â  Â  Â  Â  Â  Â  let touchStartY = 0;
Â  Â  Â  Â  Â  Â  let isPageSwiping = false;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  chatModal.addEventListener('touchstart', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(e.target.closest('#chat-back-button')) return;
Â  Â  Â  Â  Â  Â  Â  Â  touchStartX = e.touches[0].clientX;
Â  Â  Â  Â  Â  Â  Â  Â  touchStartY = e.touches[0].clientY;
Â  Â  Â  Â  Â  Â  Â  Â  isPageSwiping = false;
Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.transition = 'none'; // Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ£Ø®ÙŠØ± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨
Â  Â  Â  Â  Â  Â  }, {passive: true});
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  chatModal.addEventListener('touchmove', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!touchStartX) return;
Â  Â  Â  Â  Â  Â  Â  Â  const diffX = e.touches[0].clientX - touchStartX;
Â  Â  Â  Â  Â  Â  Â  Â  const diffY = e.touches[0].clientY - touchStartY;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(diffX > 20 && Math.abs(diffX) > Math.abs(diffY) && !chatModal.classList.contains('hidden')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isPageSwiping = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø³Ø­Ø¨ Ù„Ø¹Ù…Ù„ ØªØ£Ø«ÙŠØ± Ø·ÙŠ Ø§Ù„ÙˆØ±Ù‚Ø©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const progress = Math.min(diffX / window.innerWidth, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const angle = progress * 65; // Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø·ÙŠ Ø§Ù„Ù‚ØµÙˆÙ‰
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.transformOrigin = 'right center';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø¸ÙˆØ± ÙˆØ§Ù„Ø¯ÙˆØ±Ø§Ù† ÙˆØ§Ù„Ø´ÙØ§ÙÙŠØ©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.transform = `perspective(1500px) rotateY(${-angle}deg) translateX(${diffX * 0.4}px)`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.opacity = 1 - (progress * 0.6);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, {passive: true});
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  chatModal.addEventListener('touchend', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!isPageSwiping) return;
Â  Â  Â  Â  Â  Â  Â  Â  const diffX = e.changedTouches[0].clientX - touchStartX;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.transition = 'all 0.4s cubic-bezier(0.25, 1, 0.5, 1)';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(diffX > 100) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø¥ÙƒÙ…Ø§Ù„ Ø·ÙŠ Ø§Ù„ÙˆØ±Ù‚Ø© ÙˆØ¥Ø®ÙØ§Ø¦Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙÙ„Ø§Øª
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.transform = 'perspective(1500px) rotateY(-90deg) translateX(100px)';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.opacity = '0';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.closeModal('chat-modal');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®ØµØ§Ø¦Øµ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¨Ø¹Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.transform = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.opacity = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.transformOrigin = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 300);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 300);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ø±ØªØ¯Ø§Ø¯ Ø§Ù„ÙˆØ±Ù‚Ø© Ù„Ø­Ø§Ù„ØªÙ‡Ø§ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ø³Ø­Ø¨ ÙƒØ§ÙÙŠØ§Ù‹
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.transform = 'perspective(1500px) rotateY(0deg) translateX(0)';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatModal.style.opacity = '1';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  touchStartX = 0; isPageSwiping = false;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  window.onload = () => {
Â  Â  Â  Â  Â  Â  Auth.init();
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  </script>
</body>
</html>
